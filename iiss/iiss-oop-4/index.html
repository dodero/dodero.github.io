
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Apuntes de Implementación e Implantación de Sistemas Software – Grado en Ingeniería Informática">
      
      
      
        <meta name="author" content="Juan Manuel Dodero">
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.7">
    
    
      
        <title>Duplicación - Implementación e Implantación de Sistemas Software</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.cb6bc1d0.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.39b8e14a.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#caso-4-calculo-de-nominas" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Implementación e Implantación de Sistemas Software" class="md-header-nav__button md-logo" aria-label="Implementación e Implantación de Sistemas Software">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            Implementación e Implantación de Sistemas Software
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Duplicación
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/dodero/gii-dss-iiss/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Implementación e Implantación de Sistemas Software" class="md-nav__button md-logo" aria-label="Implementación e Implantación de Sistemas Software">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Implementación e Implantación de Sistemas Software
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/dodero/gii-dss-iiss/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Inicio
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" >
      
      <label class="md-nav__link" for="nav-2">
        Asignatura
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Asignatura" data-md-level="1">
        <label class="md-nav__title" for="nav-2">
          <span class="md-nav__icon md-icon"></span>
          Asignatura
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../iiss-pres/" class="md-nav__link">
        Presentación
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../bibliografia/" class="md-nav__link">
        Bibliografía
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        About
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../iiss-temas/" class="md-nav__link">
        Temario
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
      
      <label class="md-nav__link" for="nav-4">
        I. Objetos
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="I. Objetos" data-md-level="1">
        <label class="md-nav__title" for="nav-4">
          <span class="md-nav__icon md-icon"></span>
          I. Objetos
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../iiss-oop-1/" class="md-nav__link">
        Principios
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../iiss-oop-2/" class="md-nav__link">
        Delegación
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../iiss-oop-3/" class="md-nav__link">
        Inyección
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Duplicación
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Duplicación
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#codigo-duplicado" class="md-nav__link">
    Código duplicado
  </a>
  
    <nav class="md-nav" aria-label="Código duplicado">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementacion-de-nominas-v01" class="md-nav__link">
    Implementación de nóminas v0.1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nominas-v02" class="md-nav__link">
    Nóminas v0.2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nominas-v03" class="md-nav__link">
    Nóminas v0.3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#refactoring" class="md-nav__link">
    Refactoring
  </a>
  
    <nav class="md-nav" aria-label="Refactoring">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#motivos-para-refactoring" class="md-nav__link">
    Motivos para refactoring
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#codigo-duplicado_1" class="md-nav__link">
    Código duplicado
  </a>
  
    <nav class="md-nav" aria-label="Código duplicado">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#por-que-no-duplicar" class="md-nav__link">
    ¿Por qué no duplicar?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#causas-de-la-duplicacion" class="md-nav__link">
    Causas de la duplicación
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#principio-dry-dont-repeat-yourself" class="md-nav__link">
    Principio DRY – Don't Repeat Yourself!
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#duplicacion-impuesta" class="md-nav__link">
    Duplicación impuesta
  </a>
  
    <nav class="md-nav" aria-label="Duplicación impuesta">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tecnicas-de-solucion" class="md-nav__link">
    Técnicas de solución
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#duplicacion-inadvertida" class="md-nav__link">
    Duplicación inadvertida
  </a>
  
    <nav class="md-nav" aria-label="Duplicación inadvertida">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ejemplo-codigo-duplicado-version-1" class="md-nav__link">
    Ejemplo: código duplicado – versión 1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplo-aplicando-memoization-version-2" class="md-nav__link">
    Ejemplo: aplicando memoization – versión 2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#principio-de-acceso-uniforme" class="md-nav__link">
    Principio de acceso uniforme
  </a>
  
    <nav class="md-nav" aria-label="Principio de acceso uniforme">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ejemplo-acceso-uniforme-en-c-version-3" class="md-nav__link">
    Ejemplo: acceso uniforme en C# – versión 3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#duplicacion-por-impaciencia" class="md-nav__link">
    Duplicación por impaciencia
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#duplicacion-por-simultaneidad" class="md-nav__link">
    Duplicación por simultaneidad
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ortogonalidad" class="md-nav__link">
    Ortogonalidad
  </a>
  
    <nav class="md-nav" aria-label="Ortogonalidad">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#beneficios-de-la-ortogonalidad" class="md-nav__link">
    Beneficios de la ortogonalidad
  </a>
  
    <nav class="md-nav" aria-label="Beneficios de la ortogonalidad">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mayor-productividad" class="md-nav__link">
    Mayor productividad
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#menor-riesgo" class="md-nav__link">
    Menor riesgo
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#niveles-de-aplicacion-de-la-ortogonalizad" class="md-nav__link">
    Niveles de aplicación de la ortogonalizad
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tecnicas-de-codificacion" class="md-nav__link">
    Técnicas de codificación
  </a>
  
    <nav class="md-nav" aria-label="Técnicas de codificación">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#desacoplar-ley-de-demeter" class="md-nav__link">
    Desacoplar - ley de Demeter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inyectar-el-contexto" class="md-nav__link">
    Inyectar el contexto
  </a>
  
    <nav class="md-nav" aria-label="Inyectar el contexto">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ejemplo-patron-estrategia" class="md-nav__link">
    Ejemplo: patrón estrategia
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplo-caballeros-de-la-mesa-redonda" class="md-nav__link">
    Ejemplo: caballeros de la mesa redonda
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ley-de-demeter-para-funciones" class="md-nav__link">
    Ley de Demeter para funciones
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interfaces-fluent" class="md-nav__link">
    Interfaces fluent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#criticas-a-la-ley-de-demeter" class="md-nav__link">
    Críticas a la ley de Demeter
  </a>
  
    <nav class="md-nav" aria-label="Críticas a la ley de Demeter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ejemplo-pintar-graficos-de-grabadoras" class="md-nav__link">
    Ejemplo: pintar gráficos de grabadoras
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#criticas" class="md-nav__link">
    Críticas
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ortogonalidad-en-toolkits-y-bibliotecas" class="md-nav__link">
    Ortogonalidad en toolkits y bibliotecas
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../iiss-err/" class="md-nav__link">
        Calidad
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../iiss-aop/" class="md-nav__link">
        II. Aspectos
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../iiss-dbc/" class="md-nav__link">
        III. Contratos
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" >
      
      <label class="md-nav__link" for="nav-7">
        IV. Funciones
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="IV. Funciones" data-md-level="1">
        <label class="md-nav__title" for="nav-7">
          <span class="md-nav__icon md-icon"></span>
          IV. Funciones
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../iiss-fp-1/" class="md-nav__link">
        Interfaces
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../iiss-fp-2/" class="md-nav__link">
        Lambdas
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../iiss-fp-3/" class="md-nav__link">
        Mixins
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8" >
      
      <label class="md-nav__link" for="nav-8">
        V. Eventos
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="V. Eventos" data-md-level="1">
        <label class="md-nav__title" for="nav-8">
          <span class="md-nav__icon md-icon"></span>
          V. Eventos
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../iiss-evp-1/" class="md-nav__link">
        Listeners
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../iiss-evp-2/" class="md-nav__link">
        Asíncronas
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#codigo-duplicado" class="md-nav__link">
    Código duplicado
  </a>
  
    <nav class="md-nav" aria-label="Código duplicado">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementacion-de-nominas-v01" class="md-nav__link">
    Implementación de nóminas v0.1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nominas-v02" class="md-nav__link">
    Nóminas v0.2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nominas-v03" class="md-nav__link">
    Nóminas v0.3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#refactoring" class="md-nav__link">
    Refactoring
  </a>
  
    <nav class="md-nav" aria-label="Refactoring">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#motivos-para-refactoring" class="md-nav__link">
    Motivos para refactoring
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#codigo-duplicado_1" class="md-nav__link">
    Código duplicado
  </a>
  
    <nav class="md-nav" aria-label="Código duplicado">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#por-que-no-duplicar" class="md-nav__link">
    ¿Por qué no duplicar?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#causas-de-la-duplicacion" class="md-nav__link">
    Causas de la duplicación
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#principio-dry-dont-repeat-yourself" class="md-nav__link">
    Principio DRY – Don't Repeat Yourself!
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#duplicacion-impuesta" class="md-nav__link">
    Duplicación impuesta
  </a>
  
    <nav class="md-nav" aria-label="Duplicación impuesta">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tecnicas-de-solucion" class="md-nav__link">
    Técnicas de solución
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#duplicacion-inadvertida" class="md-nav__link">
    Duplicación inadvertida
  </a>
  
    <nav class="md-nav" aria-label="Duplicación inadvertida">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ejemplo-codigo-duplicado-version-1" class="md-nav__link">
    Ejemplo: código duplicado – versión 1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplo-aplicando-memoization-version-2" class="md-nav__link">
    Ejemplo: aplicando memoization – versión 2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#principio-de-acceso-uniforme" class="md-nav__link">
    Principio de acceso uniforme
  </a>
  
    <nav class="md-nav" aria-label="Principio de acceso uniforme">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ejemplo-acceso-uniforme-en-c-version-3" class="md-nav__link">
    Ejemplo: acceso uniforme en C# – versión 3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#duplicacion-por-impaciencia" class="md-nav__link">
    Duplicación por impaciencia
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#duplicacion-por-simultaneidad" class="md-nav__link">
    Duplicación por simultaneidad
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ortogonalidad" class="md-nav__link">
    Ortogonalidad
  </a>
  
    <nav class="md-nav" aria-label="Ortogonalidad">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#beneficios-de-la-ortogonalidad" class="md-nav__link">
    Beneficios de la ortogonalidad
  </a>
  
    <nav class="md-nav" aria-label="Beneficios de la ortogonalidad">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mayor-productividad" class="md-nav__link">
    Mayor productividad
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#menor-riesgo" class="md-nav__link">
    Menor riesgo
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#niveles-de-aplicacion-de-la-ortogonalizad" class="md-nav__link">
    Niveles de aplicación de la ortogonalizad
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tecnicas-de-codificacion" class="md-nav__link">
    Técnicas de codificación
  </a>
  
    <nav class="md-nav" aria-label="Técnicas de codificación">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#desacoplar-ley-de-demeter" class="md-nav__link">
    Desacoplar - ley de Demeter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inyectar-el-contexto" class="md-nav__link">
    Inyectar el contexto
  </a>
  
    <nav class="md-nav" aria-label="Inyectar el contexto">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ejemplo-patron-estrategia" class="md-nav__link">
    Ejemplo: patrón estrategia
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplo-caballeros-de-la-mesa-redonda" class="md-nav__link">
    Ejemplo: caballeros de la mesa redonda
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ley-de-demeter-para-funciones" class="md-nav__link">
    Ley de Demeter para funciones
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interfaces-fluent" class="md-nav__link">
    Interfaces fluent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#criticas-a-la-ley-de-demeter" class="md-nav__link">
    Críticas a la ley de Demeter
  </a>
  
    <nav class="md-nav" aria-label="Críticas a la ley de Demeter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ejemplo-pintar-graficos-de-grabadoras" class="md-nav__link">
    Ejemplo: pintar gráficos de grabadoras
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#criticas" class="md-nav__link">
    Críticas
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ortogonalidad-en-toolkits-y-bibliotecas" class="md-nav__link">
    Ortogonalidad en toolkits y bibliotecas
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/dodero/gii-dss-iiss/edit/master/apuntes/construccion-sw/docs/iiss-oop-4.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h0>OBJETOS - Código duplicado</h0>
<p><a id="caso4"></a></p>
<h1 id="caso-4-calculo-de-nominas">Caso 4 - Cálculo de nóminas<a class="headerlink" href="#caso-4-calculo-de-nominas" title="Permanent link">&para;</a></h1>
<h2 id="codigo-duplicado">Código duplicado<a class="headerlink" href="#codigo-duplicado" title="Permanent link">&para;</a></h2>
<p><a id="nominas"></a></p>
<h3 id="implementacion-de-nominas-v01">Implementación de nóminas v0.1<a class="headerlink" href="#implementacion-de-nominas-v01" title="Permanent link">&para;</a></h3>
<details class="question"><summary>En la siguiente implementación, ¿dónde hay código duplicado?</summary><ul>
<li>Código duplicado en los constructores de las clases y subclases</li>
<li>Refactorizar delegando hacia la superclase</li>
</ul>
</details>
<div class="highlight"><pre><span></span><code>  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Empleado</span> <span class="p">{</span>
    <span class="n">Comparable</span> <span class="n">id</span><span class="p">;</span>
    <span class="n">String</span> <span class="n">name</span><span class="p">;</span>
    <span class="kd">public</span> <span class="nf">Empleado</span><span class="p">(</span><span class="n">String</span> <span class="n">id</span><span class="p">,</span> <span class="n">String</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">id</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">name</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Autonomo</span> <span class="kd">extends</span> <span class="n">Empleado</span> <span class="p">{</span>
    <span class="n">String</span> <span class="n">vatCode</span><span class="p">;</span>
    <span class="kd">public</span> <span class="nf">Autonomo</span><span class="p">(</span><span class="n">String</span> <span class="n">id</span><span class="p">,</span> <span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">String</span> <span class="n">vat</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">vatCode</span> <span class="o">=</span> <span class="n">vat</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">id</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">vatCode</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Prueba</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Empleado</span> <span class="n">e</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Empleado</span><span class="p">(</span><span class="s">&quot;0001&quot;</span><span class="p">,</span><span class="s">&quot;Enrique&quot;</span><span class="p">);</span>
      <span class="n">Empleado</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Autonomo</span><span class="p">(</span><span class="s">&quot;0002&quot;</span><span class="p">,</span><span class="s">&quot;Ana&quot;</span><span class="p">,</span><span class="s">&quot;12345-A&quot;</span><span class="p">);</span>
      <span class="n">e</span><span class="p">.</span><span class="na">print</span><span class="p">();</span>  
      <span class="n">a</span><span class="p">.</span><span class="na">print</span><span class="p">();</span>  
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>
<h3 id="nominas-v02">Nóminas v0.2<a class="headerlink" href="#nominas-v02" title="Permanent link">&para;</a></h3>
<ul>
<li>Requisito: los trabajadores autónomos cobran por horas (no tienen un salario fijo bruto)</li>
<li>Incluimos el método <code>computeMonthlySalary</code> para el cálculo de la nómina mensual</li>
</ul>
<details class="question"><summary>¿Están descohesionadas las clases?</summary><ul>
<li>¿Todos los empleados deben tener un salario anual <code>yearlyGrossSalary</code> bruto? Los autónomos no...</li>
<li>El método de cálculo del salario está descohesionado</li>
</ul>
</details>
<div class="highlight"><pre><span></span><code>  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Empleado</span> <span class="p">{</span>
    <span class="n">Comparable</span> <span class="n">id</span><span class="p">;</span>
    <span class="n">String</span> <span class="n">name</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">yearlyGrossSalary</span><span class="p">;</span>
    <span class="kd">public</span> <span class="nf">Empleado</span><span class="p">(</span><span class="n">String</span> <span class="n">id</span><span class="p">,</span> <span class="n">String</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="nf">setSalary</span><span class="p">(</span> <span class="kt">float</span> <span class="n">s</span> <span class="p">)</span> <span class="p">{</span> <span class="n">yearlyGrossSalary</span><span class="o">=</span><span class="n">s</span><span class="p">;</span> <span class="p">}</span>   
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="n">id</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">name</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">float</span> <span class="nf">computeMonthlySalary</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">yearlyGrossSalary</span><span class="o">/</span><span class="mi">12</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Autonomo</span> <span class="kd">extends</span> <span class="n">Empleado</span> <span class="p">{</span>
    <span class="n">String</span> <span class="n">vatCode</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">workingHours</span><span class="p">;</span>
    <span class="kd">public</span> <span class="nf">Autonomo</span><span class="p">(</span><span class="n">String</span> <span class="n">id</span><span class="p">,</span> <span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">String</span> <span class="n">vat</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">super</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">name</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="na">vatCode</span> <span class="o">=</span> <span class="n">vat</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">workingHours</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">float</span> <span class="nf">computeMonthlySalary</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">workingHours</span><span class="o">*</span><span class="n">Company</span><span class="p">.</span><span class="na">getHourlyRate</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">Company</span><span class="p">.</span><span class="na">getVatRate</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">super</span><span class="p">.</span><span class="na">print</span><span class="p">();</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">vatCode</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Prueba</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Empleado</span> <span class="n">e</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Empleado</span><span class="p">(</span><span class="s">&quot;0001&quot;</span><span class="p">,</span> <span class="s">&quot;Enrique&quot;</span><span class="p">);</span>
      <span class="n">Empleado</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Autonomo</span><span class="p">(</span><span class="s">&quot;0001&quot;</span><span class="p">,</span> <span class="s">&quot;Ana&quot;</span><span class="p">,</span> <span class="s">&quot;12345-A&quot;</span><span class="p">);</span>
      <span class="n">e</span><span class="p">.</span><span class="na">print</span><span class="p">();</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
      <span class="n">a</span><span class="p">.</span><span class="na">print</span><span class="p">();</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>
<h3 id="nominas-v03">Nóminas v0.3<a class="headerlink" href="#nominas-v03" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>  <span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Empleado</span> <span class="p">{</span>
    <span class="cm">/* ... */</span>
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">float</span> <span class="nf">computeMonthlySalary</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Plantilla</span> <span class="kd">extends</span> <span class="n">Empleado</span> <span class="p">{</span>
    <span class="kt">float</span> <span class="n">yearlyGrossSalary</span><span class="p">;</span>
    <span class="cm">/* ... */</span>
    <span class="kt">float</span> <span class="nf">setSalary</span><span class="p">(</span> <span class="kt">float</span> <span class="n">s</span> <span class="p">)</span> <span class="p">{</span> <span class="n">yearlyGrossSalary</span><span class="o">=</span><span class="n">s</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">float</span> <span class="nf">computeMonthlySalary</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">yearlyGrossSalary</span><span class="o">/</span><span class="mi">12</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Autonomo</span> <span class="kd">extends</span> <span class="n">Empleado</span> <span class="p">{</span>
    <span class="n">String</span> <span class="n">vatCode</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">workingHours</span><span class="p">;</span>
    <span class="kd">public</span> <span class="nf">Autonomo</span><span class="p">(</span><span class="n">String</span> <span class="n">id</span><span class="p">,</span> <span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">String</span> <span class="n">vat</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">super</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">name</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="na">vatCode</span> <span class="o">=</span> <span class="n">vat</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">workingHours</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addWorkingHours</span><span class="p">(</span><span class="kt">float</span> <span class="n">workingHours</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="na">workingHours</span> <span class="o">+=</span> <span class="n">workingHours</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">float</span> <span class="nf">computeMonthlySalary</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">workingHours</span><span class="o">*</span><span class="n">Company</span><span class="p">.</span><span class="na">getHourlyRate</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">Company</span><span class="p">.</span><span class="na">getVatRate</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">super</span><span class="p">.</span><span class="na">print</span><span class="p">();</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">vatCode</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Prueba</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Empleado</span> <span class="n">e</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Plantilla</span><span class="p">(</span><span class="s">&quot;0001&quot;</span><span class="p">,</span> <span class="s">&quot;Pepe&quot;</span><span class="p">);</span>
      <span class="n">e</span><span class="p">.</span><span class="na">setSalary</span><span class="p">(</span><span class="mf">25000.0</span><span class="p">);</span>
      <span class="n">Empleado</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Autonomo</span><span class="p">(</span><span class="s">&quot;0001&quot;</span><span class="p">,</span> <span class="s">&quot;Ana&quot;</span><span class="p">,</span> <span class="s">&quot;12345-A&quot;</span><span class="p">);</span>
      <span class="n">a</span><span class="p">.</span><span class="na">addWorkingHours</span><span class="p">(</span><span class="mf">30.0</span><span class="p">);</span>
      <span class="n">e</span><span class="p">.</span><span class="na">print</span><span class="p">();</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot; Salario: &quot;</span><span class="o">+</span><span class="n">e</span><span class="p">.</span><span class="na">computeMonthlySalary</span><span class="p">()</span><span class="o">+</span><span class="s">&quot; EUR&quot;</span><span class="p">);</span>
      <span class="n">a</span><span class="p">.</span><span class="na">print</span><span class="p">();</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot; Salario: &quot;</span><span class="o">+</span><span class="n">a</span><span class="p">.</span><span class="na">computeMonthlySalary</span><span class="p">()</span><span class="o">+</span><span class="s">&quot; EUR&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>
<p><a id="refactoring"></a></p>
<h2 id="refactoring"><span style="color:blue;">Refactoring</span><a class="headerlink" href="#refactoring" title="Permanent link">&para;</a></h2>
<p>Hacer <em>refactoring</em> es hacer pequeñas transformaciones en el código que mantienen el sistema funcional, sin añadir nuevas funcionalidades.</p>
<blockquote>
<p>Refactoring is a disciplined technique for restructuring an existing body of code, altering its internal structure without changing its external behavior</p>
<p>— <cite><a href="http://www.refactoring.com/">M. Fowler</a>, <a href="http://www.refactoring.com">www.refactoring.com</a></cite></p>
<p>A change made to the internal structure of the software to make it easier to understand and cheaper to modify without changing its observable behavior</p>
<p>– <cite><a href="../bibliografia/#refactoring">M. Fowler (2008): Refactoring...</a></cite></p>
</blockquote>
<div class="admonition info">
<p class="admonition-title">Lectura recomendada</p>
<p>Hunt &amp; Thomas. <a href="../bibliografia/#pragmatic">The Pragmatic Programmer</a>, 1999.
Capítulo: <em>Refactoring</em></p>
</div>
<h3 id="motivos-para-refactoring">Motivos para refactoring<a class="headerlink" href="#motivos-para-refactoring" title="Permanent link">&para;</a></h3>
<ul>
<li>Código duplicado</li>
<li>Rutinas demasiado largas</li>
<li>Bucles demasiado largos o demasiado anidados</li>
<li>Clases poco cohesionadas</li>
<li>Interfaz de una clase con un nivel de abstracción poco consistente</li>
<li>Demasiados parámetros en una lista de parámetros</li>
<li>Muchos cambios en una clase tienden a estar compartimentalizados (afectan solo a una parte)</li>
<li>Muchos cambios requieren modificaciones en paralelo a varias clases</li>
<li>Hay que cambiar jerarquías de herencia en paralelo</li>
<li>Hay que cambiar muchas sentencias <em>case</em> en paralelo</li>
<li>Etc.</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Lectura recomendada</p>
<p>McConnell. <a href="../bibliografia/#codecomplete">Code Complete</a>, 2004.</p>
</div>
<details class="question"><summary>¿Cuál es la primera razón para hacer refactoring?</summary><ul>
<li><strong>Código duplicado</strong></li>
</ul>
</details>
<p><a id="duplcode"></a></p>
<h2 id="codigo-duplicado_1"><span style="color:blue;">Código duplicado</span><a class="headerlink" href="#codigo-duplicado_1" title="Permanent link">&para;</a></h2>
<div class="admonition info">
<p class="admonition-title">Lectura recomendada</p>
<p>Hunt &amp; Thomas. <a href="../bibliografia/#pragmatic">The Pragmatic Programmer</a>, 1999.
Capítulo <em>DRY—The Evils of Duplication</em></p>
</div>
<h3 id="por-que-no-duplicar">¿Por qué no duplicar?<a class="headerlink" href="#por-que-no-duplicar" title="Permanent link">&para;</a></h3>
<ul>
<li>Mantenimiento</li>
<li>Cambios (no sólo a nivel de código)</li>
<li>Trazabilidad</li>
</ul>
<h3 id="causas-de-la-duplicacion">Causas de la duplicación<a class="headerlink" href="#causas-de-la-duplicacion" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Impuesta</strong>: No hay elección</li>
<li><strong>Inadvertida</strong>: No me he dado cuenta</li>
<li><strong>Impaciencia</strong>: No puedo esperar</li>
<li><strong>Simultaneidad</strong>: Ha sido otro</li>
</ul>
<h3 id="principio-dry-dont-repeat-yourself"><span style="color:blue;">Principio DRY – <em>Don't Repeat Yourself!</em></span><a class="headerlink" href="#principio-dry-dont-repeat-yourself" title="Permanent link">&para;</a></h3>
<p>by <a href="../bibliografia/#pragmatic">Hunt &amp; Thomas (1999)</a></p>
<blockquote>
<p>Copy and paste is a design error</p>
<p>– <cite> McConnell (1998) </cite></p>
</blockquote>
<h3 id="duplicacion-impuesta">Duplicación impuesta<a class="headerlink" href="#duplicacion-impuesta" title="Permanent link">&para;</a></h3>
<p>La gestión del proyecto así nos lo exige. Algunos ejemplos:</p>
<ul>
<li>Representaciones múltiples de la información:<ul>
<li>varias implementaciones de un TAD que necesita guardar elementos de distintos tipos, cuando el lenguaje no permite genericidad</li>
<li>el esquema de una BD configurado en la BD y en el código fuente a través de un <a href="http://www.agiledata.org/essays/mappingObjects.html">ORM</a></li>
</ul>
</li>
<li>Documentación del código:<ul>
<li>código incrustado en javadocs</li>
</ul>
</li>
<li>Casos de prueba:<ul>
<li>pruebas unitarias con jUnit</li>
</ul>
</li>
<li>Características del lenguaje:<ul>
<li>C/C++ header files</li>
<li>IDL specs</li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Cómo evitaba Java la duplicación en sus <em>containers</em></p>
<p>Cuando el lenguaje no tenía capacidad de usar tipos genéricos (hasta el JDK 1.4), podría aparecer la necesidad de duplicar código a la hora de implementar un TAD contenedor, pues habría que repetir todo el código de manejo del TAD para cada tipo de elemento contenido. Para evitarlo, Java usó un <em>workaround</em>: todas las clases en Java heredan de <code>Object</code>. Así una clase que implementara un TAD contenedor de elementos de otra clase, tan solo tenía que declarar los elementos contenidos de tipo <code>Object</code>. Más tarde (a partir del JDK 1.5) introdujo los tipos genéricos y ya no era necesario usar dicho <em>workaround</em> basado en <code>Object</code> para evitar la duplicación</p>
</div>
<h4 id="tecnicas-de-solucion">Técnicas de solución<a class="headerlink" href="#tecnicas-de-solucion" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Generadores de código</strong>: para evitar duplicar representaciones múltiples de la información</li>
<li>Herramientas de <strong>ingeniería inversa</strong>: para generar código a partir de un esquema de BD – v.g. <a href="https://jeddict.github.io/">jeddict</a> para crear clases JPA, visualizar y modificar BDs y automatizar la generación de código Java EE.</li>
<li><strong>Plantillas</strong>: Tipos genéricos del lenguaje (Java, C++, TypeScript, etc.) o mediante un motor de plantillas – v.g. <a href="http://velocity.apache.org/">Apache Velocity</a> template language (<a href="http://velocity.apache.org/engine/2.0/user-guide.html#velocity-template-language-vtl-an-introduction">VTL</a>)</li>
<li><strong>Metadatos</strong>: Anotaciones @ en Java, decoradores en TypeScript, etc.</li>
<li>Herramientas de <strong>documentación</strong> (v.g. <a href="http://asciidoctor.org/">asciidoctor</a>: <a href="http://asciidoctor.org/docs/asciidoc-syntax-quick-reference/#include-files">inclusión de ficheros</a> y <a href="http://asciidoctor.org/docs/asciidoc-syntax-quick-reference/#source-code">formateo de código fuente</a>).</li>
<li>Herramientas de <strong><a href="http://www.literateprogramming.com/">programación literaria</a></strong></li>
<li>Ayuda del <strong>IDE</strong></li>
<li>Herramientas de <em>property-based testing</em>, como <a href="https://pypi.org/project/hypothesis/">Hypothesis</a> (python), <a href="https://github.com/emil-e/rapidcheck">RapidCheck</a> (C++), <a href="https://jqwik.net/">jqwik</a>  (Java) o <a href="https://en.wikipedia.org/wiki/QuickCheck">QuickCheck</a> (originalmente para Haskell).</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Property-based testing</p>
<ul>
<li>¿Cómo reducir la duplicación de código al programar pruebas unitarias?</li>
<li>Ejemplo de property-based testing con <a href="https://pypi.org/project/hypothesis/">Hypothesis</a> en Python:
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">hypothesis</span> <span class="kn">import</span> <span class="n">given</span>
<span class="kn">import</span> <span class="nn">hypothesis.strategies</span> <span class="k">as</span> <span class="nn">some</span>

<span class="nd">@given</span><span class="p">(</span><span class="n">some</span><span class="o">.</span><span class="n">lists</span><span class="p">(</span><span class="n">some</span><span class="o">.</span><span class="n">integers</span><span class="p">()))</span>
<span class="k">def</span> <span class="nf">test_list_size_is_invariant_across_sorting</span><span class="p">(</span><span class="n">a_list</span><span class="p">):</span>
  <span class="n">original_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a_list</span><span class="p">)</span>
  <span class="n">a_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
  <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">a_list</span><span class="p">)</span> <span class="o">==</span> <span class="n">original_length</span>

<span class="nd">@given</span><span class="p">(</span><span class="n">some</span><span class="o">.</span><span class="n">lists</span><span class="p">(</span><span class="n">some</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>
<span class="k">def</span> <span class="nf">test_sorted_result_is_ordered</span><span class="p">(</span><span class="n">a_list</span><span class="p">):</span>
  <span class="n">a_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">a_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">a_list</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</code></pre></div></li>
<li>Leer el Consejo nº 71 del libro de <a href="../bibliografia/#pragmatic2">Hunt &amp; Thomas (2020)</a>.</li>
</ul>
</div>
<h3 id="duplicacion-inadvertida">Duplicación inadvertida<a class="headerlink" href="#duplicacion-inadvertida" title="Permanent link">&para;</a></h3>
<p>Normalmente tiene origen en un diseño inapropiado.</p>
<p>Fuente de numerosos problemas de integración.</p>
<h4 id="ejemplo-codigo-duplicado-version-1">Ejemplo: código duplicado – versión 1<a class="headerlink" href="#ejemplo-codigo-duplicado-version-1" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Line</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="n">Point</span> <span class="n">start</span><span class="p">;</span>
    <span class="kd">public</span> <span class="n">Point</span> <span class="n">end</span><span class="p">;</span>
    <span class="kd">public</span> <span class="kt">double</span> <span class="n">length</span><span class="p">;</span>
  <span class="p">}</span>
</code></pre></div>
<p><span style="color:red;">¿Dónde está la duplicación?</span></p>
<p>Realmente <code>length</code> ya está definido con <code>start</code>y <code>end</code>. <span style="color:red;">¿Mejor así...?</span></p>
<div class="highlight"><pre><span></span><code>  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Line</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="n">Point</span> <span class="n">start</span><span class="p">;</span>
    <span class="kd">public</span> <span class="n">Point</span> <span class="n">end</span><span class="p">;</span>
    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">length</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">return</span> <span class="n">start</span><span class="p">.</span><span class="na">distanceTo</span><span class="p">(</span><span class="n">end</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>
<p><span style="color:red;">¿Es conveniente aplicar siempre DRY?</span></p>
<p>A veces se puede optar por violar DRY por razones de rendimiento.</p>
<h4 id="ejemplo-aplicando-memoization-version-2">Ejemplo: aplicando memoization – versión 2<a class="headerlink" href="#ejemplo-aplicando-memoization-version-2" title="Permanent link">&para;</a></h4>
<p><a href="https://en.wikipedia.org/wiki/Memoization"><em>Memoization</em></a>: cachear los resultados de cómputos costosos</p>
<div class="highlight"><pre><span></span><code>  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Line</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">changed</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kt">double</span> <span class="n">length</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">Point</span> <span class="n">start</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">Point</span> <span class="n">end</span><span class="p">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setStart</span><span class="p">(</span><span class="n">Point</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span> <span class="n">start</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span> <span class="n">changed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEnd</span><span class="p">(</span><span class="n">Point</span> <span class="n">p</span><span class="p">)</span>   <span class="p">{</span> <span class="n">end</span>   <span class="o">=</span> <span class="n">p</span><span class="p">;</span> <span class="n">changed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">public</span> <span class="n">Point</span> <span class="nf">getStart</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">start</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">public</span> <span class="n">Point</span> <span class="nf">getEnd</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">end</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">getLength</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">if</span> <span class="p">(</span><span class="n">changed</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">length</span> <span class="o">=</span> <span class="n">start</span><span class="p">.</span><span class="na">distanceTo</span><span class="p">(</span><span class="n">end</span><span class="p">);</span>
          <span class="n">changed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
       <span class="p">}</span>
       <span class="k">return</span> <span class="n">length</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>
<p>La técnica de memoization es menos problemática si queda dentro de los límites de la clase/módulo.</p>
<p>Otras veces no merece la pena violar DRY por rendimiento: ¡las cachés y los optimizadores de código también hacen su labor!</p>
<h3 id="principio-de-acceso-uniforme"><span style="color:blue;">Principio de acceso uniforme</span><a class="headerlink" href="#principio-de-acceso-uniforme" title="Permanent link">&para;</a></h3>
<blockquote>
<p>All services offered by a module should be available through a uniform notation, which does not betray whether they are implemented through storage or through computation</p>
<p><cite><a href="../bibliografia/#meyer">B. Meyer</a></cite></p>
</blockquote>
<p>Conviene aplicar el principio de acceso uniforme para que sea más fácil añadir mejoras de rendimiento (v.g. caching)</p>
<h4 id="ejemplo-acceso-uniforme-en-c-version-3">Ejemplo: acceso uniforme en C# – versión 3<a class="headerlink" href="#ejemplo-acceso-uniforme-en-c-version-3" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Line</span> <span class="p">{</span>
  <span class="k">private</span> <span class="n">Point</span> <span class="n">Start</span><span class="p">;</span>
  <span class="k">private</span> <span class="n">Point</span> <span class="n">End</span><span class="p">;</span>
  <span class="k">private</span> <span class="kt">double</span> <span class="n">Length</span><span class="p">;</span>

  <span class="k">public</span> <span class="n">Point</span> <span class="n">Start</span> <span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Start</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">set</span> <span class="p">{</span> <span class="n">Start</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="n">Point</span> <span class="n">End</span> <span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">End</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">set</span> <span class="p">{</span> <span class="n">Start</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="kt">double</span> <span class="n">Length</span> <span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Start</span><span class="p">.</span><span class="n">distanceTo</span><span class="p">(</span><span class="n">End</span><span class="p">);</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="duplicacion-por-impaciencia">Duplicación por impaciencia<a class="headerlink" href="#duplicacion-por-impaciencia" title="Permanent link">&para;</a></h3>
<ul>
<li>Los peligros del <em>copy&amp;paste</em></li>
<li>"Vísteme despacio que tengo prisa" (<em>shortcuts make for long delays</em>). Ejemplos:<ul>
<li>Meter el <code>main</code> de Java en cualquier clase</li>
<li>Fiasco del año 2000</li>
</ul>
</li>
</ul>
<h3 id="duplicacion-por-simultaneidad">Duplicación por simultaneidad<a class="headerlink" href="#duplicacion-por-simultaneidad" title="Permanent link">&para;</a></h3>
<ul>
<li>No resoluble a nivel de técnicas de construcción</li>
<li>Hace falta metodología, gestión de equipos + herramientas de comunicación</li>
</ul>
<p><a id="ortogonalidad"></a></p>
<h2 id="ortogonalidad"><span style="color:blue;">Ortogonalidad</span><a class="headerlink" href="#ortogonalidad" title="Permanent link">&para;</a></h2>
<p>Dos componentes A y B son ortogonales (<span><span class="MathJax_Preview">A \perp B</span><script type="math/tex">A \perp B</script></span>) si los cambios en uno no afectan al otro. Suponen más independencia y menos acoplamiento. Por ejemplo:</p>
<ul>
<li>La base de datos debe ser ortogonal a la interfaz de usuario</li>
<li>En un helicóptero, los mandos de control no suelen ser ortogonales</li>
</ul>
<div class="admonition quote">
<p class="admonition-title">A Nonorthogonal System (<a href="../bibliografia/#pragmatic2">Hunt, 2019</a>)</p>
<p>Helicopters have four basic controls. The cyclic is the stick you hold in your right hand. Move it, and the helicopter moves in the corresponding direction. Your left hand holds the collective pitch lever. Pull up on this and you increase the pitch on all the blades, generating lift. At the end of the pitch lever is the throttle. Finally you have two foot pedals, which vary the amount of tail rotor thrust and so help turn the helicopter.</p>
<p>“Easy!,” you think. “Gently lower the collective pitch lever and you’ll descend gracefully to the ground, a hero.” However, when you try it, you discover that life isn’t that simple. The helicopter’s nose drops, and you start to spiral down to the left. Suddenly you discover that you’re flying a system where every control input has secondary effects. Lower the left-hand lever and you need to add compensating backward movement to the right-hand stick and push the right pedal. But then each of these changes affects all of the other controls again. Suddenly you’re juggling an unbelievably complex system, where every change impacts all the other inputs. Your workload is phenomenal: your hands and feet are constantly moving, trying to balance all the interacting forces.</p>
<p>Helicopter controls are decidedly not orthogonal.</p>
</div>
<h3 id="beneficios-de-la-ortogonalidad">Beneficios de la ortogonalidad<a class="headerlink" href="#beneficios-de-la-ortogonalidad" title="Permanent link">&para;</a></h3>
<h4 id="mayor-productividad">Mayor productividad<a class="headerlink" href="#mayor-productividad" title="Permanent link">&para;</a></h4>
<ul>
<li>Es más fácil escribir un componente pequeño y auto-contenido que un bloque muy grande de código. El tiempo de desarrollo y <strong>pruebas</strong> se reduce</li>
<li>Se pueden combinar unos componentes con otros más fácilmente. Mayor <strong>reutilización</strong>.</li>
<li>En teoría, si <span><span class="MathJax_Preview">A \perp B</span><script type="math/tex">A \perp B</script></span>, el componente A sirve para <span><span class="MathJax_Preview">m</span><script type="math/tex">m</script></span> propósitos y B sirve para <span><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span>, entonces <span><span class="MathJax_Preview">A \cup B</span><script type="math/tex">A \cup B</script></span> sirve para <span><span class="MathJax_Preview">m \times n</span><script type="math/tex">m \times n</script></span> propósitos.</li>
<li>La falta de cohesión perjudica la reutilización &rarr; ¿y si hay que hacer una nueva versión gráfica de una aplicación de línea de comandos que lleva incrustada la escritura en consola con <code>System.out.println</code>? Pueden descohesionar!</li>
</ul>
<h4 id="menor-riesgo">Menor riesgo<a class="headerlink" href="#menor-riesgo" title="Permanent link">&para;</a></h4>
<ul>
<li>Defectos aislados, más fáciles de arreglar</li>
<li>Menor <strong>fragilidad</strong> del sistema global. Los problemas provocados por cambios en un área se limitan a ese área</li>
<li>Más fácil de <strong>probar</strong>, pues será más fácil construir pruebas individuales de cada uno de sus componentes (por ejemplo, las técnicas de <em><a href="https://en.wikipedia.org/wiki/Mock_object">mocking</a></em> son más sencillas)</li>
</ul>
<h3 id="niveles-de-aplicacion-de-la-ortogonalizad">Niveles de aplicación de la ortogonalizad<a class="headerlink" href="#niveles-de-aplicacion-de-la-ortogonalizad" title="Permanent link">&para;</a></h3>
<p>La ortogonalidad es aplicable a:</p>
<ul>
<li>el diseño</li>
<li>la codificación</li>
<li>las pruebas</li>
<li>bibliotecas</li>
<li>la documentación</li>
</ul>
<p>A nivel de <em>diseño</em>, los patrones de diseño y las arquitecturas como MVC facilitan la construcción de componentes ortogonales.</p>
<div class="admonition note">
<p class="admonition-title">Lectura recomendada</p>
<p>Leer el <a href="https://learning-oreilly-com.bibezproxy.uca.es/library/view/the-pragmatic-programmer/9780135956977/f_0028.xhtml#orthogonality">Topic 10: Orthogonality</a> de (<a href="../bibliografia/#pragmatic2">Hunt, 2019</a>).</p>
</div>
<h3 id="tecnicas-de-codificacion">Técnicas de codificación<a class="headerlink" href="#tecnicas-de-codificacion" title="Permanent link">&para;</a></h3>
<p>Técnicas de codificación para fomentar la ortogonalidad:</p>
<ul>
<li>Hacer <strong>refactoring</strong></li>
<li>Codificar <strong>patrones</strong> de diseño: strategy, template method, etc.</li>
<li>Evitar datos globales y <strong>singletons</strong>: ¿qué pasaría si hubiera que hacer una versión <em>multithreaded</em> de una aplicación?</li>
<li><strong>Inyectar</strong>: pasar explícitamente el contexto (dependencia) como parámetro a los constructores</li>
<li>Usar <strong>anotaciones</strong> (Java), decoradores (TypeScript) o atributos (C#)</li>
<li><strong>Desacoplar</strong>: Ley de <span><em>Demeter</em></span>—No hables con extraños</li>
<li>Usar programación orientada a <strong>aspectos</strong></li>
</ul>
<h4 id="desacoplar-ley-de-demeter">Desacoplar - ley de Demeter<a class="headerlink" href="#desacoplar-ley-de-demeter" title="Permanent link">&para;</a></h4>
<p>Al pedir un servicio a un objeto, el servicio debe ser realizado de parte nuestra, no que nos devuelva un tercero con el que tratar para realizarlo</p>
<p><strong>Ejemplo</strong>:</p>
<div class="highlight"><pre><span></span><code>  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">canWrite</span><span class="p">(</span><span class="n">User</span> <span class="n">user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">isAnonymous</span><span class="p">())</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">user</span><span class="p">.</span><span class="na">getGroup</span><span class="p">().</span><span class="na">hasPermission</span><span class="p">(</span><span class="n">Permission</span><span class="p">.</span><span class="na">WRITE</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>
<p>Refactorización: definir un método <code>User.hasPermission()</code></p>
<div class="admonition note">
<p class="admonition-title">Lectura recomendada</p>
<p>Leer el <a href="https://learning-oreilly-com.bibezproxy.uca.es/library/view/the-pragmatic-programmer/9780135956977/f_0049.xhtml#coupling">Topic 28: Decoupling</a> de (<a href="../bibliografia/#pragmatic2">Hunt, 2019</a>).</p>
</div>
<h4 id="inyectar-el-contexto">Inyectar el contexto<a class="headerlink" href="#inyectar-el-contexto" title="Permanent link">&para;</a></h4>
<p>Pasar explícitamente el contexto (dependencia) como parámetro a los constructores de la clase</p>
<h5 id="ejemplo-patron-estrategia">Ejemplo: patrón estrategia<a class="headerlink" href="#ejemplo-patron-estrategia" title="Permanent link">&para;</a></h5>
<p>En el patrón de diseño <em>strategy</em>, pasar el contexto a la estrategia en su creación</p>
<h5 id="ejemplo-caballeros-de-la-mesa-redonda">Ejemplo: caballeros de la mesa redonda<a class="headerlink" href="#ejemplo-caballeros-de-la-mesa-redonda" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Knight</span> <span class="p">{</span>
  <span class="n">Object</span> <span class="nf">embarkOnQuest</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">QuestFailedException</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">KnightOfTheRoundTable</span> <span class="kd">implements</span> <span class="n">Knight</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">Quest</span> <span class="n">quest</span><span class="p">;</span>
  <span class="kd">public</span> <span class="nf">KnightOfTheRoundTable</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">Quest</span> <span class="n">quest</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">quest</span> <span class="o">=</span> <span class="n">quest</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">embarkOnQuest</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">QuestFailedException</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">quest</span><span class="p">.</span><span class="na">embark</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setQuest</span><span class="p">(</span><span class="n">Quest</span> <span class="n">quest</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">quest</span> <span class="o">=</span> <span class="n">quest</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Quest</span> <span class="p">{</span>
  <span class="kd">abstract</span> <span class="n">Object</span> <span class="nf">embark</span><span class="p">()</span>
    <span class="kd">throws</span> <span class="n">QuestFailedException</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="ley-de-demeter-para-funciones">Ley de Demeter para funciones<a class="headerlink" href="#ley-de-demeter-para-funciones" title="Permanent link">&para;</a></h4>
<p>Los métodos de un objeto solo deben hacer llamadas a métodos...</p>
<p>caso 1. <strong>propios</strong> 
caso 2. de objetos pasados como <strong>parámetros</strong>
caso 3. de objetos <strong>creados</strong> por ellos mismos
caso 4. de objetos <strong>declarados</strong> en el mismo método</p>
<div class="highlight"><pre><span></span><code><span class="kd">class</span> <span class="nc">Demeter</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="n">A</span> <span class="n">a</span><span class="p">;</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="nf">func</span><span class="p">();</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">example</span> <span class="p">(</span><span class="n">B</span> <span class="n">b</span><span class="p">);</span>

  <span class="kt">void</span> <span class="nf">example</span><span class="p">(</span><span class="n">B</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">C</span> <span class="n">c</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">f</span> <span class="o">=</span> <span class="n">func</span><span class="p">();</span>  <span class="c1">// (caso 1)</span>
    <span class="n">b</span><span class="p">.</span><span class="na">invert</span><span class="p">();</span>      <span class="c1">// (caso 2)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">A</span><span class="p">();</span>
    <span class="n">a</span><span class="p">.</span><span class="na">setActive</span><span class="p">();</span>   <span class="c1">// (caso 3)</span>
    <span class="n">c</span><span class="p">.</span><span class="na">print</span><span class="p">();</span>       <span class="c1">// (caso 4)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="interfaces-fluent">Interfaces <em>fluent</em><a class="headerlink" href="#interfaces-fluent" title="Permanent link">&para;</a></h4>
<div class="admonition warning">
<p class="admonition-title">Excepción a la ley de Demeter</p>
<p>Hay una excepción notable a la prohibición de encadenar llamadas a funciones de la ley de Demeter. Esta regla no aplica si es muy poco probable que haya cambios en las cosas que se encadenan. En la práctica, cualquier parte de tu aplicación debe considerarse como algo que es probable que cambie; cualquier elemento de una biblioteca de un tercero debe considerarse volátil, en particular si quienes mantienen dicha biblioteca suelen cambiar su API de una versión a otra.</p>
</div>
<p>Las librerías que vienen con el lenguaje suelen ser bastante estables, así que ejemplos de código como el siguiente son aceptables como excepción a esta interpretación de la ley de Demeter:</p>
<div class="highlight"><pre><span></span><code><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">myList</span> <span class="o">=</span>
    <span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&quot;a1&quot;</span><span class="p">,</span> <span class="s">&quot;a2&quot;</span><span class="p">,</span> <span class="s">&quot;b1&quot;</span><span class="p">,</span> <span class="s">&quot;c2&quot;</span><span class="p">,</span> <span class="s">&quot;c1&quot;</span><span class="p">);</span>

<span class="n">myList</span>
    <span class="p">.</span><span class="na">stream</span><span class="p">()</span>
    <span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">s</span> <span class="o">-&gt;</span> <span class="n">s</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">))</span>
    <span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">String</span><span class="p">::</span><span class="n">toUpperCase</span><span class="p">)</span>
    <span class="p">.</span><span class="na">sorted</span><span class="p">()</span>
    <span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">::</span><span class="n">println</span><span class="p">);</span>
</code></pre></div>
<p>Los métodos <code>stream</code>, <code>filter</code>, <code>map</code>, <code>sorted</code> y <code>forEach</code> son parte de las nuevas <em>interfaces funcionales</em> para manejar <em>streams</em>, incorporadas a las colecciones (v.g. <code>List</code>) del lenguaje desde la versión Java 8. Este tipo de interfaces como la del API de streams de Java se conoce como <a href="https://en.wikipedia.org/wiki/Fluent_interface"><em>fluent interfaces</em></a>.</p>
<div class="admonition warning">
<p class="admonition-title">La programación con streams se tratará en el capítulo sobre <a href="../iiss-evp/">Programación basada en Eventos</a></p>
</div>
<div class="admonition warning">
<p class="admonition-title">Las interfaces funcionales se tratarán en el capítulo sobre <a href="../iiss-fp/">Programación Funcional</a></p>
</div>
<h4 id="criticas-a-la-ley-de-demeter">Críticas a la ley de Demeter<a class="headerlink" href="#criticas-a-la-ley-de-demeter" title="Permanent link">&para;</a></h4>
<p>La ley de Demeter, ¿realmente ayuda a crear código más mantenible?</p>
<h5 id="ejemplo-pintar-graficos-de-grabadoras">Ejemplo: pintar gráficos de grabadoras<a class="headerlink" href="#ejemplo-pintar-graficos-de-grabadoras" title="Permanent link">&para;</a></h5>
<ul>
<li>Pintar un gráfico con los datos registrados por una serie de grabadoras (<code>Recorder</code>) dispersas por el mundo.</li>
<li>Cada grabadora está en una ubicación (<code>Location</code>), que tiene una zona horaria (<code>TimeZone</code>).</li>
<li>Los usuarios seleccionan (<code>Selection</code>) una grabadora y pintan sus datos etiquetados con la zona horaria correcta...</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">plotDate</span><span class="p">(</span><span class="n">Date</span> <span class="n">aDate</span><span class="p">,</span> <span class="n">Selection</span> <span class="n">aSelection</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">TimeZone</span> <span class="n">tz</span> <span class="o">=</span> <span class="n">aSelection</span><span class="p">.</span><span class="na">getRecorder</span><span class="p">().</span><span class="na">getLocation</span><span class="p">().</span><span class="na">getZone</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<h5 id="criticas">Críticas<a class="headerlink" href="#criticas" title="Permanent link">&para;</a></h5>
<ul>
<li>Multiplicidad de dependencias: <code>plotDate</code> <span><span class="MathJax_Preview">\dashrightarrow</span><script type="math/tex">\dashrightarrow</script></span> <code>Selection</code>, <code>Recorder</code>, <code>Location</code>, <code>TimeZone</code>.</li>
<li>Si cambia la implementación de <code>Location</code> de forma que ya no incluye directamente una <code>TimeZone</code>, hay que cambiar <code>plotDate</code></li>
<li>Añadir un método <em>delegado</em> <code>getTimeZone</code> a <code>Selection</code>. Así <code>plotDate</code> no se entera de si la <code>TimeZone</code> le llega desde <code>Recorder</code> o desde un objeto contenido en <code>Recorder</code>.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">plotDate</span><span class="p">(</span><span class="n">Date</span> <span class="n">aDate</span><span class="p">,</span> <span class="n">TimeZone</span> <span class="n">tz</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/* ... */</span>
<span class="p">}</span>
<span class="n">plotDate</span><span class="p">(</span><span class="n">someDate</span><span class="p">,</span> <span class="n">someSelection</span><span class="p">.</span><span class="na">getTimeZone</span><span class="p">());</span>
</code></pre></div>
<p>Ahora <code>plotDate</code> <span><span class="MathJax_Preview">\dashrightarrow</span><script type="math/tex">\dashrightarrow</script></span> <code>Selection</code>, <code>TimeZone</code>, pero se han eliminado las restantes dependencias.</p>
<ul>
<li>Costes de espacio y ejecución de métodos <em>wrapper</em> que reenvían la petición al objeto delegado: violar la ley de Demeter para mejorar el <strong>rendimiento</strong></li>
<li>Otros ejemplos de mejora del rendimiento: desnormalización de BBDD</li>
</ul>
<h3 id="ortogonalidad-en-toolkits-y-bibliotecas">Ortogonalidad en toolkits y bibliotecas<a class="headerlink" href="#ortogonalidad-en-toolkits-y-bibliotecas" title="Permanent link">&para;</a></h3>
<p>Muchas bibliotecas actuales implementan la ortogonalidad a través de metadatos, o atributos o etiquetas (@ <em>tag</em>), también llamados <a href="../iiss-oop-3/#dependencias-en-java">anotaciones</a> en Java y <a href="../iiss-oop-3/#decoradores-en-typescript">decoradores</a> en TypeScript.</p>
<p>Los metadatos se emplean para proporcionar propósitos específicos, como v.g. persistencia de objetos, transacciones, etc. Por ejemplo, Spring o EJB utilizan anotaciones @ declarativas para expresar la transaccionalidad de una operación o la persistencia de una propiedad de una clase fuera del método que debe ejecutar dichas funcionalidades.</p>
<p>Otro método para implementar la ortogonalidad es usar <a href="../iiss-aop/">Aspectos</a> y <em>Aspect-Oriented Programming</em> (AOP). Este método es empleado por el framework Spring.</p>
<div class="admonition warning">
<p class="admonition-title">Estudiar ahora el capítulo <a href="../iiss-aop/">Aspectos</a></p>
</div>
<div class="admonition warning">
<p class="admonition-title">Estudiar luego el capítulo <a href="../iiss-err/">Calidad</a></p>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../iiss-oop-3/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Inyección
              </div>
            </div>
          </a>
        
        
          <a href="../iiss-err/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Calidad
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/dodero" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.53cc9318.min.js"></script>
      <script src="../assets/javascripts/bundle.e9c9f54f.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: ['navigation.sections'],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>