



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Apuntes de Implementación e Implantación de Sistemas Software – Grado en Ingeniería Informática">
      
      
      
        <meta name="author" content="Juan Manuel Dodero">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-4.6.3">
    
    
      
        <title>Duplicación - Implementación e Implantación de Sistemas Software</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.adb8469c.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#caso-4-codigo-duplicado" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Implementación e Implantación de Sistemas Software" aria-label="Implementación e Implantación de Sistemas Software" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Implementación e Implantación de Sistemas Software
            </span>
            <span class="md-header-nav__topic">
              
                Duplicación
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/dodero/gii-dss-iiss/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Implementación e Implantación de Sistemas Software" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Implementación e Implantación de Sistemas Software
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/dodero/gii-dss-iiss/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Inicio" class="md-nav__link">
      Inicio
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Asignatura
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Asignatura
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../iiss-pres/" title="Presentación" class="md-nav__link">
      Presentación
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bibliografia/" title="Bibliografía" class="md-nav__link">
      Bibliografía
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../about/" title="About" class="md-nav__link">
      About
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      I. Objetos
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        I. Objetos
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../iiss-oop-1/" title="Principios" class="md-nav__link">
      Principios
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../iiss-oop-2/" title="Delegación" class="md-nav__link">
      Delegación
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../iiss-oop-3/" title="Inyección" class="md-nav__link">
      Inyección
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Duplicación
      </label>
    
    <a href="./" title="Duplicación" class="md-nav__link md-nav__link--active">
      Duplicación
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#calculo-de-nominas" class="md-nav__link">
    Cálculo de nóminas
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementacion-de-nominas-v01" class="md-nav__link">
    Implementación de nóminas v0.1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nominas-v02" class="md-nav__link">
    Nóminas v0.2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nominas-v03" class="md-nav__link">
    Nóminas v0.3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#refactoring" class="md-nav__link">
    Refactoring
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#motivos-para-refactoring" class="md-nav__link">
    Motivos para refactoring
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#codigo-duplicado" class="md-nav__link">
    Código duplicado
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#por-que-no-duplicar" class="md-nav__link">
    ¿Por qué no duplicar?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#causas-de-la-duplicacion" class="md-nav__link">
    Causas de la duplicación
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#principio-dry-dont-repeat-yourself" class="md-nav__link">
    Principio DRY – Don't Repeat Yourself!
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#duplicacion-impuesta" class="md-nav__link">
    Duplicación impuesta
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tecnicas-de-solucion" class="md-nav__link">
    Técnicas de solución
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#duplicacion-inadvertida" class="md-nav__link">
    Duplicación inadvertida
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ejemplo-codigo-duplicado-version-1" class="md-nav__link">
    Ejemplo: código duplicado – versión 1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplo-aplicando-memoization-version-2" class="md-nav__link">
    Ejemplo: aplicando memoization – versión 2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#principio-de-acceso-uniforme" class="md-nav__link">
    Principio de acceso uniforme
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ejemplo-acceso-uniforme-en-c-version-3" class="md-nav__link">
    Ejemplo: acceso uniforme en C# – versión 3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#duplicacion-por-impaciencia" class="md-nav__link">
    Duplicación por impaciencia
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#duplicacion-por-simultaneidad" class="md-nav__link">
    Duplicación por simultaneidad
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ortogonalidad" class="md-nav__link">
    Ortogonalidad
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#beneficios-de-la-ortogonalidad" class="md-nav__link">
    Beneficios de la ortogonalidad
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mayor-productividad" class="md-nav__link">
    Mayor productividad
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#menor-riesgo" class="md-nav__link">
    Menor riesgo
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#niveles-de-aplicacion-de-la-ortogonalizad" class="md-nav__link">
    Niveles de aplicación de la ortogonalizad
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tecnicas-de-codificacion" class="md-nav__link">
    Técnicas de codificación
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#desacoplar-ley-de-demeter" class="md-nav__link">
    Desacoplar - ley de Demeter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inyectar-el-contexto" class="md-nav__link">
    Inyectar el contexto
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ejemplo-patron-estrategia" class="md-nav__link">
    Ejemplo: patrón estrategia
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplo-caballeros-de-la-mesa-redonda" class="md-nav__link">
    Ejemplo: caballeros de la mesa redonda
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ley-de-demeter-para-funciones" class="md-nav__link">
    Ley de Demeter para funciones
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#criticas-a-la-ley-de-demeter" class="md-nav__link">
    Críticas a la ley de Demeter
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ejemplo-pintar-graficos-de-grabadoras" class="md-nav__link">
    Ejemplo: pintar gráficos de grabadoras
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#criticas" class="md-nav__link">
    Críticas
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolkits-y-bibliotecas" class="md-nav__link">
    Toolkits y bibliotecas
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#errores-y-excepciones" class="md-nav__link">
    Errores y Excepciones
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tratamiento-de-errores" class="md-nav__link">
    Tratamiento de errores
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#codigos-de-error" class="md-nav__link">
    Códigos de error
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#excepciones" class="md-nav__link">
    Excepciones
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#separar-la-funcion-y-el-tratamiento-de-errores" class="md-nav__link">
    Separar la función y el tratamiento de errores
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#excepciones-en-java" class="md-nav__link">
    Excepciones en Java
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tratamiento-de-excepciones-en-java" class="md-nav__link">
    Tratamiento de excepciones en Java
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recomendaciones" class="md-nav__link">
    Recomendaciones
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transformacion-de-excepciones" class="md-nav__link">
    Transformación de excepciones
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#checked-vs-unchecked" class="md-nav__link">
    Checked vs unchecked
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#solucion" class="md-nav__link">
    Solución
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#excepciones-encapsuladas" class="md-nav__link">
    Excepciones encapsuladas
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#las-excepciones-son-excepcionales" class="md-nav__link">
    Las excepciones son excepcionales
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uso-de-null" class="md-nav__link">
    Uso de null
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#principio-general-no-devolver-null" class="md-nav__link">
    Principio general: no devolver null
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-devolver-null" class="md-nav__link">
    No devolver null
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-pasar-valores-null" class="md-nav__link">
    No pasar valores null
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alternativa-con-aserciones" class="md-nav__link">
    Alternativa con aserciones
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optionals" class="md-nav__link">
    Optionals
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scala-options" class="md-nav__link">
    Scala Options
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#java-8-optionals" class="md-nav__link">
    Java 8 Optionals
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ejemplo-sin-optional" class="md-nav__link">
    Ejemplo sin Optional
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplo-con-optionals" class="md-nav__link">
    Ejemplo con Optionals
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fronteras" class="md-nav__link">
    Fronteras
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../iiss-aop/" title="II. Aspectos" class="md-nav__link">
      II. Aspectos
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../iiss-dbc/" title="III. Contratos" class="md-nav__link">
      III. Contratos
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../iiss-fp/" title="IV. Funciones" class="md-nav__link">
      IV. Funciones
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../iiss-evp/" title="V. Eventos" class="md-nav__link">
      V. Eventos
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#calculo-de-nominas" class="md-nav__link">
    Cálculo de nóminas
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementacion-de-nominas-v01" class="md-nav__link">
    Implementación de nóminas v0.1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nominas-v02" class="md-nav__link">
    Nóminas v0.2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nominas-v03" class="md-nav__link">
    Nóminas v0.3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#refactoring" class="md-nav__link">
    Refactoring
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#motivos-para-refactoring" class="md-nav__link">
    Motivos para refactoring
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#codigo-duplicado" class="md-nav__link">
    Código duplicado
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#por-que-no-duplicar" class="md-nav__link">
    ¿Por qué no duplicar?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#causas-de-la-duplicacion" class="md-nav__link">
    Causas de la duplicación
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#principio-dry-dont-repeat-yourself" class="md-nav__link">
    Principio DRY – Don't Repeat Yourself!
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#duplicacion-impuesta" class="md-nav__link">
    Duplicación impuesta
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tecnicas-de-solucion" class="md-nav__link">
    Técnicas de solución
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#duplicacion-inadvertida" class="md-nav__link">
    Duplicación inadvertida
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ejemplo-codigo-duplicado-version-1" class="md-nav__link">
    Ejemplo: código duplicado – versión 1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplo-aplicando-memoization-version-2" class="md-nav__link">
    Ejemplo: aplicando memoization – versión 2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#principio-de-acceso-uniforme" class="md-nav__link">
    Principio de acceso uniforme
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ejemplo-acceso-uniforme-en-c-version-3" class="md-nav__link">
    Ejemplo: acceso uniforme en C# – versión 3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#duplicacion-por-impaciencia" class="md-nav__link">
    Duplicación por impaciencia
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#duplicacion-por-simultaneidad" class="md-nav__link">
    Duplicación por simultaneidad
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ortogonalidad" class="md-nav__link">
    Ortogonalidad
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#beneficios-de-la-ortogonalidad" class="md-nav__link">
    Beneficios de la ortogonalidad
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mayor-productividad" class="md-nav__link">
    Mayor productividad
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#menor-riesgo" class="md-nav__link">
    Menor riesgo
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#niveles-de-aplicacion-de-la-ortogonalizad" class="md-nav__link">
    Niveles de aplicación de la ortogonalizad
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tecnicas-de-codificacion" class="md-nav__link">
    Técnicas de codificación
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#desacoplar-ley-de-demeter" class="md-nav__link">
    Desacoplar - ley de Demeter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inyectar-el-contexto" class="md-nav__link">
    Inyectar el contexto
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ejemplo-patron-estrategia" class="md-nav__link">
    Ejemplo: patrón estrategia
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplo-caballeros-de-la-mesa-redonda" class="md-nav__link">
    Ejemplo: caballeros de la mesa redonda
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ley-de-demeter-para-funciones" class="md-nav__link">
    Ley de Demeter para funciones
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#criticas-a-la-ley-de-demeter" class="md-nav__link">
    Críticas a la ley de Demeter
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ejemplo-pintar-graficos-de-grabadoras" class="md-nav__link">
    Ejemplo: pintar gráficos de grabadoras
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#criticas" class="md-nav__link">
    Críticas
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#toolkits-y-bibliotecas" class="md-nav__link">
    Toolkits y bibliotecas
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#errores-y-excepciones" class="md-nav__link">
    Errores y Excepciones
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tratamiento-de-errores" class="md-nav__link">
    Tratamiento de errores
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#codigos-de-error" class="md-nav__link">
    Códigos de error
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#excepciones" class="md-nav__link">
    Excepciones
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#separar-la-funcion-y-el-tratamiento-de-errores" class="md-nav__link">
    Separar la función y el tratamiento de errores
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#excepciones-en-java" class="md-nav__link">
    Excepciones en Java
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tratamiento-de-excepciones-en-java" class="md-nav__link">
    Tratamiento de excepciones en Java
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recomendaciones" class="md-nav__link">
    Recomendaciones
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transformacion-de-excepciones" class="md-nav__link">
    Transformación de excepciones
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#checked-vs-unchecked" class="md-nav__link">
    Checked vs unchecked
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#solucion" class="md-nav__link">
    Solución
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#excepciones-encapsuladas" class="md-nav__link">
    Excepciones encapsuladas
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#las-excepciones-son-excepcionales" class="md-nav__link">
    Las excepciones son excepcionales
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uso-de-null" class="md-nav__link">
    Uso de null
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#principio-general-no-devolver-null" class="md-nav__link">
    Principio general: no devolver null
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-devolver-null" class="md-nav__link">
    No devolver null
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-pasar-valores-null" class="md-nav__link">
    No pasar valores null
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alternativa-con-aserciones" class="md-nav__link">
    Alternativa con aserciones
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optionals" class="md-nav__link">
    Optionals
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scala-options" class="md-nav__link">
    Scala Options
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#java-8-optionals" class="md-nav__link">
    Java 8 Optionals
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ejemplo-sin-optional" class="md-nav__link">
    Ejemplo sin Optional
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplo-con-optionals" class="md-nav__link">
    Ejemplo con Optionals
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fronteras" class="md-nav__link">
    Fronteras
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/dodero/gii-dss-iiss/edit/master/docs/iiss-oop-4.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h0>OBJETOS - Código duplicado</h0>
<p><a id="caso4"></a></p>
<h1 id="caso-4-codigo-duplicado">Caso 4 - Código duplicado<a class="headerlink" href="#caso-4-codigo-duplicado" title="Permanent link">&para;</a></h1>
<h2 id="calculo-de-nominas">Cálculo de nóminas<a class="headerlink" href="#calculo-de-nominas" title="Permanent link">&para;</a></h2>
<p><a id="nominas"></a></p>
<h3 id="implementacion-de-nominas-v01">Implementación de nóminas v0.1<a class="headerlink" href="#implementacion-de-nominas-v01" title="Permanent link">&para;</a></h3>
<details class="question"><summary>En la siguiente implementación, ¿dónde hay código duplicado?</summary><ul>
<li>Código duplicado en los constructores de las clases y subclases</li>
<li>Refactorizar delegando hacia la superclase</li>
</ul>
</details>
<div class="codehilite"><pre><span></span><code>  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Empleado</span> <span class="p">{</span>
    <span class="n">Comparable</span> <span class="n">id</span><span class="p">;</span>
    <span class="n">String</span> <span class="n">name</span><span class="p">;</span>
    <span class="kd">public</span> <span class="nf">Empleado</span><span class="p">(</span><span class="n">String</span> <span class="n">id</span><span class="p">,</span> <span class="n">String</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">id</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">name</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Autonomo</span> <span class="kd">extends</span> <span class="n">Empleado</span> <span class="p">{</span>
    <span class="n">String</span> <span class="n">vatCode</span><span class="p">;</span>
    <span class="kd">public</span> <span class="nf">Autonomo</span><span class="p">(</span><span class="n">String</span> <span class="n">id</span><span class="p">,</span> <span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">String</span> <span class="n">vat</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">vatCode</span> <span class="o">=</span> <span class="n">vat</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">id</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">vatCode</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Prueba</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Empleado</span> <span class="n">e</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Empleado</span><span class="p">(</span><span class="s">&quot;0001&quot;</span><span class="p">,</span><span class="s">&quot;Enrique&quot;</span><span class="p">);</span>
      <span class="n">Empleado</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Autonomo</span><span class="p">(</span><span class="s">&quot;0002&quot;</span><span class="p">,</span><span class="s">&quot;Ana&quot;</span><span class="p">,</span><span class="s">&quot;12345-A&quot;</span><span class="p">);</span>
      <span class="n">e</span><span class="p">.</span><span class="na">print</span><span class="p">();</span>  
      <span class="n">a</span><span class="p">.</span><span class="na">print</span><span class="p">();</span>  
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>

<h3 id="nominas-v02">Nóminas v0.2<a class="headerlink" href="#nominas-v02" title="Permanent link">&para;</a></h3>
<ul>
<li>Requisito: los trabajadores autónomos cobran por horas (no tienen un salario fijo bruto)</li>
<li>Incluimos el método <code>computeMonthlySalary</code> para el cálculo de la nómina mensual</li>
</ul>
<details class="question"><summary>¿Están descohesionadas las clases?</summary><ul>
<li>¿Todos los empleados deben tener un salario anual <code>yearlyGrossSalary</code> bruto? Los autónomos no...</li>
<li>El método de cálculo del salario está descohesionado</li>
</ul>
</details>
<div class="codehilite"><pre><span></span><code>  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Empleado</span> <span class="p">{</span>
    <span class="n">Comparable</span> <span class="n">id</span><span class="p">;</span>
    <span class="n">String</span> <span class="n">name</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">yearlyGrossSalary</span><span class="p">;</span>
    <span class="kd">public</span> <span class="nf">Empleado</span><span class="p">(</span><span class="n">String</span> <span class="n">id</span><span class="p">,</span> <span class="n">String</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="nf">setSalary</span><span class="p">(</span> <span class="kt">float</span> <span class="n">s</span> <span class="p">)</span> <span class="p">{</span> <span class="n">yearlyGrossSalary</span><span class="o">=</span><span class="n">s</span><span class="p">;</span> <span class="p">}</span>   
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="n">id</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">name</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">float</span> <span class="nf">computeMonthlySalary</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">yearlyGrossSalary</span><span class="o">/</span><span class="mi">12</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Autonomo</span> <span class="kd">extends</span> <span class="n">Empleado</span> <span class="p">{</span>
    <span class="n">String</span> <span class="n">vatCode</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">workingHours</span><span class="p">;</span>
    <span class="kd">public</span> <span class="nf">Autonomo</span><span class="p">(</span><span class="n">String</span> <span class="n">id</span><span class="p">,</span> <span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">String</span> <span class="n">vat</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">super</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">name</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="na">vatCode</span> <span class="o">=</span> <span class="n">vat</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">workingHours</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">float</span> <span class="nf">computeMonthlySalary</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">workingHours</span><span class="o">*</span><span class="n">Company</span><span class="p">.</span><span class="na">getHourlyRate</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">Company</span><span class="p">.</span><span class="na">getVatRate</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">super</span><span class="p">.</span><span class="na">print</span><span class="p">();</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">vatCode</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Prueba</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Empleado</span> <span class="n">e</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Empleado</span><span class="p">(</span><span class="s">&quot;0001&quot;</span><span class="p">,</span> <span class="s">&quot;Enrique&quot;</span><span class="p">);</span>
      <span class="n">Empleado</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Autonomo</span><span class="p">(</span><span class="s">&quot;0001&quot;</span><span class="p">,</span> <span class="s">&quot;Ana&quot;</span><span class="p">,</span> <span class="s">&quot;12345-A&quot;</span><span class="p">);</span>
      <span class="n">e</span><span class="p">.</span><span class="na">print</span><span class="p">();</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
      <span class="n">a</span><span class="p">.</span><span class="na">print</span><span class="p">();</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>

<h3 id="nominas-v03">Nóminas v0.3<a class="headerlink" href="#nominas-v03" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>  <span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Empleado</span> <span class="p">{</span>
    <span class="cm">/* ... */</span>
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">float</span> <span class="nf">computeMonthlySalary</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Plantilla</span> <span class="kd">extends</span> <span class="n">Empleado</span> <span class="p">{</span>
    <span class="kt">float</span> <span class="n">yearlyGrossSalary</span><span class="p">;</span>
    <span class="cm">/* ... */</span>
    <span class="kt">float</span> <span class="nf">setSalary</span><span class="p">(</span> <span class="kt">float</span> <span class="n">s</span> <span class="p">)</span> <span class="p">{</span> <span class="n">yearlyGrossSalary</span><span class="o">=</span><span class="n">s</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">float</span> <span class="nf">computeMonthlySalary</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">yearlyGrossSalary</span><span class="o">/</span><span class="mi">12</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Autonomo</span> <span class="kd">extends</span> <span class="n">Empleado</span> <span class="p">{</span>
    <span class="n">String</span> <span class="n">vatCode</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">workingHours</span><span class="p">;</span>
    <span class="kd">public</span> <span class="nf">Autonomo</span><span class="p">(</span><span class="n">String</span> <span class="n">id</span><span class="p">,</span> <span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">String</span> <span class="n">vat</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">super</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">name</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="na">vatCode</span> <span class="o">=</span> <span class="n">vat</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">workingHours</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addWorkingHours</span><span class="p">(</span><span class="kt">float</span> <span class="n">workingHours</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="na">workingHours</span> <span class="o">+=</span> <span class="n">workingHours</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">float</span> <span class="nf">computeMonthlySalary</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">workingHours</span><span class="o">*</span><span class="n">Company</span><span class="p">.</span><span class="na">getHourlyRate</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">Company</span><span class="p">.</span><span class="na">getVatRate</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">super</span><span class="p">.</span><span class="na">print</span><span class="p">();</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">vatCode</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Prueba</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Empleado</span> <span class="n">e</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Plantilla</span><span class="p">(</span><span class="s">&quot;0001&quot;</span><span class="p">,</span> <span class="s">&quot;Pepe&quot;</span><span class="p">);</span>
      <span class="n">e</span><span class="p">.</span><span class="na">setSalary</span><span class="p">(</span><span class="mf">25000.0</span><span class="p">);</span>
      <span class="n">Empleado</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Autonomo</span><span class="p">(</span><span class="s">&quot;0001&quot;</span><span class="p">,</span> <span class="s">&quot;Ana&quot;</span><span class="p">,</span> <span class="s">&quot;12345-A&quot;</span><span class="p">);</span>
      <span class="n">a</span><span class="p">.</span><span class="na">addWorkingHours</span><span class="p">(</span><span class="mf">30.0</span><span class="p">);</span>
      <span class="n">e</span><span class="p">.</span><span class="na">print</span><span class="p">();</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot; Salario: &quot;</span><span class="o">+</span><span class="n">e</span><span class="p">.</span><span class="na">computeMonthlySalary</span><span class="p">()</span><span class="o">+</span><span class="s">&quot; EUR&quot;</span><span class="p">);</span>
      <span class="n">a</span><span class="p">.</span><span class="na">print</span><span class="p">();</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot; Salario: &quot;</span><span class="o">+</span><span class="n">a</span><span class="p">.</span><span class="na">computeMonthlySalary</span><span class="p">()</span><span class="o">+</span><span class="s">&quot; EUR&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>

<p><a id="refactoring"></a></p>
<h2 id="refactoring"><span style="color:blue;">Refactoring</span><a class="headerlink" href="#refactoring" title="Permanent link">&para;</a></h2>
<p>Hacer <em>refactoring</em> es hacer pequeñas transformaciones en el código que mantienen el sistema funcional, sin añadir nuevas funcionalidades.</p>
<blockquote>
<p>Refactoring is a disciplined technique for restructuring an existing body of code, altering its internal structure without changing its external behavior</p>
<p>— <cite><a href="http://www.refactoring.com/">M. Fowler</a>, <a href="http://www.refactoring.com">www.refactoring.com</a></cite></p>
<p>A change made to the internal structure of the software to make it easier to understand and cheaper to modify without changing its observable behavior</p>
<p>– <cite><a href="../bibliografia/#refactoring">M. Fowler (2008): Refactoring...</a></cite></p>
</blockquote>
<div class="admonition info">
<p class="admonition-title">Lectura recomendada</p>
<p>Hunt &amp; Thomas. <a href="../bibliografia/#pragmatic">The Pragmatic Programmer</a>, 1999.
Capítulo: <em>Refactoring</em></p>
</div>
<h3 id="motivos-para-refactoring">Motivos para refactoring<a class="headerlink" href="#motivos-para-refactoring" title="Permanent link">&para;</a></h3>
<ul>
<li>Código duplicado</li>
<li>Rutinas demasiado largas</li>
<li>Bucles demasiado largos o demasiado anidados</li>
<li>Clases poco cohesionadas</li>
<li>Interfaz de una clase con un nivel de abstracción poco consistente</li>
<li>Demasiados parámetros en una lista de parámetros</li>
<li>Muchos cambios en una clase tienden a estar compartimentalizados (afectan solo a una parte)</li>
<li>Muchos cambios requieren modificaciones en paralelo a varias clases</li>
<li>Hay que cambiar jerarquías de herencia en paralelo</li>
<li>Hay que cambiar muchas sentencias <em>case</em> en paralelo</li>
<li>Etc.</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Lectura recomendada</p>
<p>McConnell. <a href="../bibliografia/#codecomplete">Code Complete</a>, 2004.</p>
</div>
<details class="question"><summary>¿Cuál es la primera razón para hacer refactoring?</summary><ul>
<li><strong>Código duplicado</strong></li>
</ul>
</details>
<p><a id="duplcode"></a></p>
<h2 id="codigo-duplicado"><span style="color:blue;">Código duplicado</span><a class="headerlink" href="#codigo-duplicado" title="Permanent link">&para;</a></h2>
<div class="admonition info">
<p class="admonition-title">Lectura recomendada</p>
<p>Hunt &amp; Thomas. <a href="../bibliografia/#pragmatic">The Pragmatic Programmer</a>, 1999.
Capítulo <em>DRY—The Evils of Duplication</em></p>
</div>
<h3 id="por-que-no-duplicar">¿Por qué no duplicar?<a class="headerlink" href="#por-que-no-duplicar" title="Permanent link">&para;</a></h3>
<ul>
<li>Mantenimiento</li>
<li>Cambios (no sólo a nivel de código)</li>
<li>Trazabilidad</li>
</ul>
<h3 id="causas-de-la-duplicacion">Causas de la duplicación<a class="headerlink" href="#causas-de-la-duplicacion" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Impuesta</strong>: No hay elección</li>
<li><strong>Inadvertida</strong>: No me he dado cuenta</li>
<li><strong>Impaciencia</strong>: No puedo esperar</li>
<li><strong>Simultaneidad</strong>: Ha sido otro</li>
</ul>
<h3 id="principio-dry-dont-repeat-yourself"><span style="color:blue;">Principio DRY – <em>Don't Repeat Yourself!</em></span><a class="headerlink" href="#principio-dry-dont-repeat-yourself" title="Permanent link">&para;</a></h3>
<p>by <a href="../bibliografia/#pragmatic">Hunt &amp; Thomas (1999)</a></p>
<blockquote>
<p>Copy and paste is a design error</p>
<p>– <cite> McConnell (1998) </cite></p>
</blockquote>
<h3 id="duplicacion-impuesta">Duplicación impuesta<a class="headerlink" href="#duplicacion-impuesta" title="Permanent link">&para;</a></h3>
<p>La gestión del proyecto así nos lo exige. Algunos ejemplos:</p>
<ul>
<li>Representaciones múltiples de la información:<ul>
<li>varias implementaciones de un TAD que necesita guardar elementos de distintos tipos, cuando el lenguaje no permite genericidad</li>
<li>el esquema de una BD configurado en la BD y en el código fuente a través de un <a href="http://www.agiledata.org/essays/mappingObjects.html">ORM</a></li>
</ul>
</li>
<li>Documentación del código:<ul>
<li>código incrustado en javadocs</li>
</ul>
</li>
<li>Casos de prueba:<ul>
<li>pruebas unitarias con jUnit</li>
</ul>
</li>
<li>Características del lenguaje:<ul>
<li>C/C++ header files</li>
<li>IDL specs</li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Cómo evitaba Java la duplicación en sus <em>containers</em></p>
<p>Cuando el lenguaje no tenía capacidad de usar tipos genéricos (hasta el JDK 1.4), podría aparecer la necesidad de duplicar código a la hora de implementar un TAD contenedor, pues habría que repetir todo el código de manejo del TAD para cada tipo de elemento contenido. Para evitarlo, Java usó un <em>workaround</em>: todas las clases en Java heredan de <code>Object</code>. Así una clase que implementara un TAD contenedor de elementos de otra clase, tan solo tenía que declarar los elementos contenidos de tipo <code>Object</code>. Más tarde (a partir del JDK 1.5) introdujo los tipos genéricos y ya no era necesario usar dicho <em>workaround</em> basado en <code>Object</code> para evitar la duplicación</p>
</div>
<h4 id="tecnicas-de-solucion">Técnicas de solución<a class="headerlink" href="#tecnicas-de-solucion" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Generadores de código</strong>: para evitar duplicar representaciones múltiples de la información</li>
<li>Herramientas de <strong>ingeniería inversa</strong>: para generar código a partir de un esquema de BD – v.g. <a href="https://jeddict.github.io/">jeddict</a> para crear clases JPA, visualizar y modificar BDs y automatizar la generación de código Java EE.</li>
<li><strong>Plantillas</strong>: Tipos genéricos del lenguaje (Java, C++, TypeScript, etc.) o mediante un motor de plantillas – v.g. <a href="http://velocity.apache.org/">Apache Velocity</a> template language (<a href="http://velocity.apache.org/engine/2.0/user-guide.html#velocity-template-language-vtl-an-introduction">VTL</a>)</li>
<li><strong>Metadatos</strong>: Anotaciones @ en Java, decoradores en TypeScript, etc.</li>
<li>Herramientas de <strong>documentación</strong> (v.g. <a href="http://asciidoctor.org/">asciidoctor</a>: <a href="http://asciidoctor.org/docs/asciidoc-syntax-quick-reference/#include-files">inclusión de ficheros</a> y <a href="http://asciidoctor.org/docs/asciidoc-syntax-quick-reference/#source-code">formateo de código fuente</a>).</li>
<li>Herramientas de <strong><a href="http://www.literateprogramming.com/">programación literaria</a></strong></li>
<li>Ayuda del <strong>IDE</strong></li>
</ul>
<h3 id="duplicacion-inadvertida">Duplicación inadvertida<a class="headerlink" href="#duplicacion-inadvertida" title="Permanent link">&para;</a></h3>
<p>Normalmente tiene origen en un diseño inapropiado.</p>
<p>Fuente de numerosos problemas de integración.</p>
<h4 id="ejemplo-codigo-duplicado-version-1">Ejemplo: código duplicado – versión 1<a class="headerlink" href="#ejemplo-codigo-duplicado-version-1" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code>  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Line</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="n">Point</span> <span class="n">start</span><span class="p">;</span>
    <span class="kd">public</span> <span class="n">Point</span> <span class="n">end</span><span class="p">;</span>
    <span class="kd">public</span> <span class="kt">double</span> <span class="n">length</span><span class="p">;</span>
  <span class="p">}</span>
</code></pre></div>

<p><span style="color:red;">¿Dónde está la duplicación?</span></p>
<p>Realmente <code>length</code> ya está definido con <code>start</code>y <code>end</code>. <span style="color:red;">¿Mejor así...?</span></p>
<div class="codehilite"><pre><span></span><code>  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Line</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="n">Point</span> <span class="n">start</span><span class="p">;</span>
    <span class="kd">public</span> <span class="n">Point</span> <span class="n">end</span><span class="p">;</span>
    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">length</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">return</span> <span class="n">start</span><span class="p">.</span><span class="na">distanceTo</span><span class="p">(</span><span class="n">end</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>

<p><span style="color:red;">¿Es conveniente aplicar siempre DRY?</span></p>
<p>A veces se puede optar por violar DRY por razones de rendimiento.</p>
<h4 id="ejemplo-aplicando-memoization-version-2">Ejemplo: aplicando memoization – versión 2<a class="headerlink" href="#ejemplo-aplicando-memoization-version-2" title="Permanent link">&para;</a></h4>
<p><a href="https://en.wikipedia.org/wiki/Memoization"><em>Memoization</em></a>: cachear los resultados de cómputos costosos</p>
<div class="codehilite"><pre><span></span><code>  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Line</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">changed</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kt">double</span> <span class="n">length</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">Point</span> <span class="n">start</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">Point</span> <span class="n">end</span><span class="p">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setStart</span><span class="p">(</span><span class="n">Point</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span> <span class="n">start</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span> <span class="n">changed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEnd</span><span class="p">(</span><span class="n">Point</span> <span class="n">p</span><span class="p">)</span>   <span class="p">{</span> <span class="n">end</span>   <span class="o">=</span> <span class="n">p</span><span class="p">;</span> <span class="n">changed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">public</span> <span class="n">Point</span> <span class="nf">getStart</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">start</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">public</span> <span class="n">Point</span> <span class="nf">getEnd</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">end</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">getLength</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">if</span> <span class="p">(</span><span class="n">changed</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">length</span> <span class="o">=</span> <span class="n">start</span><span class="p">.</span><span class="na">distanceTo</span><span class="p">(</span><span class="n">end</span><span class="p">);</span>
          <span class="n">changed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
       <span class="p">}</span>
       <span class="k">return</span> <span class="n">length</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>

<p>La técnica de memoization es menos problemática si queda dentro de los límites de la clase/módulo.</p>
<p>Otras veces no merece la pena violar DRY por rendimiento: ¡las cachés y los optimizadores de código también hacen su labor!</p>
<h3 id="principio-de-acceso-uniforme"><span style="color:blue;">Principio de acceso uniforme</span><a class="headerlink" href="#principio-de-acceso-uniforme" title="Permanent link">&para;</a></h3>
<blockquote>
<p>All services offered by a module should be available through a uniform notation, which does not betray whether they are implemented through storage or through computation</p>
<p><cite><a href="../bibliografia/#meyer">B. Meyer</a></cite></p>
</blockquote>
<p>Conviene aplicar el principio de acceso uniforme para que sea más fácil añadir mejoras de rendimiento (v.g. caching)</p>
<h4 id="ejemplo-acceso-uniforme-en-c-version-3">Ejemplo: acceso uniforme en C# – versión 3<a class="headerlink" href="#ejemplo-acceso-uniforme-en-c-version-3" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Line</span> <span class="p">{</span>
  <span class="k">private</span> <span class="n">Point</span> <span class="n">Start</span><span class="p">;</span>
  <span class="k">private</span> <span class="n">Point</span> <span class="n">End</span><span class="p">;</span>
  <span class="k">private</span> <span class="kt">double</span> <span class="n">Length</span><span class="p">;</span>

  <span class="k">public</span> <span class="n">Point</span> <span class="n">Start</span> <span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Start</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">set</span> <span class="p">{</span> <span class="n">Start</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="n">Point</span> <span class="n">End</span> <span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">End</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">set</span> <span class="p">{</span> <span class="n">Start</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="kt">double</span> <span class="n">Length</span> <span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Start</span><span class="p">.</span><span class="n">distanceTo</span><span class="p">(</span><span class="n">End</span><span class="p">);</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="duplicacion-por-impaciencia">Duplicación por impaciencia<a class="headerlink" href="#duplicacion-por-impaciencia" title="Permanent link">&para;</a></h3>
<ul>
<li>Los peligros del <em>copy&amp;paste</em></li>
<li>"Vísteme despacio que tengo prisa" (<em>shortcuts make for long delays</em>). Ejemplos:<ul>
<li>Meter el <code>main</code> de Java en cualquier clase</li>
<li>Fiasco del año 2000</li>
</ul>
</li>
</ul>
<h3 id="duplicacion-por-simultaneidad">Duplicación por simultaneidad<a class="headerlink" href="#duplicacion-por-simultaneidad" title="Permanent link">&para;</a></h3>
<ul>
<li>No resoluble a nivel de técnicas de construcción</li>
<li>Hace falta metodología, gestión de equipos + herramientas de comunicación</li>
</ul>
<p><a id="ortogonalidad"></a></p>
<h2 id="ortogonalidad"><span style="color:blue;">Ortogonalidad</span><a class="headerlink" href="#ortogonalidad" title="Permanent link">&para;</a></h2>
<p>Dos componentes A y B son ortogonales (<span><span class="MathJax_Preview">A \perp B</span><script type="math/tex">A \perp B</script></span>) si los cambios en uno no afectan al otro. Suponen más independencia y menos acoplamiento. Por ejemplo:</p>
<ul>
<li>La base de datos debe ser ortogonal a la interfaz de usuario</li>
<li>En un helicóptero, los mandos de control no suelen ser ortogonales</li>
</ul>
<h3 id="beneficios-de-la-ortogonalidad">Beneficios de la ortogonalidad<a class="headerlink" href="#beneficios-de-la-ortogonalidad" title="Permanent link">&para;</a></h3>
<h4 id="mayor-productividad">Mayor productividad<a class="headerlink" href="#mayor-productividad" title="Permanent link">&para;</a></h4>
<ul>
<li>Es más fácil escribir un componente pequeño y auto-contenido que un bloque muy grande de código. El tiempo de desarrollo y <strong>pruebas</strong> se reduce</li>
<li>Se pueden combinar unos componentes con otros más fácilmente. Mayor <strong>reutilización</strong>.</li>
<li>Si <span><span class="MathJax_Preview">A \perp B</span><script type="math/tex">A \perp B</script></span>, el componente A sirve para <span><span class="MathJax_Preview">m</span><script type="math/tex">m</script></span> propósitos y B sirve para <span><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span>, entonces <span><span class="MathJax_Preview">A \cup B</span><script type="math/tex">A \cup B</script></span> sirve para <span><span class="MathJax_Preview">m \times n</span><script type="math/tex">m \times n</script></span> propósitos.</li>
<li>La falta de cohesión perjudica la reutilización – v.g. ¿y si hay que hacer una nueva versión gráfica de una aplicación de línea de comandos? (los <code>System.out.println</code> pueden descohesionar)</li>
</ul>
<h4 id="menor-riesgo">Menor riesgo<a class="headerlink" href="#menor-riesgo" title="Permanent link">&para;</a></h4>
<ul>
<li>Defectos aislados, más fáciles de arreglar</li>
<li>Menor <strong>fragilidad</strong> del sistema global, los problemas provocados por cambios en un área se limitan a ese área</li>
<li>Más fácil de <strong>probar</strong>, pues será más fácil construir pruebas individuales de cada uno de sus componentes (e.g. <em>mocking</em> es más sencillo)</li>
</ul>
<h3 id="niveles-de-aplicacion-de-la-ortogonalizad">Niveles de aplicación de la ortogonalizad<a class="headerlink" href="#niveles-de-aplicacion-de-la-ortogonalizad" title="Permanent link">&para;</a></h3>
<p>La ortogonalidad es aplicable a:</p>
<ul>
<li>la gestión de proyectos</li>
<li>el diseño</li>
<li>la codificación</li>
<li>las pruebas</li>
<li>la documentación</li>
</ul>
<p>A nivel de <em>diseño</em>, los patrones de diseño y las arquitecturas como MVC facilitan la construcción de componentes ortogonales.</p>
<h3 id="tecnicas-de-codificacion">Técnicas de codificación<a class="headerlink" href="#tecnicas-de-codificacion" title="Permanent link">&para;</a></h3>
<p>Técnicas de codificación para fomentar la ortogonalidad:</p>
<ul>
<li>Hacer <strong>refactoring</strong></li>
<li>Codificar <strong>patrones</strong> de diseño: strategy, template method, etc.</li>
<li>Evitar datos globales y <strong>singletons</strong>: ¿qué pasaría si hubiera que hacer una versión <em>multithreaded</em> de una aplicación?</li>
<li><strong>Inyectar</strong>: pasar explícitamente el contexto (dependencia) como parámetro a los constructores</li>
<li>Usar <strong>anotaciones</strong> (Java), decoradores (JavaScript) o atributos (C#)</li>
<li><strong>Desacoplar</strong>: Ley de <span><em>Demeter</em></span>—No hables con extraños</li>
<li>Usar programación orientada a <strong>aspectos</strong></li>
</ul>
<h4 id="desacoplar-ley-de-demeter">Desacoplar - ley de Demeter<a class="headerlink" href="#desacoplar-ley-de-demeter" title="Permanent link">&para;</a></h4>
<p>Al pedir un servicio a un objeto, el servicio debe ser realizado de parte nuestra, no que nos devuelva un tercero con el que tratar para realizarlo</p>
<p><strong>Ejemplo</strong>:</p>
<div class="codehilite"><pre><span></span><code>  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">canWrite</span><span class="p">(</span><span class="n">User</span> <span class="n">user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">isAnonymous</span><span class="p">())</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">user</span><span class="p">.</span><span class="na">getGroup</span><span class="p">().</span><span class="na">hasPermission</span><span class="p">(</span><span class="n">Permission</span><span class="p">.</span><span class="na">WRITE</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>

<p>Refactorización: definir un método <code>User.hasPermission()</code></p>
<h4 id="inyectar-el-contexto">Inyectar el contexto<a class="headerlink" href="#inyectar-el-contexto" title="Permanent link">&para;</a></h4>
<p>Pasar explícitamente el contexto (dependencia) como parámetro a los constructores de la clase</p>
<h5 id="ejemplo-patron-estrategia">Ejemplo: patrón estrategia<a class="headerlink" href="#ejemplo-patron-estrategia" title="Permanent link">&para;</a></h5>
<p>En el patrón de diseño <em>strategy</em>, pasar el contexto a la estrategia en su creación</p>
<h5 id="ejemplo-caballeros-de-la-mesa-redonda">Ejemplo: caballeros de la mesa redonda<a class="headerlink" href="#ejemplo-caballeros-de-la-mesa-redonda" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Knight</span> <span class="p">{</span>
  <span class="n">Object</span> <span class="nf">embarkOnQuest</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">QuestFailedException</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">KnightOfTheRoundTable</span> <span class="kd">implements</span> <span class="n">Knight</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">Quest</span> <span class="n">quest</span><span class="p">;</span>
  <span class="kd">public</span> <span class="nf">KnightOfTheRoundTable</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">Quest</span> <span class="n">quest</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">quest</span> <span class="o">=</span> <span class="n">quest</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">embarkOnQuest</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">QuestFailedException</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">quest</span><span class="p">.</span><span class="na">embark</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setQuest</span><span class="p">(</span><span class="n">Quest</span> <span class="n">quest</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">quest</span> <span class="o">=</span> <span class="n">quest</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Quest</span> <span class="p">{</span>
  <span class="kd">abstract</span> <span class="n">Object</span> <span class="nf">embark</span><span class="p">()</span>
    <span class="kd">throws</span> <span class="n">QuestFailedException</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="ley-de-demeter-para-funciones">Ley de Demeter para funciones<a class="headerlink" href="#ley-de-demeter-para-funciones" title="Permanent link">&para;</a></h4>
<p>Los métodos de un objeto solo deben hacer llamadas a métodos...</p>
<p>caso 1. <strong>propios</strong> 
caso 2. de objetos pasados como <strong>parámetros</strong>
caso 3. de objetos <strong>creados</strong> por ellos mismos
caso 4. de objetos <strong>declarados</strong> en el mismo método</p>
<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">Demeter</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="n">A</span> <span class="n">a</span><span class="p">;</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="nf">func</span><span class="p">();</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">example</span> <span class="p">(</span><span class="n">B</span> <span class="n">b</span><span class="p">);</span>

  <span class="kt">void</span> <span class="nf">example</span><span class="p">(</span><span class="n">B</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">C</span> <span class="n">c</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">f</span> <span class="o">=</span> <span class="n">func</span><span class="p">();</span>  <span class="c1">// (caso 1)</span>
    <span class="n">b</span><span class="p">.</span><span class="na">invert</span><span class="p">();</span>      <span class="c1">// (caso 2)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">A</span><span class="p">();</span>
    <span class="n">a</span><span class="p">.</span><span class="na">setActive</span><span class="p">();</span>   <span class="c1">// (caso 3)</span>
    <span class="n">c</span><span class="p">.</span><span class="na">print</span><span class="p">();</span>       <span class="c1">// (caso 4)</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="criticas-a-la-ley-de-demeter">Críticas a la ley de Demeter<a class="headerlink" href="#criticas-a-la-ley-de-demeter" title="Permanent link">&para;</a></h4>
<p>La ley de Demeter, ¿realmente ayuda a crear código más mantenible?</p>
<h5 id="ejemplo-pintar-graficos-de-grabadoras">Ejemplo: pintar gráficos de grabadoras<a class="headerlink" href="#ejemplo-pintar-graficos-de-grabadoras" title="Permanent link">&para;</a></h5>
<ul>
<li>Pintar un gráfico con los datos registrados por una serie de grabadoras (<code>Recorder</code>) dispersas por el mundo.</li>
<li>Cada grabadora está en una ubicación (<code>Location</code>), que tiene una zona horaria (<code>TimeZone</code>).</li>
<li>Los usuarios seleccionan (<code>Selection</code>) una grabadora y pintan sus datos etiquetados con la zona horaria correcta...</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">plotDate</span><span class="p">(</span><span class="n">Date</span> <span class="n">aDate</span><span class="p">,</span> <span class="n">Selection</span> <span class="n">aSelection</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">TimeZone</span> <span class="n">tz</span> <span class="o">=</span> <span class="n">aSelection</span><span class="p">.</span><span class="na">getRecorder</span><span class="p">().</span><span class="na">getLocation</span><span class="p">().</span><span class="na">getZone</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

<h5 id="criticas">Críticas<a class="headerlink" href="#criticas" title="Permanent link">&para;</a></h5>
<ul>
<li>Multiplicidad de dependencias: <code>plotDate</code> <span><span class="MathJax_Preview">\dashrightarrow</span><script type="math/tex">\dashrightarrow</script></span> <code>Selection</code>, <code>Recorder</code>, <code>Location</code>, <code>TimeZone</code>.</li>
<li>Si cambia la implementación de <code>Location</code> de forma que ya no incluye directamente una <code>TimeZone</code>, hay que cambiar <code>plotDate</code></li>
<li>Añadir un método <em>delegado</em> <code>getTimeZone</code> a <code>Selection</code>. Así <code>plotDate</code> no se entera de si la <code>TimeZone</code> le llega desde <code>Recorder</code> o desde un objeto contenido en <code>Recorder</code>.</li>
</ul>
<p><div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">plotDate</span><span class="p">(</span><span class="n">Date</span> <span class="n">aDate</span><span class="p">,</span> <span class="n">TimeZone</span> <span class="n">tz</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/* ... */</span>
<span class="p">}</span>
<span class="n">plotDate</span><span class="p">(</span><span class="n">someDate</span><span class="p">,</span> <span class="n">someSelection</span><span class="p">.</span><span class="na">getTimeZone</span><span class="p">());</span>
</code></pre></div>
  Ahora <code>plotDate</code> <span><span class="MathJax_Preview">\dashrightarrow</span><script type="math/tex">\dashrightarrow</script></span> <code>Selection</code>, <code>TimeZone</code>, pero se han eliminado las restantes dependencias.
- Costes de espacio y ejecución de métodos <em>wrapper</em> que reenvían la petición al objeto delegado: violar la ley de Demeter para mejorar el <strong>rendimiento</strong>
- Otros ejemplos de mejora del rendimiento: desnormalización de BBDD</p>
<h2 id="toolkits-y-bibliotecas">Toolkits y bibliotecas<a class="headerlink" href="#toolkits-y-bibliotecas" title="Permanent link">&para;</a></h2>
<ul>
<li>Usar metadatos (@tag) para propósitos específicos – v.g. persistencia de objetos, transacciones, etc.</li>
<li><a href="../iiss-aop/">Aspect-Oriented Programming (AOP)</a></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Ver ahora el capítulo <a href="../iiss-aop/">Aspectos</a></p>
</div>
<div class="admonition warning">
<p class="admonition-title">Ver luego el capítulo <a href="../iiss-dbc/">Contratos</a></p>
</div>
<h2 id="errores-y-excepciones"><span style="color:blue;">Errores y Excepciones</span><a class="headerlink" href="#errores-y-excepciones" title="Permanent link">&para;</a></h2>
<p><a id="errores"></a></p>
<h3 id="tratamiento-de-errores">Tratamiento de errores<a class="headerlink" href="#tratamiento-de-errores" title="Permanent link">&para;</a></h3>
<h4 id="codigos-de-error">Códigos de error<a class="headerlink" href="#codigos-de-error" title="Permanent link">&para;</a></h4>
<p>Un ejemplo habitual de tratamiento de errores con <strong>códigos de error</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">if</span> <span class="p">(</span><span class="n">deletePage</span><span class="p">(</span><span class="n">page</span><span class="p">)</span> <span class="o">==</span> <span class="n">E_OK</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">registry</span><span class="p">.</span><span class="na">deleteReference</span><span class="p">(</span><span class="n">page</span><span class="p">.</span><span class="na">name</span><span class="p">)</span> <span class="o">==</span> <span class="n">E_OK</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">configKeys</span><span class="p">.</span><span class="na">deleteKey</span><span class="p">(</span><span class="n">page</span><span class="p">.</span><span class="na">name</span><span class="p">.</span><span class="na">makeKey</span><span class="p">())</span> <span class="o">==</span> <span class="n">E_OK</span><span class="p">){</span>
      <span class="n">logger</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="s">&quot;page deleted&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">logger</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="s">&quot;configKey not deleted&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">logger</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="s">&quot;deleteReference from registry failed&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="n">logger</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="s">&quot;delete failed&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">E_ERROR</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>Con esta técnica creamos <em>imanes de dependencias</em>:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kd">enum</span> <span class="n">Error</span> <span class="p">{</span>
  <span class="n">OK</span><span class="p">,</span>
  <span class="n">INVALID</span><span class="p">,</span>
  <span class="n">NO_SUCH</span><span class="p">,</span>
  <span class="n">LOCKED</span><span class="p">,</span>
  <span class="n">OUT_OF_RESOURCES</span><span class="p">,</span>
  <span class="n">WAITING_FOR_EVENT</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>Los programadores intentan evitar añadir nuevos motivos de error, porque eso significa tener que volver a compilar y desplegar todo el código.</p>
<h4 id="excepciones">Excepciones<a class="headerlink" href="#excepciones" title="Permanent link">&para;</a></h4>
<p>Usar <strong>excepciones</strong> en lugar de códigos de error:</p>
<div class="codehilite"><pre><span></span><code><span class="k">try</span> <span class="p">{</span>
  <span class="n">deletePage</span><span class="p">(</span><span class="n">page</span><span class="p">);</span>
  <span class="n">registry</span><span class="p">.</span><span class="na">deleteReference</span><span class="p">(</span><span class="n">page</span><span class="p">.</span><span class="na">name</span><span class="p">);</span>
  <span class="n">configKeys</span><span class="p">.</span><span class="na">deleteKey</span><span class="p">(</span><span class="n">page</span><span class="p">.</span><span class="na">name</span><span class="p">.</span><span class="na">makeKey</span><span class="p">());</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">logger</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div>

<p>¿No queda más claro?</p>
<p>Ventaja: las nuevas excepciones son derivadas de una clase base <code>Exception</code>, lo que facilita la definición de nuevos motivos de error.</p>
<p><span style="color:red;">¿Dónde se produce el error?</span></p>
<h4 id="separar-la-funcion-y-el-tratamiento-de-errores">Separar la función y el tratamiento de errores<a class="headerlink" href="#separar-la-funcion-y-el-tratamiento-de-errores" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="p">(</span><span class="n">Page</span> <span class="n">page</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">deletePageAndAllReferences</span><span class="p">(</span><span class="n">page</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">logError</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">private</span> <span class="kt">void</span> <span class="nf">deletePageAndAllReferences</span><span class="p">(</span><span class="n">Page</span> <span class="n">page</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
  <span class="n">deletePage</span><span class="p">(</span><span class="n">page</span><span class="p">);</span>
  <span class="n">registry</span><span class="p">.</span><span class="na">deleteReference</span><span class="p">(</span><span class="n">page</span><span class="p">.</span><span class="na">name</span><span class="p">);</span>
  <span class="n">configKeys</span><span class="p">.</span><span class="na">deleteKey</span><span class="p">(</span><span class="n">page</span><span class="p">.</span><span class="na">name</span><span class="p">.</span><span class="na">makeKey</span><span class="p">());</span>
<span class="p">}</span>

<span class="kd">private</span> <span class="kt">void</span> <span class="nf">logError</span><span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">logger</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div>

<p>¿No queda más fácil de comprender, modificar y depurar?</p>
<h3 id="excepciones-en-java">Excepciones en Java<a class="headerlink" href="#excepciones-en-java" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>Checked</strong>: instancias de clases derivadas de <code>java.lang.Throwable</code> (menos <code>RuntimeException</code>). Deben declararse en el método mediante <code>throws</code> y obligan al llamador a tratar la excepción.</p>
</li>
<li>
<p><strong>Unchecked</strong>: instancias de clases derivadas de <code>java.lang.RuntimeException</code>. No se declaran en el método y no obligan al llamador a tratar la excepción.</p>
</li>
</ul>
<p>Elevar una excepción <code>e</code> implica:</p>
<ul>
<li>Deshacer (<em>roll back</em>) la llamada a un método</li>
<li>hasta que se encuentre un bloque catch para el tipo de <code>e</code></li>
<li>y, si no se encuentra, la excepción es capturada por la JVM, que detiene el programa</li>
</ul>
<h4 id="tratamiento-de-excepciones-en-java">Tratamiento de excepciones en Java<a class="headerlink" href="#tratamiento-de-excepciones-en-java" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code>  <span class="k">try</span> <span class="p">{</span>
      <span class="cm">/* guarded region that can send</span>
<span class="cm">        IOException or Exception */</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">IOException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="cm">/* decide what to do when an IOException</span>
<span class="cm">        or a sub-class of IOException occurs */</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Treats any other exceptions</span>
  <span class="p">}</span>
  <span class="k">finally</span> <span class="p">{</span>
      <span class="c1">// in all cases execute this</span>
  <span class="p">}</span>
</code></pre></div>

<h3 id="recomendaciones">Recomendaciones<a class="headerlink" href="#recomendaciones" title="Permanent link">&para;</a></h3>
<p>Incluir el <strong>contexto</strong> de la ejecución:</p>
<ul>
<li>Incluir información suficiente con cada excepción para determinar el motivo y la ubicación de un error</li>
<li>No basta con el <em>stack trace</em></li>
<li>Escribir mensajes informativos: operación fallida y tipo de fallo</li>
</ul>
<p>Usar solamente excepciones <strong>unchecked</strong></p>
<ul>
<li>C#, C++, Python o Ruby no ofrecen excepciones <em>checked</em>.</li>
<li>Los beneficios de las checked en Java son mínimos</li>
<li>Se paga el precio de violar el principio OCP (Open-Closed Principle): si lanzamos una excepción <em>checked</em> desde un método y el <code>catch</code> está tres niveles por encima, hay que declarar la excepción en la signatura de todos los métodos que van entre medias. Esto significa que un cambio en un nivel bajo del software puede forzar cambios en niveles altos</li>
</ul>
<h3 id="transformacion-de-excepciones">Transformación de excepciones<a class="headerlink" href="#transformacion-de-excepciones" title="Permanent link">&para;</a></h3>
<h4 id="checked-vs-unchecked">Checked vs unchecked<a class="headerlink" href="#checked-vs-unchecked" title="Permanent link">&para;</a></h4>
<p>Muchas APIs de Java lanzan excepciones checked cuando deberían ser unchecked</p>
<p><strong>Ejemplo</strong>: Al ejecutar una consulta mediante <code>executeQuery</code> en el API de JDBC se lanza una excepción <code>java.sql.SQLException</code> (de tipo checked) si la SQL es errónea.</p>
<h5 id="solucion">Solución<a class="headerlink" href="#solucion" title="Permanent link">&para;</a></h5>
<p>Transformar las excepciones checked en unchecked:</p>
<div class="codehilite"><pre><span></span><code>  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// Codigo que genera la excepcion checked</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="p">(</span><span class="s">&quot;Unchecked exception&quot;</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span>
  <span class="p">}</span>
</code></pre></div>

<h4 id="excepciones-encapsuladas">Excepciones encapsuladas<a class="headerlink" href="#excepciones-encapsuladas" title="Permanent link">&para;</a></h4>
<p>Criticar la siguiente implementación:</p>
<div class="codehilite"><pre><span></span><code>  <span class="n">ACMEPort</span> <span class="n">port</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ACMEPort</span><span class="p">(</span><span class="mi">12</span><span class="p">);</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">port</span><span class="p">.</span><span class="na">open</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">DeviceResponseException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">reportPortError</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
    <span class="n">logger</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="s">&quot;Device response exception&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">ATM1212UnlockedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">reportPortError</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
    <span class="n">logger</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="s">&quot;Unlock exception&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">GMXError</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">reportPortError</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
    <span class="n">logger</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="s">&quot;Device response exception&quot;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
    <span class="p">...</span>
  <span class="p">}</span>
</code></pre></div>

<p>Excesiva duplicación de código: llamada a <code>reportPortError()</code></p>
<p>Excepción encapsulada:</p>
<div class="codehilite"><pre><span></span><code>    <span class="n">LocalPort</span> <span class="n">port</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LocalPort</span><span class="p">(</span><span class="mi">12</span><span class="p">);</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="n">port</span><span class="p">.</span><span class="na">open</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">PortDeviceFailure</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">reportPortError</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
      <span class="n">logger</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">(),</span> <span class="n">e</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
      <span class="p">...</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">LocalPort</span> <span class="p">{</span>
      <span class="kd">private</span> <span class="n">ACMEPort</span> <span class="n">innerPort</span><span class="p">;</span>
      <span class="kd">public</span> <span class="nf">LocalPort</span><span class="p">(</span><span class="kt">int</span> <span class="n">portNumber</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">innerPort</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ACMEPort</span><span class="p">(</span><span class="n">portNumber</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">open</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">PortDeviceFailure</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
          <span class="n">innerPort</span><span class="p">.</span><span class="na">open</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">DeviceResponseException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="n">PortDeviceFailure</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">ATM1212UnlockedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="n">PortDeviceFailure</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">GMXError</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="n">PortDeviceFailure</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="p">...</span>
    <span class="p">}</span>
</code></pre></div>

<ul>
<li>La encapsulación de excepciones es recomendable cuando se usa un API de terceros, para minimizar las dependencias con respecto al API elegido. </li>
<li>También facilitan la implementación de <em>mocks</em> del componente que proporciona el API para construir pruebas.</li>
</ul>
<h3 id="las-excepciones-son-excepcionales">Las excepciones son excepcionales<a class="headerlink" href="#las-excepciones-son-excepcionales" title="Permanent link">&para;</a></h3>
<p><strong>Recomendación de uso</strong>: Usar excepciones para problemas excepcionales (eventos inesperados)</p>
<p><strong>Ejemplo</strong>: <span style="color:red;">¿Usar excepciones cuando se intenta abrir un fichero para leer y el fichero no existe?</span></p>
<p>Depende de si el fichero debe estar ahí</p>
<ul>
<li>Usando excepciones:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">open_passwd</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">FileNotFoundException</span> <span class="p">{</span>
  <span class="c1">// This may throw FileNotFoundException...</span>
  <span class="n">ipstream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="p">(</span><span class="s">&quot;/etc/passwd&quot;</span><span class="p">);</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li>Sin usar excepciones:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">open_user_file</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">)</span>
    <span class="kd">throws</span> <span class="n">FileNotFoundException</span> <span class="p">{</span>
  <span class="n">File</span> <span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">f</span><span class="p">.</span><span class="na">exists</span><span class="p">())</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="n">ipstream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p><a id="null"></a></p>
<h3 id="uso-de-null">Uso de null<a class="headerlink" href="#uso-de-null" title="Permanent link">&para;</a></h3>
<p>Obtener un <em>null</em> cuando no se espera puede ser un quebradero de cabeza para el tratamiento de errores</p>
<h4 id="principio-general-no-devolver-null">Principio general: no devolver null<a class="headerlink" href="#principio-general-no-devolver-null" title="Permanent link">&para;</a></h4>
<p>Este código puede parecer inofensivo, pero es maligno:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">registerItem</span><span class="p">(</span><span class="n">Item</span> <span class="n">item</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">item</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ItemRegistry</span> <span class="n">registry</span> <span class="o">=</span> <span class="n">peristentStore</span><span class="p">.</span><span class="na">getItemRegistry</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">registry</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Item</span> <span class="n">existing</span> <span class="o">=</span> <span class="n">registry</span><span class="p">.</span><span class="na">getItem</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="na">getID</span><span class="p">());</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">existing</span><span class="p">.</span><span class="na">getBillingPeriod</span><span class="p">().</span><span class="na">hasRetailOwner</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">existing</span><span class="p">.</span><span class="na">register</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>¿Qué pasa si <code>persistentStore</code> es null?</p>
<ul>
<li>Peligro de <code>NullPointerException</code></li>
<li>¿Se nos ha olvidado añadir un <code>if null</code>?</li>
<li>El problema no es que se haya olvidado uno, sino que hay demasiados</li>
<li>En su lugar, elevar una excepción o devolver un objeto <em>especial</em></li>
</ul>
<h4 id="no-devolver-null">No devolver null<a class="headerlink" href="#no-devolver-null" title="Permanent link">&para;</a></h4>
<p>Evitar:</p>
<div class="codehilite"><pre><span></span><code><span class="n">List</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="n">getEmployees</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="n">employees</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span><span class="p">(</span><span class="n">Employee</span> <span class="n">e</span> <span class="p">:</span> <span class="n">employees</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">totalPay</span> <span class="o">+=</span> <span class="n">e</span><span class="p">.</span><span class="na">getPay</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Mejor así:</p>
<div class="codehilite"><pre><span></span><code><span class="n">List</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="n">getEmployees</span><span class="p">();</span>
<span class="k">for</span><span class="p">(</span><span class="n">Employee</span> <span class="n">e</span> <span class="p">:</span> <span class="n">employees</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">totalPay</span> <span class="o">+=</span> <span class="n">e</span><span class="p">.</span><span class="na">getPay</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span> <span class="nf">getEmployees</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span> <span class="cm">/* there are no employees */</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">Collections</span><span class="p">.</span><span class="na">emptyList</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="no-pasar-valores-null">No pasar valores null<a class="headerlink" href="#no-pasar-valores-null" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MetricsCalculator</span>
<span class="p">{</span>
  <span class="kd">public</span> <span class="kt">double</span> <span class="nf">xProjection</span><span class="p">(</span><span class="n">Point</span> <span class="n">p1</span><span class="p">,</span> <span class="n">Point</span> <span class="n">p2</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">p2</span><span class="p">.</span><span class="na">x</span> <span class="o">-</span> <span class="n">p1</span><span class="p">.</span><span class="na">x</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p><span style="color:red;">¿Qué sucede si llamamos a <code>xProjection()</code> así...?</span></p>
<div class="codehilite"><pre><span></span><code>  <span class="n">calculator</span><span class="p">.</span><span class="na">xProjection</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="k">new</span> <span class="n">Point</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">))</span>
</code></pre></div>

<p>Devolver null es malo, pero ¡pasar un valor null es peor!</p>
<p><span style="color:red;">¿Es mejor así...?</span></p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MetricsCalculator</span>
<span class="p">{</span>
  <span class="kd">public</span> <span class="kt">double</span> <span class="nf">xProjection</span><span class="p">(</span><span class="n">Point</span> <span class="n">p1</span><span class="p">,</span> <span class="n">Point</span> <span class="n">p2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">p1</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">p2</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="n">InvalidArgumentException</span><span class="p">(</span>
               <span class="s">&quot;Invalid argument for MetricsCalculator.xProjection&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">p2</span><span class="p">.</span><span class="na">x</span> <span class="o">-</span> <span class="n">p1</span><span class="p">.</span><span class="na">x</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>¿Qué curso de acción tomar ante un <code>InvalidArgumentException</code>? ¿Hay alguno?</p>
<h5 id="alternativa-con-aserciones">Alternativa con aserciones<a class="headerlink" href="#alternativa-con-aserciones" title="Permanent link">&para;</a></h5>
<p>(<em>solo para JDK <span><span class="MathJax_Preview">\geq</span><script type="math/tex">\geq</script></span> 5.0</em>)</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MetricsCalculator</span>
<span class="p">{</span>
  <span class="kd">public</span> <span class="kt">double</span> <span class="nf">xProjection</span><span class="p">(</span><span class="n">Point</span> <span class="n">p1</span><span class="p">,</span> <span class="n">Point</span> <span class="n">p2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">assert</span> <span class="n">p1</span> <span class="o">!=</span> <span class="kc">null</span> <span class="p">:</span> <span class="s">&quot;p1 should not be null&quot;</span><span class="p">;</span>
    <span class="k">assert</span> <span class="n">p2</span> <span class="o">!=</span> <span class="kc">null</span> <span class="p">:</span> <span class="s">&quot;p2 should not be null&quot;</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">p2</span><span class="p">.</span><span class="na">x</span> <span class="o">-</span> <span class="n">p1</span><span class="p">.</span><span class="na">x</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Es una buena forma de documentar, pero no resuelve el problema</p>
<h3 id="optionals">Optionals<a class="headerlink" href="#optionals" title="Permanent link">&para;</a></h3>
<ul>
<li>En la mayoría de lenguajes no hay forma satisfactoria de tratar con <em>nulls</em> pasados como argumento accidentalmente.</li>
<li>Para eso están los <em>options</em> u <em>optionals</em>, disponibles actualmente en muchos languajes:<ul>
<li><a href="https://www.tutorialspoint.com/scala/scala_options.htm">Scala <code>Option</code></a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html">Java 8</a> <code>java.util.Optional</code></li>
<li>C++17 <code>std::optional</code></li>
</ul>
</li>
<li><a href="https://github.com/Microsoft/TypeScript/wiki/Coding-guidelines#null-and-undefined">TypeScript recomienda usar <code>undefined</code></a> (algo que no se ha inicializado) en lugar de <code>null</code> (algo que no está disponible)</li>
</ul>
<h4 id="scala-options"><a href="https://www.tutorialspoint.com/scala/scala_options.htm">Scala Options</a><a class="headerlink" href="#scala-options" title="Permanent link">&para;</a></h4>
<p>En Scala, <code>Option[T]</code> es un contenedor de un valor opcional de tipo T.</p>
<ul>
<li>Si el valor de tipo T está presente, <code>Option[T]</code> es una intancia de <code>Some[T]</code> que contiene el valor presente de tipo T.</li>
<li>Si el valor está ausente, <code>Option[T]</code> es el objeto <code>None</code>.</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="k">object</span> <span class="nc">Demo</span> <span class="o">{</span>
   <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="o">{</span>
      <span class="k">val</span> <span class="n">a</span><span class="k">:</span><span class="kt">Option</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Some</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
      <span class="k">val</span> <span class="n">b</span><span class="k">:</span><span class="kt">Option</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span>

      <span class="n">println</span><span class="o">(</span><span class="s">&quot;a.isEmpty: &quot;</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="n">isEmpty</span> <span class="o">)</span>  <span class="c1">//false</span>
      <span class="n">println</span><span class="o">(</span><span class="s">&quot;b.isEmpty: &quot;</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">isEmpty</span> <span class="o">)</span>  <span class="c1">//true</span>
   <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="k">object</span> <span class="nc">Demo</span> <span class="o">{</span>
   <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="o">{</span>
      <span class="k">val</span> <span class="n">capitals</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span><span class="s">&quot;France&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;Paris&quot;</span><span class="o">,</span> <span class="s">&quot;Japan&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;Tokyo&quot;</span><span class="o">)</span>

      <span class="n">println</span><span class="o">(</span><span class="s">&quot;show(capitals.get( \&quot;Japan\&quot;)) : &quot;</span> <span class="o">+</span> <span class="n">show</span><span class="o">(</span><span class="n">capitals</span><span class="o">.</span><span class="n">get</span><span class="o">(</span> <span class="s">&quot;Japan&quot;</span><span class="o">))</span> <span class="o">)</span>
      <span class="n">println</span><span class="o">(</span><span class="s">&quot;show(capitals.get( \&quot;India\&quot;)) : &quot;</span> <span class="o">+</span> <span class="n">show</span><span class="o">(</span><span class="n">capitals</span><span class="o">.</span><span class="n">get</span><span class="o">(</span> <span class="s">&quot;India&quot;</span><span class="o">))</span> <span class="o">)</span>
   <span class="o">}</span>

   <span class="k">def</span> <span class="n">show</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="k">=</span> <span class="n">x</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Some</span><span class="o">(</span><span class="n">s</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">s</span>
      <span class="k">case</span> <span class="nc">None</span> <span class="k">=&gt;</span> <span class="s">&quot;?&quot;</span>
   <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>

<h4 id="java-8-optionals">Java 8 Optionals<a class="headerlink" href="#java-8-optionals" title="Permanent link">&para;</a></h4>
<p>From <a href="https://www.mkyong.com/java8/java-8-optional-in-depth/">Java 8 Optional in Depth</a></p>
<h5 id="ejemplo-sin-optional">Ejemplo sin <code>Optional</code><a class="headerlink" href="#ejemplo-sin-optional" title="Permanent link">&para;</a></h5>
<p>Programa de prueba:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MobileTesterWithoutOptional</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ScreenResolution</span> <span class="n">resolution</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ScreenResolution</span><span class="p">(</span><span class="mi">750</span><span class="p">,</span><span class="mi">1334</span><span class="p">);</span>
    <span class="n">DisplayFeatures</span> <span class="n">dfeatures</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DisplayFeatures</span><span class="p">(</span><span class="s">&quot;4.7&quot;</span><span class="p">,</span> <span class="n">resolution</span><span class="p">);</span>
    <span class="n">Mobile</span> <span class="n">mobile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mobile</span><span class="p">(</span><span class="mi">2015001</span><span class="p">,</span> <span class="s">&quot;Apple&quot;</span><span class="p">,</span> <span class="s">&quot;iPhone 6s&quot;</span><span class="p">,</span> <span class="n">dfeatures</span><span class="p">);</span>

    <span class="n">MobileService</span> <span class="n">mService</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MobileService</span><span class="p">();</span>

    <span class="kt">int</span> <span class="n">mobileWidth</span> <span class="o">=</span> <span class="n">mService</span><span class="p">.</span><span class="na">getMobileScreenWidth</span><span class="p">(</span><span class="n">mobile</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Apple iPhone 6s Screen Width = &quot;</span> <span class="o">+</span> <span class="n">mobileWidth</span><span class="p">);</span>

    <span class="n">ScreenResolution</span> <span class="n">resolution2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ScreenResolution</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">DisplayFeatures</span> <span class="n">dfeatures2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DisplayFeatures</span><span class="p">(</span><span class="s">&quot;0&quot;</span><span class="p">,</span> <span class="n">resolution2</span><span class="p">);</span>
    <span class="n">Mobile</span> <span class="n">mobile2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mobile</span><span class="p">(</span><span class="mi">2015001</span><span class="p">,</span> <span class="s">&quot;Apple&quot;</span><span class="p">,</span> <span class="s">&quot;iPhone 6s&quot;</span><span class="p">,</span> <span class="n">dfeatures2</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">mobileWidth2</span> <span class="o">=</span> <span class="n">mService</span><span class="p">.</span><span class="na">getMobileScreenWidth</span><span class="p">(</span><span class="n">mobile2</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Apple iPhone 16s Screen Width = &quot;</span> <span class="o">+</span> <span class="n">mobileWidth2</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Dependencias: <code>MobileService</code> <span><span class="MathJax_Preview">\dashrightarrow</span><script type="math/tex">\dashrightarrow</script></span> <code>DisplayFeatures</code>, <code>ScreenResolution</code></p>
<p>Cantidad de código <em>boilerplate</em> para comprobar los nulos en la clase principal:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MobileService</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getMobileScreenWidth</span><span class="p">(</span><span class="n">Mobile</span> <span class="n">mobile</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">mobile</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">){</span>
      <span class="n">DisplayFeatures</span> <span class="n">dfeatures</span> <span class="o">=</span> <span class="n">mobile</span><span class="p">.</span><span class="na">getDisplayFeatures</span><span class="p">();</span>
      <span class="k">if</span><span class="p">(</span><span class="n">dfeatures</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">){</span>
        <span class="n">ScreenResolution</span> <span class="n">resolution</span> <span class="o">=</span> <span class="n">dfeatures</span><span class="p">.</span><span class="na">getResolution</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">resolution</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">){</span>
          <span class="k">return</span> <span class="n">resolution</span><span class="p">.</span><span class="na">getWidth</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Clases de utilidad:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ScreenResolution</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">width</span><span class="p">;</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">height</span><span class="p">;</span>

  <span class="kd">public</span> <span class="nf">ScreenResolution</span><span class="p">(</span><span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="na">width</span> <span class="o">=</span> <span class="n">width</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">height</span> <span class="o">=</span> <span class="n">height</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getWidth</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">width</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getHeight</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">height</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DisplayFeatures</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">size</span><span class="p">;</span> <span class="c1">// In inches</span>
  <span class="kd">private</span> <span class="n">ScreenResolution</span> <span class="n">resolution</span><span class="p">;</span>

  <span class="kd">public</span> <span class="nf">DisplayFeatures</span><span class="p">(</span><span class="n">String</span> <span class="n">size</span><span class="p">,</span> <span class="n">ScreenResolution</span> <span class="n">resolution</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="na">size</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">resolution</span> <span class="o">=</span> <span class="n">resolution</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getSize</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">size</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="n">ScreenResolution</span> <span class="nf">getResolution</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">resolution</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Mobile</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="kt">long</span> <span class="n">id</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">brand</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">DisplayFeatures</span> <span class="n">displayFeatures</span><span class="p">;</span>
  <span class="c1">// Likewise we can see Memory Features, Camera Features etc.</span>

  <span class="kd">public</span> <span class="nf">Mobile</span><span class="p">(</span><span class="kt">long</span> <span class="n">id</span><span class="p">,</span> <span class="n">String</span> <span class="n">brand</span><span class="p">,</span> <span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">DisplayFeatures</span> <span class="n">displayFeatures</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">brand</span> <span class="o">=</span> <span class="n">brand</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">displayFeatures</span> <span class="o">=</span> <span class="n">displayFeatures</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getId</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">id</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getBrand</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">brand</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">name</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="n">DisplayFeatures</span> <span class="nf">getDisplayFeatures</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">displayFeatures</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h5 id="ejemplo-con-optionals">Ejemplo con <code>Optionals</code><a class="headerlink" href="#ejemplo-con-optionals" title="Permanent link">&para;</a></h5>
<p>Uso de métodos de <code>Optional</code> en el programa de prueba:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MobileTesterWithOptional</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ScreenResolution</span> <span class="n">resolution</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ScreenResolution</span><span class="p">(</span><span class="mi">750</span><span class="p">,</span><span class="mi">1334</span><span class="p">);</span>
    <span class="n">DisplayFeatures</span> <span class="n">dfeatures</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DisplayFeatures</span><span class="p">(</span><span class="s">&quot;4.7&quot;</span><span class="p">,</span> <span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">resolution</span><span class="p">));</span>
    <span class="n">Mobile</span> <span class="n">mobile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mobile</span><span class="p">(</span><span class="mi">2015001</span><span class="p">,</span> <span class="s">&quot;Apple&quot;</span><span class="p">,</span> <span class="s">&quot;iPhone 6s&quot;</span><span class="p">,</span> <span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">dfeatures</span><span class="p">));</span>

    <span class="n">MobileService</span> <span class="n">mService</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MobileService</span><span class="p">();</span>

    <span class="kt">int</span> <span class="n">width</span> <span class="o">=</span> <span class="n">mService</span><span class="p">.</span><span class="na">getMobileScreenWidth</span><span class="p">(</span><span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">mobile</span><span class="p">));</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Apple iPhone 6s Screen Width = &quot;</span> <span class="o">+</span> <span class="n">width</span><span class="p">);</span>

    <span class="n">Mobile</span> <span class="n">mobile2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mobile</span><span class="p">(</span><span class="mi">2015001</span><span class="p">,</span> <span class="s">&quot;Apple&quot;</span><span class="p">,</span> <span class="s">&quot;iPhone 6s&quot;</span><span class="p">,</span> <span class="n">Optional</span><span class="p">.</span><span class="na">empty</span><span class="p">());</span>
    <span class="kt">int</span> <span class="n">width2</span> <span class="o">=</span> <span class="n">mService</span><span class="p">.</span><span class="na">getMobileScreenWidth</span><span class="p">(</span><span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">mobile2</span><span class="p">));</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Apple iPhone 16s Screen Width = &quot;</span> <span class="o">+</span> <span class="n">width2</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Menos código <em>boilerplate</em> en la clase principal:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MobileService</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getMobileScreenWidth</span><span class="p">(</span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">Mobile</span><span class="o">&gt;</span> <span class="n">mobile</span><span class="p">){</span>
    <span class="k">return</span> <span class="n">mobile</span><span class="p">.</span><span class="na">flatMap</span><span class="p">(</span><span class="n">Mobile</span><span class="p">::</span><span class="n">getDisplayFeatures</span><span class="p">)</span>
      <span class="p">.</span><span class="na">flatMap</span><span class="p">(</span><span class="n">DisplayFeatures</span><span class="p">::</span><span class="n">getResolution</span><span class="p">)</span>
      <span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">ScreenResolution</span><span class="p">::</span><span class="n">getWidth</span><span class="p">)</span>
      <span class="p">.</span><span class="na">orElse</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Clases de utilidad:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">java.util.Optional</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DisplayFeatures</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">size</span><span class="p">;</span> <span class="c1">// In inches</span>
  <span class="kd">private</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">ScreenResolution</span><span class="o">&gt;</span> <span class="n">resolution</span><span class="p">;</span>
  <span class="kd">public</span> <span class="nf">DisplayFeatures</span><span class="p">(</span><span class="n">String</span> <span class="n">size</span><span class="p">,</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">ScreenResolution</span><span class="o">&gt;</span> <span class="n">resolution</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="na">size</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">resolution</span> <span class="o">=</span> <span class="n">resolution</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getSize</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">size</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">ScreenResolution</span><span class="o">&gt;</span> <span class="nf">getResolution</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">resolution</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Mobile</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="kt">long</span> <span class="n">id</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">brand</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">DisplayFeatures</span><span class="o">&gt;</span> <span class="n">displayFeatures</span><span class="p">;</span>
  <span class="c1">// Like wise we can see MemoryFeatures, CameraFeatures etc.</span>
  <span class="c1">// For simplicity, using only one Features</span>
  <span class="kd">public</span> <span class="nf">Mobile</span><span class="p">(</span><span class="kt">long</span> <span class="n">id</span><span class="p">,</span> <span class="n">String</span> <span class="n">brand</span><span class="p">,</span> <span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">DisplayFeatures</span><span class="o">&gt;</span> <span class="n">displayFeatures</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">brand</span> <span class="o">=</span> <span class="n">brand</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">displayFeatures</span> <span class="o">=</span> <span class="n">displayFeatures</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getId</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">id</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getBrand</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">brand</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">name</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">DisplayFeatures</span><span class="o">&gt;</span> <span class="nf">getDisplayFeatures</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">displayFeatures</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="fronteras">Fronteras<a class="headerlink" href="#fronteras" title="Permanent link">&para;</a></h3>
<p>Tensión proveedor-cliente</p>
<ul>
<li>Los proveedores de packages y frameworks quieren amplia aplicabilidad</li>
<li>Los clientes quieren una interfaz centrada en sus necesidades particulares</li>
</ul>
<p><strong>Ejemplo</strong>: La interfaz <a href="http://docs.oracle.com/javase/6/docs/api/java/util/Map.html"><code>java.util.Map</code></a></p>
<div class="codehilite"><pre><span></span><code><span class="n">clear</span><span class="p">()</span> <span class="kt">void</span> <span class="err">–</span> <span class="n">Map</span>
<span class="nf">containsKey</span><span class="p">(</span><span class="n">Object</span> <span class="n">key</span><span class="p">)</span> <span class="kt">boolean</span> <span class="err">–</span> <span class="n">Map</span>
<span class="nf">containsValue</span><span class="p">(</span><span class="n">Object</span> <span class="n">value</span><span class="p">)</span> <span class="kt">boolean</span> <span class="err">–</span> <span class="n">Map</span>
<span class="nf">entrySet</span><span class="p">()</span> <span class="n">Set</span> <span class="err">–</span> <span class="n">Map</span>
<span class="nf">equals</span><span class="p">(</span><span class="n">Object</span> <span class="n">o</span><span class="p">)</span> <span class="kt">boolean</span> <span class="err">–</span> <span class="n">Map</span>
<span class="nf">get</span><span class="p">(</span><span class="n">Object</span> <span class="n">key</span><span class="p">)</span> <span class="n">Object</span> <span class="err">–</span> <span class="n">Map</span>
<span class="nf">getClass</span><span class="p">()</span> <span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="err">–</span> <span class="n">Object</span>
<span class="nf">hashCode</span><span class="p">()</span> <span class="kt">int</span> <span class="err">–</span> <span class="n">Map</span>
<span class="nf">isEmpty</span><span class="p">()</span> <span class="kt">boolean</span> <span class="err">–</span> <span class="n">Map</span>
<span class="nf">keySet</span><span class="p">()</span> <span class="n">Set</span> <span class="err">–</span> <span class="n">Map</span>
<span class="nf">notify</span><span class="p">()</span> <span class="kt">void</span> <span class="err">–</span> <span class="n">Object</span>
<span class="nf">notifyAll</span><span class="p">()</span> <span class="kt">void</span> <span class="err">–</span> <span class="n">Object</span>
<span class="nf">put</span><span class="p">(</span><span class="n">Object</span> <span class="n">key</span><span class="p">,</span> <span class="n">Object</span> <span class="n">value</span><span class="p">)</span> <span class="n">Object</span> <span class="err">–</span> <span class="n">Map</span>
<span class="nf">putAll</span><span class="p">(</span><span class="n">Map</span> <span class="n">t</span><span class="p">)</span> <span class="kt">void</span> <span class="err">–</span> <span class="n">Map</span>
<span class="nf">remove</span><span class="p">(</span><span class="n">Object</span> <span class="n">key</span><span class="p">)</span> <span class="n">Object</span> <span class="err">–</span> <span class="n">Map</span>
<span class="nf">size</span><span class="p">()</span> <span class="kt">int</span> <span class="err">–</span> <span class="n">Map</span>
<span class="nf">toString</span><span class="p">()</span> <span class="n">String</span> <span class="err">–</span> <span class="n">Object</span>
<span class="nf">values</span><span class="p">()</span> <span class="n">Collection</span> <span class="err">–</span> <span class="n">Map</span>
<span class="nf">wait</span><span class="p">()</span> <span class="kt">void</span> <span class="err">–</span> <span class="n">Object</span>
<span class="nf">wait</span><span class="p">(</span><span class="kt">long</span> <span class="n">timeout</span><span class="p">)</span> <span class="kt">void</span> <span class="err">–</span> <span class="n">Object</span>
<span class="nf">wait</span><span class="p">(</span><span class="kt">long</span> <span class="n">timeout</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nanos</span><span class="p">)</span> <span class="kt">void</span> <span class="err">–</span> <span class="n">Object</span>
</code></pre></div>

<p>Construimos un <code>Map</code> y lo pasamos.</p>
<ul>
<li>Diseño A: Ninguno de los receptores deberá poder borrar algo del map. ¡Pero hay un <code>clear()</code>!</li>
<li>Diseño B: solo algunos tipos de objetos deben poderse guardar. ¡Los tipos no están restringidos!</li>
</ul>
<p>¿La interfaz <code>Map</code> es siempre satisfactoria? ¿seguro que no va a cambiar?</p>
<ul>
<li>JDK &lt; 5.0:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="n">Map</span> <span class="n">sensors</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="p">();</span>
<span class="p">...</span>
<span class="n">Sensor</span> <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">Sensor</span><span class="p">)</span><span class="n">sensors</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">sensorId</span><span class="p">);</span>
</code></pre></div>

<ul>
<li>JDK <span><span class="MathJax_Preview">\geq</span><script type="math/tex">\geq</script></span> 5.0:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="n">Map</span><span class="o">&lt;</span><span class="n">Sensor</span><span class="o">&gt;</span> <span class="n">sensors</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">Sensor</span><span class="o">&gt;</span><span class="p">();</span>
<span class="p">...</span>
<span class="n">Sensor</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sensors</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">sensorId</span><span class="p">);</span>
</code></pre></div>

<p><strong>Conclusión</strong>: Map<Sensor> ofrece más de lo que necesitamos</p>
<div class="codehilite"><pre><span></span><code>  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Sensors</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="n">Map</span> <span class="n">sensors</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="p">();</span>
    <span class="kd">public</span> <span class="n">Sensor</span> <span class="nf">getById</span><span class="p">(</span><span class="n">String</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="n">Sensor</span><span class="p">)</span> <span class="n">sensors</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">//...</span>
  <span class="p">}</span>
</code></pre></div>

<ul>
<li>La interfaz <code>Map</code> queda oculta</li>
<li>Filtramos los métodos que no nos sirven</li>
<li>Más fácil de hacer evolucionar sin impacto en el resto de la aplicación</li>
<li>El casting queda confinado en la clase Sensors, que es más seguro</li>
</ul>
<p><strong>Interfaces de frontera</strong>: No todo uso de <code>Map</code> o interfaz de
frontera debe quedar encapsulado. Sólo es un consejo para no ’pasarla’
con métodos que no vamos a necesitar.</p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../iiss-oop-3/" title="Inyección" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Inyección
              </span>
            </div>
          </a>
        
        
          <a href="../iiss-aop/" title="II. Aspectos" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                II. Aspectos
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/dodero" target="_blank" rel="noopener" title="github" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/jmdodero" target="_blank" rel="noopener" title="twitter" class="md-footer-social__link fa fa-twitter"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.1",url:{base:".."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>