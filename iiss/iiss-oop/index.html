



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Apuntes de Implementación e Implantación de Sistemas Software – Grado en Ingeniería Informática">
      
      
      
        <meta name="author" content="Juan Manuel Dodero">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-4.6.3">
    
    
      
        <title>OBJETOS - Implementación e Implantación de Sistemas Software</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.adb8469c.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#caso-1-ocultacion-de-la-implementacion" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Implementación e Implantación de Sistemas Software" aria-label="Implementación e Implantación de Sistemas Software" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Implementación e Implantación de Sistemas Software
            </span>
            <span class="md-header-nav__topic">
              
                OBJETOS
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/dodero/gii-dss-iiss/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Implementación e Implantación de Sistemas Software" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Implementación e Implantación de Sistemas Software
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/dodero/gii-dss-iiss/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Inicio" class="md-nav__link">
      Inicio
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Asignatura
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Asignatura
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../iiss-pres/" title="Presentación" class="md-nav__link">
      Presentación
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bibliografia/" title="Bibliografía" class="md-nav__link">
      Bibliografía
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../about/" title="About" class="md-nav__link">
      About
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      I. Objetos
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        I. Objetos
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../iiss-oop-1/" title="Principios" class="md-nav__link">
      Principios
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../iiss-oop-2/" title="Delegación" class="md-nav__link">
      Delegación
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../iiss-oop-3/" title="Inyección" class="md-nav__link">
      Inyección
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../iiss-oop-4/" title="Duplicación" class="md-nav__link">
      Duplicación
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../iiss-aop/" title="II. Aspectos" class="md-nav__link">
      II. Aspectos
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../iiss-dbc/" title="III. Contratos" class="md-nav__link">
      III. Contratos
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../iiss-fp/" title="IV. Funciones" class="md-nav__link">
      IV. Funciones
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../iiss-evp/" title="V. Eventos" class="md-nav__link">
      V. Eventos
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#recorrido-de-una-lista" class="md-nav__link">
    Recorrido de una lista
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#version-inicial-lista-v01" class="md-nav__link">
    Versión inicial: Lista v0.1
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cohesion" class="md-nav__link">
    Cohesión
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#criticas-a-lista-v01" class="md-nav__link">
    Críticas a Lista v0.1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problematicas-de-lista-v01" class="md-nav__link">
    Problemáticas de Lista v0.1
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementacion-alternativa-lista-v02" class="md-nav__link">
    Implementación alternativa: Lista v0.2
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#criticas-a-lista-v02" class="md-nav__link">
    Críticas a Lista v0.2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problematicas-de-lista-v02" class="md-nav__link">
    Problemáticas de Lista v0.2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementacion-alternativa-lista-v03" class="md-nav__link">
    Implementación alternativa: Lista v0.3
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#criticas-a-lista-v03" class="md-nav__link">
    Críticas a Lista v0.3
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problematicas-de-lista-v03" class="md-nav__link">
    Problemáticas de Lista v0.3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementacion-alternativa-lista-v04" class="md-nav__link">
    Implementación alternativa: Lista v0.4
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ventajas" class="md-nav__link">
    Ventajas
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ocultar-la-implementacion" class="md-nav__link">
    Ocultar la implementación
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alta-cohesion-bajo-acoplamiento" class="md-nav__link">
    Alta cohesión, bajo acoplamiento
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modularidad" class="md-nav__link">
    Modularidad
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tecnicas-de-ocultacion" class="md-nav__link">
    Técnicas de ocultación
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#herencia-generalizacion-y-especializacion" class="md-nav__link">
    Herencia: generalización y especialización
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ejemplo-aventura-v01" class="md-nav__link">
    Ejemplo: Aventura v0.1
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#criticas-a-aventura-v01" class="md-nav__link">
    Críticas a Aventura v0.1
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uso-correcto-de-la-herencia" class="md-nav__link">
    Uso correcto de la herencia
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ejemplo-herencia-como-estructura" class="md-nav__link">
    Ejemplo: herencia como estructura
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#polimorfismo" class="md-nav__link">
    Polimorfismo
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/dodero/gii-dss-iiss/edit/master/docs/iiss-oop.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h0>OBJETOS</h0>
<h1 id="caso-1-ocultacion-de-la-implementacion">Caso 1 - Ocultación de la implementación<a class="headerlink" href="#caso-1-ocultacion-de-la-implementacion" title="Permanent link">&para;</a></h1>
<p><a id="recorridolista"></a></p>
<h2 id="recorrido-de-una-lista">Recorrido de una lista<a class="headerlink" href="#recorrido-de-una-lista" title="Permanent link">&para;</a></h2>
<h3 id="version-inicial-lista-v01">Versión inicial: Lista v0.1<a class="headerlink" href="#version-inicial-lista-v01" title="Permanent link">&para;</a></h3>
<p><strong>Abstracción</strong>: La clase abstracta <code>List&lt;T&gt;</code> diferencia entre el <em>qué</em> y el <em>cómo</em>: Qué hace la lista vs. cómo se almacenan los elementos</p>
<p>Criticar la implementación siguiente:</p>
<div class="codehilite"><pre><span></span><code>  <span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addFirst</span><span class="p">(</span><span class="n">T</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeFirst</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addLast</span><span class="p">(</span><span class="n">T</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeLast</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>
    <span class="kd">public</span> <span class="n">T</span> <span class="nf">first</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>
    <span class="kd">public</span> <span class="n">T</span> <span class="nf">last</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isEmpty</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">length</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">clone</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isEqualTo</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span>
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">traverse</span><span class="p">();</span>
    <span class="c1">// etc...</span>
  <span class="p">}</span>
</code></pre></div>

<h4 id="cohesion"><span style="color:blue">Cohesión</span><a class="headerlink" href="#cohesion" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Cohesion refers to the degree to which the elements inside a module belong together</p>
<p>-- <cite><a href="../bibliografia/#yourdon">E. Yourdon &amp; L. Constantine</a></cite></p>
</blockquote>
<h4 id="criticas-a-lista-v01">Críticas a Lista v0.1<a class="headerlink" href="#criticas-a-lista-v01" title="Permanent link">&para;</a></h4>
<ul>
<li><code>List&lt;T&gt;</code> aglutina más de una responsabilidad: almacenar y recorrer. Implementación no cohesionada</li>
<li>¿Y si hay distintas implementaciones de <code>traverse()</code>? Si implementamos varias versiones de la lista, introducimos más dependencias (acoplamiento)</li>
</ul>
<h4 id="problematicas-de-lista-v01">Problemáticas de Lista v0.1<a class="headerlink" href="#problematicas-de-lista-v01" title="Permanent link">&para;</a></h4>
<ul>
<li>Baja <strong>cohesión</strong></li>
<li>Alta <strong>variabilidad</strong> no bien tratada &rarr; poca <strong>flexibilidad</strong></li>
</ul>
<h3 id="implementacion-alternativa-lista-v02">Implementación alternativa: Lista v0.2<a class="headerlink" href="#implementacion-alternativa-lista-v02" title="Permanent link">&para;</a></h3>
<p>Delegar funcionalidad hacia las subclases (vía <strong>herencia</strong>).</p>
<p>Criticar la implementación:</p>
<div class="codehilite"><pre><span></span><code>  <span class="kd">class</span> <span class="nc">ListForward</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c1">//...</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">traverse</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// recorrer hacia adelante };</span>
  <span class="p">}</span>
  <span class="kd">class</span> <span class="nc">ListBackward</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c1">//...</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">traverse</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// recorrer hacia atras};</span>
  <span class="p">}</span>
</code></pre></div>

<h4 id="criticas-a-lista-v02">Críticas a Lista v0.2<a class="headerlink" href="#criticas-a-lista-v02" title="Permanent link">&para;</a></h4>
<ul>
<li>¿Qué operación hace <code>traverse()</code> con cada elemento individual (imprimir, sumar, etc.)? ¿Hay que especializar de nuevo para cada tipo de operación? </li>
<li>¿Y si hay que especializar de nuevo el recorrido: sólo los pares, sólo los impares, etc.? </li>
</ul>
<h4 id="problematicas-de-lista-v02">Problemáticas de Lista v0.2<a class="headerlink" href="#problematicas-de-lista-v02" title="Permanent link">&para;</a></h4>
<ul>
<li>Elevada <strong>complejidad</strong></li>
<li>Alta <strong>variabilidad</strong> no bien tratada &rarr; poca <strong>flexibilidad</strong>, mala <strong>reutilización</strong></li>
</ul>
<h3 id="implementacion-alternativa-lista-v03">Implementación alternativa: Lista v0.3<a class="headerlink" href="#implementacion-alternativa-lista-v03" title="Permanent link">&para;</a></h3>
<p>Ampliamos la interfaz...</p>
<div class="codehilite"><pre><span></span><code>  <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addFirst</span><span class="p">(</span><span class="n">T</span> <span class="n">value</span><span class="p">);</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeFirst</span><span class="p">();</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addLast</span><span class="p">(</span><span class="n">T</span> <span class="n">value</span><span class="p">);</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeLast</span><span class="p">();</span>
    <span class="kd">public</span> <span class="n">T</span> <span class="nf">first</span><span class="p">();</span>
    <span class="kd">public</span> <span class="n">T</span> <span class="nf">last</span><span class="p">();</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isEmpty</span><span class="p">();</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">length</span><span class="p">();</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">clone</span><span class="p">();</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isEqualTo</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">);</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">traverseForward</span><span class="p">();</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">traverseBackWard</span><span class="p">();</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">traverseEvens</span><span class="p">();</span> <span class="c1">//pares</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">traverseOdds</span><span class="p">();</span>  <span class="c1">//impares</span>
    <span class="c1">// etc...</span>
  <span class="p">}</span>
</code></pre></div>

<h4 id="criticas-a-lista-v03">Críticas a Lista v0.3<a class="headerlink" href="#criticas-a-lista-v03" title="Permanent link">&para;</a></h4>
<ul>
<li>Si hay que cambiar la operación básica que hace <code>traverse()</code> con cada elemento (imprimir, sumar, etc.), ¿cuántos métodos hay que cambiar? Hay muchas dependencias</li>
<li>Cuanto más variedad de recorridos (la interfaz es mayor), menos flexibilidad para los cambios. Implementación poco flexible</li>
</ul>
<h4 id="problematicas-de-lista-v03">Problemáticas de Lista v0.3<a class="headerlink" href="#problematicas-de-lista-v03" title="Permanent link">&para;</a></h4>
<ul>
<li>Muchas <strong>dependencias</strong> &rarr; <strong>acoplamiento</strong></li>
<li>Poca <strong>flexibilidad</strong></li>
</ul>
<h3 id="implementacion-alternativa-lista-v04">Implementación alternativa: Lista v0.4<a class="headerlink" href="#implementacion-alternativa-lista-v04" title="Permanent link">&para;</a></h3>
<p><strong>Delegar</strong> hacia otra clase</p>
<div class="codehilite"><pre><span></span><code>  <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kt">void</span> <span class="nf">addFirst</span><span class="p">(</span><span class="n">T</span> <span class="n">value</span><span class="p">);</span>
    <span class="kt">void</span> <span class="nf">removeFirst</span><span class="p">();</span>
    <span class="kt">void</span> <span class="nf">addLast</span><span class="p">(</span><span class="n">T</span> <span class="n">value</span><span class="p">);</span>
    <span class="kt">void</span> <span class="nf">removeLast</span><span class="p">();</span>
    <span class="n">T</span> <span class="nf">first</span><span class="p">();</span>
    <span class="n">T</span> <span class="nf">last</span><span class="p">();</span>
    <span class="kt">boolean</span> <span class="nf">isEmpty</span><span class="p">();</span>
    <span class="kt">int</span> <span class="nf">length</span><span class="p">();</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">clone</span><span class="p">();</span>
    <span class="kt">boolean</span> <span class="nf">isEqualTo</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">);</span>
    <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">iterator</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Iterator</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="p">();</span>
    <span class="n">E</span> <span class="nf">next</span><span class="p">();</span>
    <span class="kt">void</span> <span class="nf">remove</span><span class="p">();</span>
  <span class="p">}</span>
</code></pre></div>

<h4 id="ventajas">Ventajas<a class="headerlink" href="#ventajas" title="Permanent link">&para;</a></h4>
<ul>
<li>Mayor <strong>cohesión</strong>: Las responsabilidades están ahora separadas: <code>List</code> almacena, <code>Iterator</code> recorre. <code>List</code> está más cohesionada</li>
<li>Uso de <strong>delegación</strong>: la responsabilidad de recorrer se ha delegado hacia otro sitio</li>
</ul>
<h2 id="ocultar-la-implementacion"><span style="color:blue">Ocultar la implementación</span><a class="headerlink" href="#ocultar-la-implementacion" title="Permanent link">&para;</a></h2>
<p><a id="ocultacion"></a></p>
<ul>
<li><strong>Cohesión</strong>: módulos auto-contenidos, independientes y con un
    único propósito</li>
<li><strong>Acoplamiento</strong>: minimizar dependencias entre módulos</li>
<li><strong>Abstracción</strong>: diferenciar el <em>qué</em> y el <em>cómo</em></li>
<li><strong>Modularidad</strong>: clases, interfaces y componentes/módulos</li>
</ul>
<h3 id="alta-cohesion-bajo-acoplamiento">Alta cohesión, bajo acoplamiento<a class="headerlink" href="#alta-cohesion-bajo-acoplamiento" title="Permanent link">&para;</a></h3>
<blockquote>
<p>Cuando los componentes están aislados, puedes cambiar uno sin preocuparte por el resto. Mientras no cambies las interfaces externas, no habrá problemas en el resto del sistema</p>
<p>-- <cite><a href="../bibliografia/#yourdon">Eric Yourdon</a></cite></p>
</blockquote>
<h3 id="modularidad">Modularidad<a class="headerlink" href="#modularidad" title="Permanent link">&para;</a></h3>
<p>Reducir el acoplamiento usando módulos o componentes con distintas responsabilidades, agrupados en bibliotecas</p>
<h3 id="tecnicas-de-ocultacion">Técnicas de ocultación<a class="headerlink" href="#tecnicas-de-ocultacion" title="Permanent link">&para;</a></h3>
<p>Hay diversas técnicas para ocultar la implementación...</p>
<ul>
<li><strong>Encapsular</strong>: agrupar en módulos y clases</li>
<li><strong>Visibilidad</strong>: <code>public</code>, <code>private</code>, <code>protected</code>, etc.</li>
<li><strong>Delegación</strong>: incrementar la cohesión extrayendo funcionalidad pensada para otros propósitos fuera de un módulo</li>
<li><strong>Herencia</strong>: delegar <em>en vertical</em></li>
<li><strong>Polimorfismo</strong>: ocultar la implementación de un método, manteniendo la misma interfaz de la clase base</li>
<li><strong>Interfaces</strong>: usar interfaces bien documentadas</li>
</ul>
<p><a id="herencia"></a></p>
<h2 id="herencia-generalizacion-y-especializacion"><span style="color:blue">Herencia: generalización y especialización</span><a class="headerlink" href="#herencia-generalizacion-y-especializacion" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p><strong>Reutilizar la interfaz</strong></p>
<ul>
<li>Clase base y derivada son del mismo tipo</li>
<li>Todas las operaciones de la clase base están también disponibles en la derivada</li>
</ul>
</li>
<li>
<p><strong>Redefinir vs. reutilizar el comportamiento</strong></p>
<ul>
<li><em>Overriding</em> (redefinición): cambio de comportamiento</li>
<li><em>Overloading</em> (sobrecarga): cambio de interfaz</li>
</ul>
</li>
<li>
<p><strong>Herencia pura vs. extensión</strong></p>
<ul>
<li>Herencia pura: mantiene la interfaz tal cual (relación <em>es-un</em>)</li>
<li>Extensión: amplía la interfaz con nuevas funcionalidades(relación <em>es-como-un</em>). Puede causar problemas de <em>casting</em>.</li>
</ul>
</li>
</ul>
<blockquote>
<p>When you inherit, you take an existing class and make a special version of it. In general, this means that you’re taking a general-purpose class and specializing it for a particular need. [...] it would make no sense to compose a car using a vehicle object —a car doesn’t contain a vehicle, it is a vehicle. The <em>is-a</em> relationship is expressed with inheritance, and the <em>has-a</em> relationship is expressed with composition.</p>
<p>-- <cite><a href="../bibliografia/#eckel">Bruce Eckel</a></cite></p>
</blockquote>
<h3 id="ejemplo-aventura-v01">Ejemplo: Aventura v0.1<a class="headerlink" href="#ejemplo-aventura-v01" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>   <span class="kd">public</span> <span class="kd">class</span> <span class="nc">PersonajeDeAccion</span> <span class="p">{</span>
     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">luchar</span><span class="p">()</span> <span class="p">{}</span>
   <span class="p">}</span>

   <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Heroe</span> <span class="kd">extends</span> <span class="n">PersonajeDeAccion</span> <span class="p">{</span>
     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">luchar</span><span class="p">()</span> <span class="p">{}</span>
     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">volar</span><span class="p">()</span> <span class="p">{}</span>
   <span class="p">}</span>

   <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Creador</span> <span class="p">{</span>
     <span class="n">PersonajeDeAccion</span><span class="o">[]</span> <span class="nf">personajes</span><span class="p">()</span> <span class="p">{</span>
       <span class="n">PersonajeDeAccion</span><span class="o">[]</span> <span class="n">x</span> <span class="o">=</span> <span class="p">{</span>
         <span class="k">new</span> <span class="n">PersonajeDeAccion</span><span class="p">(),</span>
         <span class="k">new</span> <span class="n">PersonajeDeAccion</span><span class="p">(),</span>
         <span class="k">new</span> <span class="n">Heroe</span><span class="p">(),</span>
         <span class="k">new</span> <span class="n">PersonajeDeAccion</span><span class="p">()</span>
       <span class="p">};</span>
       <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
     <span class="p">}</span>
   <span class="p">}</span>

   <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Aventura</span> <span class="p">{</span>
     <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">PersonajeDeAccion</span><span class="o">[]</span> <span class="n">cuatroFantasticos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Creador</span><span class="p">().</span><span class="na">personajes</span><span class="p">();</span>
       <span class="n">cuatroFantasticos</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">.</span><span class="na">luchar</span><span class="p">();</span>
       <span class="n">cuatroFantasticos</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">.</span><span class="na">luchar</span><span class="p">();</span> <span class="c1">// Upcast</span>

       <span class="c1">// En tiempo de compilacion: metodo no encontrado:</span>
       <span class="c1">//! cuatroFantasticos[2].volar();</span>
       <span class="p">((</span><span class="n">Heroe</span><span class="p">)</span><span class="n">cuatroFantasticos</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">).</span><span class="na">volar</span><span class="p">();</span> <span class="c1">// Downcast</span>
       <span class="p">((</span><span class="n">Heroe</span><span class="p">)</span><span class="n">cuatroFantasticos</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">).</span><span class="na">volar</span><span class="p">();</span> <span class="c1">// ClassCastException</span>
       <span class="k">for</span> <span class="p">(</span><span class="n">PersonajeDeAccion</span> <span class="n">p</span><span class="p">:</span> <span class="n">cuatroFantasticos</span><span class="p">)</span>
           <span class="n">p</span><span class="p">.</span><span class="na">luchar</span><span class="p">;</span> <span class="c1">// Sin problema</span>
       <span class="k">for</span> <span class="p">(</span><span class="n">PersonajeDeAccion</span> <span class="n">p</span><span class="p">:</span> <span class="n">cuatroFantasticos</span><span class="p">)</span>
           <span class="n">p</span><span class="p">.</span><span class="na">volar</span><span class="p">;</span> <span class="c1">// El 0, 1 y 3 van a lanzar ClassCastException</span>
     <span class="p">}</span>
   <span class="p">}</span>
</code></pre></div>

<h4 id="criticas-a-aventura-v01">Críticas a Aventura v0.1<a class="headerlink" href="#criticas-a-aventura-v01" title="Permanent link">&para;</a></h4>
<ul>
<li>¿De qué tipos van a ser los personales de acción? &rarr; problema de <em>downcasting</em></li>
<li>Hay que rediseñar la solución por ser insegura</li>
</ul>
<div class="codehilite"><pre><span></span><code>   <span class="kd">interface</span> <span class="nc">SabeLuchar</span> <span class="p">{</span>
     <span class="kt">void</span> <span class="nf">luchar</span><span class="p">();</span>
   <span class="p">}</span>
   <span class="kd">interface</span> <span class="nc">SabeNadar</span> <span class="p">{</span>
     <span class="kt">void</span> <span class="nf">nadar</span><span class="p">();</span>
   <span class="p">}</span>
   <span class="kd">interface</span> <span class="nc">SabeVolar</span> <span class="p">{</span>
     <span class="kt">void</span> <span class="nf">volar</span><span class="p">();</span>
   <span class="p">}</span>
   <span class="kd">class</span> <span class="nc">PersonajeDeAccion</span> <span class="p">{</span>
     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">luchar</span><span class="p">()</span> <span class="p">{}</span>
   <span class="p">}</span>
   <span class="kd">class</span> <span class="nc">Heroe</span>
       <span class="kd">extends</span> <span class="n">PersonajeDeAccion</span>
       <span class="kd">implements</span> <span class="n">SabeLuchar</span><span class="p">,</span>
                  <span class="n">SabeNadar</span><span class="p">,</span>
                  <span class="n">SabeVolar</span> <span class="p">{</span>
     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">nadar</span><span class="p">()</span> <span class="p">{}</span>
     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">volar</span><span class="p">()</span> <span class="p">{}</span>
   <span class="p">}</span>

   <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Aventura</span> <span class="p">{</span>
     <span class="kd">static</span> <span class="kt">void</span> <span class="nf">t</span><span class="p">(</span><span class="n">SabeLuchar</span> <span class="n">x</span><span class="p">)</span>
        <span class="p">{</span> <span class="n">x</span><span class="p">.</span><span class="na">luchar</span><span class="p">();</span> <span class="p">}</span>
     <span class="kd">static</span> <span class="kt">void</span> <span class="nf">u</span><span class="p">(</span><span class="n">SabeNadar</span> <span class="n">x</span><span class="p">)</span>
        <span class="p">{</span> <span class="n">x</span><span class="p">.</span><span class="na">nadar</span><span class="p">();</span> <span class="p">}</span>
     <span class="kd">static</span> <span class="kt">void</span> <span class="nf">v</span><span class="p">(</span><span class="n">SabeVolar</span> <span class="n">x</span><span class="p">)</span>
        <span class="p">{</span> <span class="n">x</span><span class="p">.</span><span class="na">volar</span><span class="p">();</span> <span class="p">}</span>
     <span class="kd">static</span> <span class="kt">void</span> <span class="nf">w</span><span class="p">(</span><span class="n">PersonajeDeAccion</span> <span class="n">x</span><span class="p">)</span>
        <span class="p">{</span> <span class="n">x</span><span class="p">.</span><span class="na">luchar</span><span class="p">();</span> <span class="p">}</span>
     <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span>
     <span class="p">{</span>
       <span class="n">Heroe</span> <span class="n">i</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Heroe</span><span class="p">();</span>
       <span class="n">t</span><span class="p">(</span><span class="n">i</span><span class="p">);</span> <span class="c1">// Tratar como un SabeLuchar</span>
       <span class="n">u</span><span class="p">(</span><span class="n">i</span><span class="p">);</span> <span class="c1">// Tratar como un SabeNadar</span>
       <span class="n">v</span><span class="p">(</span><span class="n">i</span><span class="p">);</span> <span class="c1">// Tratar como un SabeVolar</span>
       <span class="n">w</span><span class="p">(</span><span class="n">i</span><span class="p">);</span> <span class="c1">// Tratar como un PersonajeDeAccion</span>
     <span class="p">}</span>
   <span class="p">}</span>
</code></pre></div>

<h3 id="uso-correcto-de-la-herencia">Uso correcto de la herencia<a class="headerlink" href="#uso-correcto-de-la-herencia" title="Permanent link">&para;</a></h3>
<p>Hay dos formas de contemplar la herencia:</p>
<ul>
<li>
<p>Como <strong>tipo</strong>:</p>
<ul>
<li>Las clases son tipos y las subclases son subtipos</li>
<li>Las clases satisfacen la propiedad de <strong>substitución</strong> (LSP, Liskov Substitution Principle): toda operación que funciona para un objeto de la clase C también debe funcionar para un objeto de una subclase de C</li>
</ul>
</li>
<li>
<p>Como <strong>estructura</strong>:</p>
<ul>
<li>La herencia se usa como una forma cualquiera de estructurar programas</li>
<li>Esta visión es <strong>errónea</strong>, pues provoca que no se satisfaga la propiedad LSP</li>
</ul>
</li>
</ul>
<h4 id="ejemplo-herencia-como-estructura">Ejemplo: herencia como estructura<a class="headerlink" href="#ejemplo-herencia-como-estructura" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">Account</span> <span class="p">{</span>
  <span class="kt">float</span> <span class="n">balance</span><span class="p">;</span>
  <span class="kt">float</span> <span class="nf">getBalance</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">balance</span><span class="p">;</span> <span class="p">}</span>
  <span class="kt">void</span> <span class="nf">transferIn</span> <span class="p">(</span><span class="kt">float</span> <span class="n">amount</span><span class="p">)</span> <span class="p">{</span> <span class="n">balance</span> <span class="o">-=</span> <span class="n">amount</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">VerboseAccount</span> <span class="kd">extends</span> <span class="n">Account</span> <span class="p">{</span>
  <span class="kt">void</span> <span class="nf">verboseTransferIn</span> <span class="p">(</span><span class="kt">float</span> <span class="n">amount</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">super</span><span class="p">.</span><span class="na">transferIn</span><span class="p">(</span><span class="n">amount</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Balance: &quot;</span><span class="o">+</span><span class="n">balance</span><span class="p">);</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">AccountWithFee</span> <span class="kd">extends</span> <span class="n">VerboseAccount</span> <span class="p">{</span>
  <span class="kt">float</span> <span class="n">fee</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">void</span> <span class="nf">transferIn</span> <span class="p">(</span><span class="kt">float</span> <span class="n">amount</span><span class="p">)</span> <span class="p">{</span> <span class="kd">super</span><span class="p">.</span><span class="na">verboseTransferIn</span><span class="p">(</span><span class="n">amount</span><span class="o">-</span><span class="n">fee</span><span class="p">);</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li>Todos los objetos <span><span class="MathJax_Preview">a</span><script type="math/tex">a</script></span> de la clase <code>Account</code> deben cumplir que si <span><span class="MathJax_Preview">b=a.getBalance()</span><script type="math/tex">b=a.getBalance()</script></span> antes de ejecutar <span><span class="MathJax_Preview">a.transferIn(s)</span><script type="math/tex">a.transferIn(s)</script></span> y  <span><span class="MathJax_Preview">b´=a.getBalance()</span><script type="math/tex">b´=a.getBalance()</script></span> después de ejecutar <span><span class="MathJax_Preview">a.transferIn(s)</span><script type="math/tex">a.transferIn(s)</script></span>, entonces <span><span class="MathJax_Preview">b+s=b´</span><script type="math/tex">b+s=b´</script></span>.</li>
<li>Sin embargo, con la estructura <code>AccountWihFee</code> &lt; <code>VerboseAccount</code> &lt; <code>Account</code>, un objeto de tipo <code>AccountWithFee</code> no funciona bien cuando se contempla como un objeto <code>Account</code>. Considérese la siguiente secuencia:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kt">void</span> <span class="nf">f</span><span class="p">(</span><span class="n">Account</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">float</span> <span class="n">before</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="na">getBalance</span><span class="p">();</span>
  <span class="n">a</span><span class="p">.</span><span class="na">transferIn</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
  <span class="kt">float</span> <span class="n">after</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="na">getBalance</span><span class="p">();</span>
  <span class="c1">// Suppose a is of type AccountWithFee:</span>
  <span class="c1">//   before + 10 != after    !!</span>
  <span class="c1">//   before + 10-1 = after</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="polimorfismo"><span style="color:blue">Polimorfismo</span><a class="headerlink" href="#polimorfismo" title="Permanent link">&para;</a></h2>
<p><a id="polimorfismo"></a></p>
<p>Fenómeno por el que, cuando se llama a una operación de un objeto del que no se sabe su tipo específico, se ejecuta el método adecuado de acuerdo con su tipo.</p>
<p>El polimorfismo se basa en:</p>
<ul>
<li>
<p><strong>Enlace dinámico</strong>: se elige el método a ejecutar en tiempo de ejecución, en función de la clase de objeto; es la implementación del <em>polimorfismo</em></p>
</li>
<li>
<p><strong>Moldes (<em>casting</em>)</strong></p>
<ul>
<li><em>Upcasting</em>: Interpretar un objeto de una clase derivada como del mismo tipo que la clase base</li>
<li><em>Downcasting</em>: Interpretar un objeto de una clase base como del mismo tipo que una clase derivada suya</li>
</ul>
</li>
</ul>
<h1 id="caso-2-delegacion">Caso 2 - Delegación<a class="headerlink" href="#caso-2-delegacion" title="Permanent link">&para;</a></h1>
<p><a id="orquesta"></a></p>
<h2 id="implementacion-de-una-orquesta">Implementación de una orquesta<a class="headerlink" href="#implementacion-de-una-orquesta" title="Permanent link">&para;</a></h2>
<h3 id="version-inicial-orquesta-v01">Versión inicial: Orquesta v0.1<a class="headerlink" href="#version-inicial-orquesta-v01" title="Permanent link">&para;</a></h3>
<p>Criticar la solución siguiente (parte 1):</p>
<div class="codehilite"><pre><span></span><code>  <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Instrumento</span> <span class="p">{</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">tocar</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
      <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">afinarInstrumento</span><span class="p">(</span><span class="n">Instrumento</span> <span class="n">i</span><span class="p">)</span>
      <span class="p">{</span>
         <span class="c1">// Afinar en funcion del tipo de i</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="k">instanceof</span> <span class="n">Viento</span><span class="p">)</span>
            <span class="n">afinarViento</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
         <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="k">instanceof</span> <span class="n">Cuerda</span><span class="p">)</span>
            <span class="n">afinarCuerda</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
         <span class="c1">// Probar que esta afinado</span>
         <span class="n">i</span><span class="p">.</span><span class="na">tocar</span><span class="p">();</span>  
      <span class="p">}</span>
      <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">afinarViento</span><span class="p">(</span><span class="n">Viento</span> <span class="n">i</span><span class="p">)</span>
      <span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;afinal soplido&quot;</span><span class="p">);</span> <span class="p">}</span>

      <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">afinarCuerda</span><span class="p">(</span><span class="n">Cuerda</span> <span class="n">i</span><span class="p">)</span>
      <span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;afinar rasgado&quot;</span><span class="p">);</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">class</span> <span class="nc">Viento</span> <span class="kd">extends</span> <span class="n">Instrumento</span> <span class="p">{</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">tocar</span><span class="p">()</span> <span class="p">{</span> <span class="n">soplar</span><span class="p">();</span> <span class="p">}</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afinar</span><span class="p">()</span> <span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;afinar soplido&quot;</span><span class="p">);</span> <span class="p">}</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">soplar</span><span class="p">()</span> <span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;soplar&quot;</span><span class="p">);</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">class</span> <span class="nc">Cuerda</span> <span class="kd">extends</span> <span class="n">Instrumento</span> <span class="p">{</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">tocar</span><span class="p">()</span> <span class="p">{</span> <span class="n">rasgar</span><span class="p">();</span> <span class="p">}</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afinar</span><span class="p">()</span> <span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;afinar rasgado&quot;</span><span class="p">);</span> <span class="p">}</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">rasgar</span><span class="p">()</span> <span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;rasgar&quot;</span><span class="p">);</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Orquesta</span> <span class="p">{</span>
    <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Instrumento</span><span class="o">&gt;</span> <span class="n">instrumentos</span><span class="p">;</span>
    <span class="kd">public</span> <span class="nf">Orquesta</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">instrumentos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Instrumento</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span> <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">tocar</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">instrumentos</span><span class="p">.</span><span class="na">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
         <span class="n">instrumentos</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="na">tocar</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">instrumentos</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="n">Viento</span><span class="p">());</span>
      <span class="n">instrumentos</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="n">Cuerda</span><span class="p">());</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">instrumentos</span><span class="p">.</span><span class="na">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
         <span class="n">Instrumento</span><span class="p">.</span><span class="na">afinarInstrumento</span><span class="p">(</span>
                <span class="n">instrumentos</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
      <span class="n">tocar</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>

<h4 id="criticas-a-la-orquesta-v01">Críticas a la Orquesta v0.1<a class="headerlink" href="#criticas-a-la-orquesta-v01" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Acoplamiento</strong>: método <code>static</code></li>
<li><strong>Cohesión</strong>: ubicación de <code>main</code></li>
</ul>
<h3 id="implementacion-alternativa-orquesta-v02">Implementación alternativa: Orquesta v0.2<a class="headerlink" href="#implementacion-alternativa-orquesta-v02" title="Permanent link">&para;</a></h3>
<p>Usar polimorfismo. Seguir criticando la implementación...</p>
<div class="codehilite"><pre><span></span><code>  <span class="kd">class</span> <span class="nc">Orquesta</span> <span class="p">{</span>
    <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Instrumento</span><span class="o">&gt;</span> <span class="n">instrumentos</span><span class="p">;</span>
    <span class="kd">public</span> <span class="nf">Orquesta</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">instrumentos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Instrumento</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">tocar</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">instrumentos</span><span class="p">.</span><span class="na">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
         <span class="n">instrumentos</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="na">tocar</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afinar</span><span class="p">(</span><span class="n">Instrumento</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">i</span><span class="p">.</span><span class="na">afinar</span><span class="p">();</span>  <span class="c1">// Metodo polimorfico</span>
      <span class="n">i</span><span class="p">.</span><span class="na">tocar</span><span class="p">();</span>   <span class="c1">// Prueba de que esta afinado</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">PruebaOrquesta</span> <span class="p">{</span>
     <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Orquesta</span> <span class="n">orquesta</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Orquesta</span><span class="p">();</span>
        <span class="n">orquesta</span><span class="p">.</span><span class="na">instrumentos</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="n">Viento</span><span class="p">());</span>
        <span class="n">orquesta</span><span class="p">.</span><span class="na">instrumentos</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="n">Cuerda</span><span class="p">());</span>
        <span class="n">orquesta</span><span class="p">.</span><span class="na">instrumentos</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="n">Percusion</span><span class="p">());</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">instrumentos</span><span class="p">.</span><span class="na">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
           <span class="n">orquesta</span><span class="p">.</span><span class="na">afinar</span><span class="p">(</span><span class="n">orquesta</span><span class="p">.</span><span class="na">instrumentos</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
        <span class="n">orquesta</span><span class="p">.</span><span class="na">tocar</span><span class="p">();</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Instrumento</span> <span class="p">{</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">tocar</span><span class="p">()</span> <span class="p">{</span> <span class="p">};</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afinar</span><span class="p">()</span> <span class="p">{</span> <span class="p">};</span>
  <span class="p">}</span>

  <span class="kd">class</span> <span class="nc">Viento</span> <span class="kd">extends</span> <span class="n">Instrumento</span> <span class="p">{</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">tocar</span><span class="p">()</span> <span class="p">{</span> <span class="n">soplar</span><span class="p">();</span> <span class="p">}</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afinar</span><span class="p">()</span> <span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;afinar soplido&quot;</span><span class="p">);</span> <span class="p">}</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">soplar</span><span class="p">()</span> <span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;soplar&quot;</span><span class="p">);</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">class</span> <span class="nc">Cuerda</span> <span class="kd">extends</span> <span class="n">Instrumento</span> <span class="p">{</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">tocar</span><span class="p">()</span> <span class="p">{</span> <span class="n">rasgar</span><span class="p">();</span> <span class="p">}</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afinar</span><span class="p">()</span> <span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;afinar rasgado&quot;</span><span class="p">);</span> <span class="p">}</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">rasgar</span><span class="p">()</span> <span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;rasgar&quot;</span><span class="p">);</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">class</span> <span class="nc">Percusion</span> <span class="kd">extends</span> <span class="n">Instrumento</span> <span class="p">{</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">tocar</span><span class="p">()</span> <span class="p">{</span> <span class="n">golpear</span><span class="p">();</span> <span class="p">}</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afinar</span><span class="p">()</span> <span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;afinar golpeado&quot;</span><span class="p">);</span> <span class="p">}</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">golpear</span><span class="p">()</span> <span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;golpear&quot;</span><span class="p">);</span> <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>

<h4 id="criticas-a-la-orquesta-v02">Críticas a la Orquesta v0.2<a class="headerlink" href="#criticas-a-la-orquesta-v02" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Encapsulación</strong>: método <code>add</code></li>
<li><strong>Encapsulación</strong>: visibilidad de <code>Orquesta::instrumentos</code> (en C++ sería <code>friend</code>)</li>
<li><strong>Flexibilidad</strong>: la implementación <code>Orquesta::instrumentos</code> puede variar, pero no hay colección (agregado) en quien confíe <code>Orquesta</code> por delegación.</li>
</ul>
<h3 id="implementacion-alternativa-orquesta-v03">Implementación alternativa: Orquesta v0.3<a class="headerlink" href="#implementacion-alternativa-orquesta-v03" title="Permanent link">&para;</a></h3>
<p>Delegar las altas/bajas de <code>Instrumento</code> en la colección (agregado) de <code>Orquesta</code>:</p>
<div class="codehilite"><pre><span></span><code>  <span class="kd">class</span> <span class="nc">Orquesta</span> <span class="p">{</span>

    <span class="kd">protected</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Instrumento</span><span class="o">&gt;</span> <span class="n">instrumentos</span><span class="p">;</span>

    <span class="kd">public</span> <span class="nf">Orquesta</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">instrumentos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Instrumento</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">addInstrumento</span><span class="p">(</span><span class="n">Instrumento</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">return</span> <span class="n">instrumentos</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">removeInstrumento</span><span class="p">(</span><span class="n">Instrumento</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">return</span> <span class="n">instrumentos</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">tocar</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">instrumentos</span><span class="p">.</span><span class="na">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
         <span class="n">instrumentos</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="na">tocar</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afinar</span><span class="p">(</span><span class="n">Instrumento</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">i</span><span class="p">.</span><span class="na">afinar</span><span class="p">();</span>
      <span class="n">i</span><span class="p">.</span><span class="na">tocar</span><span class="p">();</span> <span class="c1">// Prueba de que esta afinado</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">PruebaOrquesta</span> <span class="p">{</span>
     <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Orquesta</span> <span class="n">orquesta</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Orquesta</span><span class="p">();</span>
        <span class="n">orquesta</span><span class="p">.</span><span class="na">addInstrumento</span><span class="p">(</span><span class="k">new</span> <span class="n">Viento</span><span class="p">());</span>
        <span class="n">orquesta</span><span class="p">.</span><span class="na">addInstrumento</span><span class="p">(</span><span class="k">new</span> <span class="n">Cuerda</span><span class="p">());</span>
        <span class="n">orquesta</span><span class="p">.</span><span class="na">addInstrumento</span><span class="p">(</span><span class="k">new</span> <span class="n">Percusion</span><span class="p">());</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">orquesta</span><span class="p">.</span><span class="na">instrumentos</span><span class="p">.</span><span class="na">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
           <span class="n">orquesta</span><span class="p">.</span><span class="na">afinar</span><span class="p">(</span><span class="n">orquesta</span><span class="p">.</span><span class="na">instrumentos</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
        <span class="n">orquesta</span><span class="p">.</span><span class="na">tocar</span><span class="p">();</span>
     <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>

<h4 id="criticas-a-la-orquesta-v03">Críticas a la Orquesta v0.3:<a class="headerlink" href="#criticas-a-la-orquesta-v03" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Acoplamiento</strong>: <code>PruebaOrquesta</code> conoce la implementación basada en un <code>ArrayList</code> de la colección de instrumentos de la orquesta.</li>
<li><strong>Variabilidad</strong>: ¿La colección de instrumentos será siempre lineal?</li>
</ul>
<h3 id="implementacion-alternativa-orquesta-v04">Implementación alternativa: Orquesta v0.4<a class="headerlink" href="#implementacion-alternativa-orquesta-v04" title="Permanent link">&para;</a></h3>
<p>Definir una <strong>interfaz</strong> para iterar en la colección de instrumentos:</p>
<div class="codehilite"><pre><span></span><code>  <span class="kd">class</span> <span class="nc">Orquesta</span> <span class="p">{</span>
    <span class="kd">protected</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Instrumento</span><span class="o">&gt;</span> <span class="n">instrumentos</span><span class="p">;</span>
    <span class="kd">public</span> <span class="nf">Orquesta</span><span class="p">()</span> <span class="p">{</span>
       <span class="n">instrumentos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Instrumento</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">addInstrumento</span><span class="p">(</span><span class="n">Instrumento</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">return</span> <span class="n">instrumentos</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">removeInstrumento</span><span class="p">(</span><span class="n">Instrumento</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">return</span> <span class="n">instrumentos</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">tocar</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">for</span> <span class="p">(</span><span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Instrumento</span><span class="o">&gt;</span> <span class="n">i</span> <span class="o">=</span> <span class="n">instrumentos</span><span class="p">.</span><span class="na">iterator</span><span class="p">();</span> <span class="n">i</span><span class="p">.</span><span class="na">hasNext</span><span class="p">();</span> <span class="p">)</span>
          <span class="n">i</span><span class="p">.</span><span class="na">next</span><span class="p">().</span><span class="na">tocar</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afinar</span><span class="p">(</span><span class="n">Instrumento</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">i</span><span class="p">.</span><span class="na">afinar</span><span class="p">();</span>
       <span class="n">i</span><span class="p">.</span><span class="na">tocar</span><span class="p">();</span> <span class="c1">// Prueba de que esta afinado</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">PruebaOrquesta</span> <span class="p">{</span>
     <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Orquesta</span> <span class="n">orquesta</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Orquesta</span><span class="p">();</span>
        <span class="n">orquesta</span><span class="p">.</span><span class="na">addInstrumento</span><span class="p">(</span><span class="k">new</span> <span class="n">Viento</span><span class="p">());</span>
        <span class="n">orquesta</span><span class="p">.</span><span class="na">addInstrumento</span><span class="p">(</span><span class="k">new</span> <span class="n">Cuerda</span><span class="p">());</span>
        <span class="n">orquesta</span><span class="p">.</span><span class="na">addInstrumento</span><span class="p">(</span><span class="k">new</span> <span class="n">Percusion</span><span class="p">());</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Instrumento</span><span class="o">&gt;</span> <span class="n">i</span> <span class="o">=</span> <span class="n">orquesta</span><span class="p">.</span><span class="na">instrumentos</span><span class="p">.</span><span class="na">iterator</span><span class="p">();</span> <span class="n">i</span><span class="p">.</span><span class="na">hasNext</span><span class="p">();</span> <span class="p">)</span>
           <span class="n">orquesta</span><span class="p">.</span><span class="na">afinar</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="na">next</span><span class="p">());</span>
        <span class="n">orquesta</span><span class="p">.</span><span class="na">tocar</span><span class="p">();</span>
     <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>

<h4 id="criticas-a-la-orquesta-v04">Críticas a la Orquesta v0.4<a class="headerlink" href="#criticas-a-la-orquesta-v04" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Ocultación</strong>: el atributo <code>instrumentos</code> sigue sin ser privado.</li>
</ul>
<p>Rehacemos la implementación, aprovechando que aparece una nueva versión del lenguaje (Java JDK 1.5) que permite iterar haciendo un <strong><em>for each</em></strong> sobre una colección que implemente la interfaz <code>Iterable</code>. </p>
<h3 id="implementacion-alternativa-orquesta-v05">Implementación alternativa: Orquesta v0.5<a class="headerlink" href="#implementacion-alternativa-orquesta-v05" title="Permanent link">&para;</a></h3>
<p>Usando delegación + interfaces y el <em>for each</em> de Java 1.5:</p>
<p>Criticar...</p>
<div class="codehilite"><pre><span></span><code>  <span class="kd">class</span> <span class="nc">Orquesta</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Instrumento</span><span class="o">&gt;</span> <span class="n">instrumentos</span><span class="p">;</span>
    <span class="kd">public</span> <span class="nf">Orquesta</span><span class="p">()</span> <span class="p">{</span>
       <span class="n">instrumentos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Instrumento</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">addInstrumento</span><span class="p">(</span><span class="n">Instrumento</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">return</span> <span class="n">instrumentos</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">removeInstrumento</span><span class="p">(</span><span class="n">Instrumento</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">return</span> <span class="n">instrumentos</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Instrumento</span><span class="o">&gt;</span> <span class="nf">instrumentos</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">instrumentos</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">tocar</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">for</span> <span class="p">(</span><span class="n">Instrumento</span> <span class="n">i</span><span class="p">:</span> <span class="n">instrumentos</span><span class="p">)</span>
          <span class="n">i</span><span class="p">.</span><span class="na">tocar</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afinar</span><span class="p">(</span><span class="n">Instrumento</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">i</span><span class="p">.</span><span class="na">afinar</span><span class="p">();</span>
       <span class="n">i</span><span class="p">.</span><span class="na">tocar</span><span class="p">();</span> <span class="c1">// Prueba de que esta afinado</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">PruebaOrquesta</span> <span class="p">{</span>
     <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Orquesta</span> <span class="n">orquesta</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Orquesta</span><span class="p">();</span>
        <span class="n">orquesta</span><span class="p">.</span><span class="na">addInstrumento</span><span class="p">(</span><span class="k">new</span> <span class="n">Viento</span><span class="p">());</span>
        <span class="n">orquesta</span><span class="p">.</span><span class="na">addInstrumento</span><span class="p">(</span><span class="k">new</span> <span class="n">Cuerda</span><span class="p">());</span>
        <span class="n">orquesta</span><span class="p">.</span><span class="na">addInstrumento</span><span class="p">(</span><span class="k">new</span> <span class="n">Percusion</span><span class="p">());</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">Instrumento</span> <span class="n">i</span><span class="p">:</span> <span class="n">orquesta</span><span class="p">.</span><span class="na">instrumentos</span><span class="p">())</span>
           <span class="n">orquesta</span><span class="p">.</span><span class="na">afinar</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="n">orquesta</span><span class="p">.</span><span class="na">tocar</span><span class="p">();</span>
     <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>

<h4 id="criticas-a-la-orquesta-v05">Críticas a la Orquesta v0.5:<a class="headerlink" href="#criticas-a-la-orquesta-v05" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Ocultación</strong>: la interfaz del método <code>instrumentos()</code> sigue expuesta: el cliente sabe que devuelve una <code>List</code>.</li>
<li>Hemos ocultado un poco la implementación de <code>instrumentos</code> (que es una <code>List</code>), pero ¿conviene saber que es una <code>List</code>? Quizá no hemos ocultado lo suficiente.</li>
</ul>
<h3 id="implementacion-alternativa-orquesta-v06">Implementación alternativa: Orquesta v0.6<a class="headerlink" href="#implementacion-alternativa-orquesta-v06" title="Permanent link">&para;</a></h3>
<p>Nos quedamos sólo con lo que nos interesa de la Orquesta: que es una colección iterable.</p>
<p>Eliminamos lo que no nos interesa: el resto de elementos de la interfaz <code>List</code> que explican la forma lineal de almacenar los instrumentos.</p>
<div class="codehilite"><pre><span></span><code>  <span class="kd">class</span> <span class="nc">Orquesta</span> <span class="kd">implements</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Instrumento</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Instrumento</span><span class="o">&gt;</span> <span class="n">instrumentos</span><span class="p">;</span>
    <span class="kd">public</span> <span class="nf">Orquesta</span><span class="p">()</span> <span class="p">{</span>
       <span class="n">instrumentos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Instrumento</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">addInstrumento</span><span class="p">(</span><span class="n">Instrumento</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">return</span> <span class="n">instrumentos</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">removeInstrumento</span><span class="p">(</span><span class="n">Instrumento</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">return</span> <span class="n">instrumentos</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Instrumento</span><span class="o">&gt;</span> <span class="nf">iterator</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">return</span> <span class="n">instrumentos</span><span class="p">.</span><span class="na">iterator</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">tocar</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">for</span> <span class="p">(</span><span class="n">Instrumento</span> <span class="n">i</span><span class="p">:</span> <span class="k">this</span><span class="p">)</span>
          <span class="n">i</span><span class="p">.</span><span class="na">tocar</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afinar</span><span class="p">(</span><span class="n">Instrumento</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">i</span><span class="p">.</span><span class="na">afinar</span><span class="p">();</span>
      <span class="n">i</span><span class="p">.</span><span class="na">tocar</span><span class="p">();</span> <span class="c1">// Prueba de que esta afinado</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">PruebaOrquesta</span> <span class="p">{</span>
     <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Orquesta</span> <span class="n">orquesta</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Orquesta</span><span class="p">();</span>
        <span class="n">orquesta</span><span class="p">.</span><span class="na">addInstrumento</span><span class="p">(</span><span class="k">new</span> <span class="n">Viento</span><span class="p">());</span>
        <span class="n">orquesta</span><span class="p">.</span><span class="na">addInstrumento</span><span class="p">(</span><span class="k">new</span> <span class="n">Cuerda</span><span class="p">());</span>
        <span class="n">orquesta</span><span class="p">.</span><span class="na">addInstrumento</span><span class="p">(</span><span class="k">new</span> <span class="n">Percusion</span><span class="p">());</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">Instrumento</span> <span class="n">i</span><span class="p">:</span> <span class="n">orquesta</span><span class="p">)</span>
           <span class="n">orquesta</span><span class="p">.</span><span class="na">afinar</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="n">orquesta</span><span class="p">.</span><span class="na">tocar</span><span class="p">();</span>
     <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>

<h3 id="implementacion-alternativa-orquesta-v07">Implementación alternativa: Orquesta v0.7<a class="headerlink" href="#implementacion-alternativa-orquesta-v07" title="Permanent link">&para;</a></h3>
<p>Supongamos que queremos sustituir la implementación basada en una <code>List</code> por otra (quizá más eficiente) basada en un <code>Map</code>.</p>
<p><strong>Nota</strong>: La interfaz <a href="http://docs.oracle.com/javase/6/docs/api/java/util/Map.html"><code>java.util.Map</code></a> declara los métodos siguientes:</p>
<div class="codehilite"><pre><span></span><code>clear() void – Map
containsKey(Object key) boolean – Map
containsValue(Object value) boolean – Map
entrySet() Set – Map
equals(Object o) boolean – Map
get(Object key) Object – Map
getClass() Class&lt;? extends Object&gt; – Object
hashCode() int – Map
isEmpty() boolean – Map
keySet() Set – Map
notify() void – Object
notifyAll() void – Object
put(Object key, Object value) Object – Map
putAll(Map t) void – Map
remove(Object key) Object – Map
size() int – Map
toString() String – Object
values() Collection – Map
wait() void – Object
wait(long timeout) void – Object
wait(long timeout, int nanos) void – Object
</code></pre></div>

<p>Pero ¡<code>Map</code> no implementa <code>Iterable</code>!</p>
<p>Existe una cierta tensión proveedor-cliente en la <strong>frontera</strong> de la interfaz</p>
<ul>
<li>Los proveedores de packages y frameworks quieren ampliar aplicabilidad</li>
<li>Los clientes quieren una interfaz centrada en sus necesidades particulares</li>
</ul>
<p>Construimos un <code>Map</code> y lo pasamos.</p>
<ul>
<li>Primera opción: Ninguno de los receptores deberá poder borrar algo del map. Pero ¡hay un <code>clear()</code> en el <code>Map</code>!</li>
<li>Segunda opción: solo algunos tipos de objetos deben poderse guardar. Pero ¡los tipos de objeto a guardar no están restringidos en un <code>Map</code>!</li>
</ul>
<p>¿La interfaz <code>Map</code> es siempre satisfactoria? ¿seguro que no va a cambiar?</p>
<ul>
<li>JDK &lt; 5.0:</li>
</ul>
<div class="codehilite"><pre><span></span><code>      <span class="n">Map</span> <span class="n">sensors</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="p">();</span>
      <span class="p">...</span>
      <span class="n">Sensor</span> <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">Sensor</span><span class="p">)</span><span class="n">sensors</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">sensorId</span><span class="p">);</span>
</code></pre></div>

<ul>
<li>JDK &gt;= 5.0:</li>
</ul>
<div class="codehilite"><pre><span></span><code>      <span class="n">Map</span><span class="o">&lt;</span><span class="n">Sensor</span><span class="o">&gt;</span> <span class="n">sensors</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">Sensor</span><span class="o">&gt;</span><span class="p">();</span>
      <span class="p">...</span>
      <span class="n">Sensor</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sensors</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">sensorId</span><span class="p">);</span>
</code></pre></div>

<p><strong>Conclusión</strong>: <code>Map&lt;Sensor&gt;</code> ofrece más de lo que necesitamos</p>
<div class="codehilite"><pre><span></span><code>      <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Sensors</span> <span class="p">{</span>
        <span class="kd">private</span> <span class="n">Map</span> <span class="n">sensors</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="p">();</span>
        <span class="kd">public</span> <span class="n">Sensor</span> <span class="nf">getById</span><span class="p">(</span><span class="n">String</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="p">(</span><span class="n">Sensor</span><span class="p">)</span> <span class="n">sensors</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="c1">//...</span>
      <span class="p">}</span>
</code></pre></div>

<ul>
<li>La interfaz <code>Map</code> queda oculta</li>
<li>Filtramos los métodos que no nos sirven</li>
<li>Más fácil de hacer evolucionar sin impacto en el resto de la aplicación</li>
<li>El casting queda confinado en la clase Sensors, que es más seguro</li>
</ul>
<p><strong><span style="color:blue">Interfaces de frontera<span></strong>: No todo uso de <code>Map</code> o interfaz de frontera debe quedar encapsulado. Sólo es un consejo para no <em>pasar la interfaz</em> con métodos que no vamos a necesitar.</p>
<p>Así que proponemos esta implementación de la Orquesta:</p>
<div class="codehilite"><pre><span></span><code>  <span class="kd">class</span> <span class="nc">Orquesta</span> <span class="kd">implements</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Instrumento</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="n">Instrumentos</span> <span class="n">instrumentos</span><span class="p">;</span>
    <span class="kd">public</span> <span class="nf">Orquesta</span><span class="p">()</span> <span class="p">{</span>
       <span class="n">instrumentos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Instrumentos</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">addInstrumento</span><span class="p">(</span><span class="n">Instrumento</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">return</span> <span class="n">instrumentos</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">removeInstrumento</span><span class="p">(</span><span class="n">Instrumento</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">return</span> <span class="n">instrumentos</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Instrumento</span><span class="o">&gt;</span> <span class="nf">iterator</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">return</span> <span class="n">instrumentos</span><span class="p">.</span><span class="na">iterator</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">tocar</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">for</span> <span class="p">(</span><span class="n">Instrumento</span> <span class="n">i</span><span class="p">:</span> <span class="k">this</span><span class="p">)</span>
          <span class="n">i</span><span class="p">.</span><span class="na">tocar</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afinar</span><span class="p">(</span><span class="n">Instrumento</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">i</span><span class="p">.</span><span class="na">afinar</span><span class="p">();</span>
      <span class="n">i</span><span class="p">.</span><span class="na">tocar</span><span class="p">();</span> <span class="c1">// Prueba de que esta afinado</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Instrumentos</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="n">List</span> <span class="n">instrumentos</span><span class="p">;</span>
    <span class="kd">public</span> <span class="nf">Instrumentos</span><span class="p">(</span><span class="kt">int</span> <span class="n">numero</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">instrumentos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">numero</span><span class="o">&gt;</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="n">Instrumento</span> <span class="nf">addInstrumento</span><span class="p">(</span><span class="n">Instrumento</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">instrumentos</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="n">Instrumento</span> <span class="nf">removeInstrumento</span><span class="p">(</span><span class="n">Instrumento</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">instrumentos</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">PruebaOrquesta</span> <span class="p">{</span>
     <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Orquesta</span> <span class="n">orquesta</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Orquesta</span><span class="p">();</span>
        <span class="n">orquesta</span><span class="p">.</span><span class="na">addInstrumento</span><span class="p">(</span><span class="k">new</span> <span class="n">Viento</span><span class="p">());</span>
        <span class="n">orquesta</span><span class="p">.</span><span class="na">addInstrumento</span><span class="p">(</span><span class="k">new</span> <span class="n">Cuerda</span><span class="p">());</span>
        <span class="n">orquesta</span><span class="p">.</span><span class="na">addInstrumento</span><span class="p">(</span><span class="k">new</span> <span class="n">Percusion</span><span class="p">());</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">Instrumento</span> <span class="n">i</span><span class="p">:</span> <span class="n">orquesta</span><span class="p">)</span>
           <span class="n">orquesta</span><span class="p">.</span><span class="na">afinar</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="n">orquesta</span><span class="p">.</span><span class="na">tocar</span><span class="p">();</span>
     <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>

<p>Esta implementación sí que podemos adaptarla más fácilmente para cambiar el <code>List</code> por un <code>Map</code>, pues la responsabilidad de ser iterable ha quedado confinada en <code>Instrumentos</code>, que desacopla <code>Orquesta</code> y la implementación elegida (<code>List</code>, <code>Map</code>, etc.) para la colección de instrumentos.</p>
<h3 id="implementacion-final-orquesta-v08">Implementación final: Orquesta v0.8<a class="headerlink" href="#implementacion-final-orquesta-v08" title="Permanent link">&para;</a></h3>
<p>Los <code>new</code> de <code>PruebaOrquesta</code> siguen introduciendo dependencias de <code>PruebaOrquesta</code> con respecto a los tipos concretos de <code>Instrumento</code>.</p>
<div class="admonition warning">
<p class="admonition-title">Ver antes el apartado <a href="#inyeccion">inyección de dependencias</a></p>
</div>
<h4 id="construccion-con-spring">Construcción con spring<a class="headerlink" href="#construccion-con-spring" title="Permanent link">&para;</a></h4>
<p>A través de un fichero de configuración <code>orquesta.xml</code> le indicamos los valores inyectables:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE beans PUBLIC &quot;-//SPRING//DTD BEAN//EN&quot;</span>
<span class="cp">  &quot;http://www.springframework.org/dtd/spring-beans.dtd&quot;&gt;</span>
<span class="nt">&lt;beans&gt;</span>
  <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;trompeta&quot;</span>
    <span class="na">class=</span><span class="s">&quot;Viento&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;violin&quot;</span>
    <span class="na">class=</span><span class="s">&quot;Cuerda&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;tambor&quot;</span>
    <span class="na">class=</span><span class="s">&quot;Percusion&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;viola&quot;</span>
    <span class="na">class=</span><span class="s">&quot;Cuerda&quot;</span><span class="nt">/&gt;</span>

  <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;cuarteto&quot;</span>
    <span class="na">class=</span><span class="s">&quot;Orquesta&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;instrumento1&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">&quot;trompeta&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;instrumento2&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">&quot;violin&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;instrumento3&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">&quot;viola&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;instrumento4&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">&quot;tambor&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/property&gt;</span>    
  <span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</code></pre></div>

<p>La inyección de la dependencia concreta la hace el contenedor (<em>spring</em> en este ejemplo):</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">org.springframework.beans.factory.BeanFactory</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.xml.XmlBeanFactory</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PruebaOrquesta</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
    <span class="n">BeanFactory</span> <span class="n">factory</span> <span class="o">=</span>
      <span class="k">new</span> <span class="n">XmlBeanFactory</span><span class="p">(</span><span class="k">new</span> <span class="n">FileInputStream</span><span class="p">(</span><span class="s">&quot;orquesta.xml&quot;</span><span class="p">));</span>
    <span class="n">Orquesta</span> <span class="n">orquesta</span> <span class="o">=</span>
      <span class="p">(</span><span class="n">Orquesta</span><span class="p">)</span> <span class="n">factory</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="s">&quot;cuarteto&quot;</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">Instrumento</span> <span class="n">i</span><span class="p">:</span> <span class="n">orquesta</span><span class="p">)</span>
           <span class="n">orquesta</span><span class="p">.</span><span class="na">afinar</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="n">orquesta</span><span class="p">.</span><span class="na">tocar</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Un <em>bean</em> es una clase/componente reutilizable en Java que tiene una interfaz bien definida, según una especificación estándar de Java, que permite a un contenedor gestionar su <em>ciclo de vida</em> (crearlos, cambiarles valores de sus propiedades, destruirlos, etc.) Los <em>beans</em> son usados por muchos frameworks, entre otros Spring:</p>
<ul>
<li><a href="https://www.baeldung.com/spring-bean">Spring Bean</a></li>
<li><a href="http://www.baeldung.com/spring-factorybean">Spring FactoryBean</a></li>
</ul>
<h2 id="composicion-y-dependencias"><span style="color:blue">Composición y dependencias</span><a class="headerlink" href="#composicion-y-dependencias" title="Permanent link">&para;</a></h2>
<p><a id="composicion"></a></p>
<p>Delegación <em>en horizontal</em> hacia otras clases cuya interfaz es bien conocida</p>
<ul>
<li>Los objetos miembro <strong>delegados</strong> son cambiables en tiempo de ejecución sin afectar al código cliente ya existente</li>
<li>Alternativa más flexible que la herencia. Ejemplo: <code>Cola extends ArrayList</code> implica que una cola va a implementarse como un <code>ArrayList</code> para toda la vida, sin posibilidad de cambio en ejecución</li>
</ul>
<h3 id="composicion-vs-herencia"><span style="color:blue">Composición vs. Herencia</span><a class="headerlink" href="#composicion-vs-herencia" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>Composición</strong> (delegación <em>en horizontal</em>)</p>
<ul>
<li>Sirve cuando hacen falta las características de una clase existente dentro de una nueva, pero no su interfaz.</li>
<li>Los objetos miembro privados pueden cambiarse en tiempo de ejecución.</li>
<li>Los cambios en el objeto miembro no afectan al código del cliente.</li>
</ul>
</li>
<li>
<p><strong>Herencia</strong> (delegación <em>en vertical</em>)</p>
<ul>
<li>Sirve para hacer una versión especial de una clase existente, reutilizando su interfaz.</li>
<li>La relación de herencia en los lenguajes de programación <em>suele ser</em> <strong>estática</strong> (definida en tiempo de compilación) y no <strong>dinámica</strong> (que pueda cambiarse en tiempo de ejecución).</li>
<li>Permite re-interpretar el tipo de un objeto en tiempo de ejecución.</li>
</ul>
</li>
</ul>
<h3 id="ejemplo-implementacion-de-identificadores">Ejemplo: implementación de identificadores<a class="headerlink" href="#ejemplo-implementacion-de-identificadores" title="Permanent link">&para;</a></h3>
<h4 id="handler-en-java">Handler en Java<a class="headerlink" href="#handler-en-java" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code>  <span class="kd">interface</span> <span class="nc">Handler</span><span class="p">{</span>
      <span class="n">String</span> <span class="nf">toString</span><span class="p">();</span>
      <span class="kt">int</span> <span class="nf">compareTo</span><span class="p">(</span><span class="n">Handler</span> <span class="n">otro</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kd">class</span> <span class="nc">IdentificadorNumerico</span> <span class="kd">implements</span> <span class="n">Handler</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="p">;</span>
    <span class="n">IdentificadorNumerico</span> <span class="p">(</span><span class="n">String</span> <span class="n">id</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">NumberFormatException</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="na">id</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Integer</span><span class="p">(</span><span class="n">id</span><span class="p">).</span><span class="na">intValue</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="n">Integer</span><span class="p">(</span><span class="n">id</span><span class="p">).</span><span class="na">toString</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="p">(</span><span class="n">Handler</span> <span class="n">otro</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">toString</span><span class="p">().</span><span class="na">compareTo</span><span class="p">(</span><span class="n">otro</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>

<h4 id="implementacion-utilizando-comparable">Implementación utilizando <code>Comparable</code><a class="headerlink" href="#implementacion-utilizando-comparable" title="Permanent link">&para;</a></h4>
<p><code>java.lang.Comparable</code> es una interfaz implementada por <code>String</code>, <code>File</code>, <code>Date</code>, etc. y todas las llamadas <em>clases de envoltura</em> del JDK (i.e. <code>Integer</code>, <code>Long</code>, etc.)</p>
<h5 id="metodos-de-la-interfaz">Métodos de la interfaz<a class="headerlink" href="#metodos-de-la-interfaz" title="Permanent link">&para;</a></h5>
<ul>
<li>JDK 1.4:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Comparable</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="p">(</span><span class="n">Object</span> <span class="n">o</span><span class="p">);</span> <span class="c1">//throws ClassCastException</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li>JDK 1.5:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Comparable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="p">(</span><span class="n">T</span> <span class="n">o</span><span class="p">);</span> <span class="c1">//throws ClassCastException</span>
<span class="p">}</span>
</code></pre></div>

<h5 id="invariantes">Invariantes<a class="headerlink" href="#invariantes" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>Anticonmutativa: <code>sgn(x.compareTo(y)) = -sgn(y.compareTo(x))</code></p>
</li>
<li>
<p>Transitividad: <code>(x.compareTo(y)&gt;0 and y.compareTo(z)&gt;0)</code> &rarr; <code>x.compareTo(z)&gt;0</code></p>
</li>
<li>
<p><code>x.compareTo(y)=0</code> &rarr; <code>sgn(x.compareTo(z))=sgn(y.compareTo(z))</code> <span><span class="MathJax_Preview">\forall</span><script type="math/tex">\forall</script></span> <code>z</code></p>
</li>
<li>
<p>Consistencia con <code>equals</code> (no obligatoria): <code>(x.compareTo(y)=0)</code> &larr; <code>(x.equals(y))</code></p>
</li>
</ul>
<h5 id="identificador-de-bankaccount-implementacion-en-java-15">Identificador de BankAccount: Implementación en Java 1.5<a class="headerlink" href="#identificador-de-bankaccount-implementacion-en-java-15" title="Permanent link">&para;</a></h5>
<ul>
<li>Utilizando <em>templates</em></li>
<li>Delegar en <code>compareTo</code> y <code>equals</code> del tipo de id <em>envuelto</em> (e.g. <code>String</code>)</li>
</ul>
<h5 id="identificador-de-bankaccount-implementacion-en-java-14">Identificador de BankAccount: Implementación en Java 1.4<a class="headerlink" href="#identificador-de-bankaccount-implementacion-en-java-14" title="Permanent link">&para;</a></h5>
<ul>
<li>No hay plantillas. La genericidad se consigue con <code>Object</code>. Hay que hacer casting.</li>
<li>Cuidado con <code>Boolean</code> que no implementa <code>Comparable</code> en JDK 1.4</li>
</ul>
<div class="superfences-tabs">
<input name="__tabs_1" type="radio" id="__tab_1_0" checked="checked" />
<label for="__tab_1_0">Java ≥ 1.5</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">java.util.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">BankAccount</span> <span class="kd">implements</span> <span class="n">Comparable</span><span class="o">&lt;</span><span class="n">BankAccount</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">id</span><span class="p">;</span>
  <span class="kd">public</span> <span class="nf">BankAccount</span> <span class="p">(</span><span class="n">String</span> <span class="n">number</span><span class="p">)</span>  <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">number</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getId</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">id</span><span class="p">;</span> <span class="p">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="p">(</span><span class="n">BankAccount</span> <span class="n">other</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">other</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">assert</span> <span class="k">this</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="p">:</span> <span class="s">&quot;compareTo inconsistent with equals.&quot;</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
  <span class="p">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="p">(</span><span class="n">Object</span> <span class="n">other</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">other</span><span class="p">)</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">other</span> <span class="k">instanceof</span> <span class="n">BankAccount</span><span class="p">))</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="n">BankAccount</span> <span class="n">that</span> <span class="o">=</span> <span class="p">(</span><span class="n">BankAccount</span><span class="p">)</span><span class="n">other</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">that</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
   <span class="p">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">id</span><span class="p">.</span><span class="na">toString</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<input name="__tabs_1" type="radio" id="__tab_1_1" />
<label for="__tab_1_1">Java ≤ 1.4</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">java.util.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">BankAccount</span> <span class="kd">implements</span> <span class="n">Comparable</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">id</span><span class="p">;</span>
  <span class="kd">public</span> <span class="nf">BankAccount</span> <span class="p">(</span><span class="n">String</span> <span class="n">number</span><span class="p">)</span>  <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">number</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getId</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">id</span><span class="p">;</span> <span class="p">}</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="p">(</span><span class="n">Object</span> <span class="n">other</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">other</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">other</span> <span class="k">instanceof</span> <span class="n">BankAccount</span><span class="p">)</span> <span class="p">:</span> <span class="s">&quot;compareTo comparing objects of different type&quot;</span><span class="p">;</span>
    <span class="n">BankAccount</span> <span class="n">that</span> <span class="o">=</span> <span class="p">(</span><span class="n">BankAccount</span><span class="p">)</span><span class="n">other</span><span class="p">;</span>
    <span class="k">assert</span> <span class="k">this</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">that</span><span class="p">)</span> <span class="p">:</span> <span class="s">&quot;compareTo inconsistent with equals.&quot;</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="n">that</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="p">(</span><span class="n">Object</span> <span class="n">other</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">other</span><span class="p">)</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">other</span> <span class="k">instanceof</span> <span class="n">BankAccount</span><span class="p">))</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="n">BankAccount</span> <span class="n">that</span> <span class="o">=</span> <span class="p">(</span><span class="n">BankAccount</span><span class="p">)</span><span class="n">other</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">that</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">id</span><span class="p">.</span><span class="na">toString</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
</div>
<p>Cuando una clase hereda de una clase concreta que implementa <code>Comparable</code> y le añade un campo significativo para la comparación, no se puede construir una implementación correcta de <code>compareTo</code>. La única alternativa entonces es la composición en lugar de la herencia.</p>
<p>Una alternativa (no excluyente) a implementar <code>Comparable</code> es pasar un <code>Comparator</code> como parámetro (se prefiere <strong>composición</strong> frente a <strong>herencia</strong>):</p>
<ul>
<li>Si <code>BankAccount</code> implementa <code>Comparable</code>:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">BankAccountComparator</span> <span class="kd">implements</span> <span class="n">java</span><span class="p">.</span><span class="na">util</span><span class="p">.</span><span class="na">Comparator</span><span class="o">&lt;</span><span class="n">BankAccount</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="p">(</span><span class="n">BankAccount</span> <span class="n">o1</span><span class="p">,</span> <span class="n">BankAccount</span> <span class="n">o2</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">o1</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="n">o2</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li>Si <code>BankAccount</code> no implementa <code>Comparable</code>:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">BankAccountComparator</span> <span class="kd">implements</span> <span class="n">java</span><span class="p">.</span><span class="na">util</span><span class="p">.</span><span class="na">Comparator</span><span class="o">&lt;</span><span class="n">BankAccount</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="p">(</span><span class="n">BankAccount</span> <span class="n">o1</span><span class="p">,</span> <span class="n">BankAccount</span> <span class="n">o2</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">compare</span><span class="p">(</span><span class="n">o1</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span> <span class="n">o2</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><span style="color:red;">¿Qué ventajas tiene la opción que usa <strong>Composición</strong> frente a la que usa <strong>Herencia (estática)</strong>?</span></p>
<p>La respuesta está en la <a href="#inyeccion">inyección de dependencias</a>...</p>
<p><a id="inyeccion"></a></p>
<h1 id="caso-3-inyeccion-de-dependencias">Caso 3 - Inyección de dependencias<a class="headerlink" href="#caso-3-inyeccion-de-dependencias" title="Permanent link">&para;</a></h1>
<h2 id="caballeros-de-la-mesa-redonda">Caballeros de la mesa redonda<a class="headerlink" href="#caballeros-de-la-mesa-redonda" title="Permanent link">&para;</a></h2>
<p><a id="knights"></a></p>
<h3 id="tomado-de-spring-in-action">Tomado de <a id="bibliografia#spring">Spring in Action</a><a class="headerlink" href="#tomado-de-spring-in-action" title="Permanent link">&para;</a></h3>
<p>Añadir pruebas unitarias a la solución siguiente:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">KnightOfTheRoundTable</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">HolyGrailQuest</span> <span class="n">quest</span><span class="p">;</span>
  <span class="kd">public</span> <span class="nf">KnightOfTheRoundTable</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
    <span class="n">quest</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HolyGrailQuest</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="n">HolyGrail</span> <span class="nf">embarkOnQuest</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">GrailNotFoundException</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">quest</span><span class="p">.</span><span class="na">embark</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HolyGrailQuest</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="nf">HolyGrailQuest</span><span class="p">()</span> <span class="p">{}</span>
  <span class="kd">public</span> <span class="n">HolyGrail</span> <span class="nf">embark</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">GrailNotFoundException</span> <span class="p">{</span>
    <span class="n">HolyGrail</span> <span class="n">grail</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="c1">// Look for grail</span>
    <span class="p">...</span>
    <span class="k">return</span> <span class="n">grail</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="construir-pruebas-con-junit-3">Construir pruebas con jUnit 3<a class="headerlink" href="#construir-pruebas-con-junit-3" title="Permanent link">&para;</a></h3>
<p>¿Dónde está el acoplamiento?</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">junit.framework.TestCase</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">KnightOfTheRoundTableTest</span> <span class="kd">extends</span> <span class="n">TestCase</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testEmbarkOnQuest</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">GrailNotFoundException</span> <span class="p">{</span>
    <span class="n">KnightOfTheRoundTable</span> <span class="n">knight</span> <span class="o">=</span>
        <span class="k">new</span> <span class="n">KnightOfTheRoundTable</span><span class="p">(</span><span class="s">&quot;CruzadoMagico&quot;</span><span class="p">);</span>
    <span class="n">HolyGrail</span> <span class="n">grail</span> <span class="o">=</span> <span class="n">knight</span><span class="p">.</span><span class="na">embarkOnQuest</span><span class="p">();</span>
    <span class="n">assertNotNull</span><span class="p">(</span><span class="n">grail</span><span class="p">);</span>
    <span class="n">assertTrue</span><span class="p">(</span><span class="n">grail</span><span class="p">.</span><span class="na">isHoly</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li>
<p>Instanciación de <code>HolyGrail</code></p>
</li>
<li>
<p>Cada vez que se prueba <code>KnightOfTheRoundTable</code>, también se prueba <code>HolyGrailQuest</code>.</p>
</li>
<li>
<p>No se puede pedir a <code>HolyGrailQuest</code> que se comporte de otra forma (v.g. devolver null o elevar una excepción)</p>
</li>
</ul>
<h3 id="ocultar-la-implementacion-detras-de-una-interfaz">Ocultar la implementación detrás de una interfaz<a class="headerlink" href="#ocultar-la-implementacion-detras-de-una-interfaz" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Knight</span> <span class="p">{</span>
  <span class="n">Object</span> <span class="nf">embarkOnQuest</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">QuestFailedException</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">KnightOfTheRoundTable</span> <span class="kd">implements</span> <span class="n">Knight</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">Quest</span> <span class="n">quest</span><span class="p">;</span>
  <span class="kd">public</span> <span class="nf">KnightOfTheRoundTable</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
    <span class="n">quest</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HolyGrailQuest</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">embarkOnQuest</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">QuestFailedException</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">quest</span><span class="p">.</span><span class="na">embark</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Quest</span> <span class="p">{</span>
  <span class="kd">abstract</span> <span class="n">Object</span> <span class="nf">embark</span><span class="p">()</span>
    <span class="kd">throws</span> <span class="n">QuestFailedException</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HolyGrailQuest</span> <span class="kd">implements</span> <span class="n">Quest</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="nf">HolyGrailQuest</span><span class="p">()</span> <span class="p">{}</span>
  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">embark</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">QuestFailedException</span> <span class="p">{</span>
    <span class="c1">// Do whatever it means to embark on a quest</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">HolyGrail</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li>El <code>Knight</code> aún recibe un tipo específico de <code>Quest</code></li>
<li>¿Debe ser el caballero responsable de obtener un desafío?</li>
</ul>
<h3 id="inyectar-dependencias">Inyectar dependencias<a class="headerlink" href="#inyectar-dependencias" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">KnightOfTheRoundTable</span> <span class="kd">implements</span> <span class="n">Knight</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">Quest</span> <span class="n">quest</span><span class="p">;</span>
  <span class="kd">public</span> <span class="nf">KnightOfTheRoundTable</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">embarkOnQuest</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">QuestFailedException</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">quest</span><span class="p">.</span><span class="na">embark</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setQuest</span><span class="p">(</span><span class="n">Quest</span> <span class="n">quest</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">quest</span> <span class="o">=</span> <span class="n">quest</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li>El caballero no es el responsable de averiguar su misión.</li>
<li>El caballero sólo sabe de su misión a través de la interfaz <code>Quest</code>.</li>
<li>El caballero recibe la misión (se le inyecta) a través de <code>setQuest()</code></li>
<li>Puede asignársele cualquier implementación de <code>Quest</code>
    (<code>HolyGrailQuest</code>, <code>RescueDamselQuest</code>, etc.)</li>
</ul>
<h3 id="construccion-con-spring_1">Construcción con spring<a class="headerlink" href="#construccion-con-spring_1" title="Permanent link">&para;</a></h3>
<p>A través de un fichero de configuración XML le indicamos los valores inyectables:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE beans PUBLIC &quot;-//SPRING//DTD BEAN//EN&quot;</span>
<span class="cp">  &quot;http://www.springframework.org/dtd/spring-beans.dtd&quot;&gt;</span>
<span class="nt">&lt;beans&gt;</span>
  <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;quest&quot;</span>
    <span class="na">class=</span><span class="s">&quot;HolyGrailQuest&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;knight&quot;</span>
    <span class="na">class=</span><span class="s">&quot;KnightOfTheRoundTable&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg&gt;</span>
      <span class="nt">&lt;value&gt;</span>CruzadoMagico<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/constructor-arg&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;quest&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">&quot;quest&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
  <span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</code></pre></div>

<p>La inyección de la dependencia concreta la hace el contenedor (<em>spring</em> en este ejemplo):</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">org.springframework.beans.factory.BeanFactory</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.xml.XmlBeanFactory</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">KnightApp</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
    <span class="n">BeanFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XmlBeanFactory</span><span class="p">(</span><span class="k">new</span> <span class="n">FileInputStream</span><span class="p">(</span><span class="s">&quot;knight.xml&quot;</span><span class="p">));</span>
    <span class="n">KnightOfTheRoundTable</span> <span class="n">knight</span> <span class="o">=</span> <span class="p">(</span><span class="n">KnightOfTheRoundTable</span><span class="p">)</span> <span class="n">factory</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="s">&quot;knight&quot;</span><span class="p">);</span>
    <span class="n">knight</span><span class="p">.</span><span class="na">embarkOnQuest</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="ejemplo-logger">Ejemplo: Logger<a class="headerlink" href="#ejemplo-logger" title="Permanent link">&para;</a></h3>
<p>También se puede inyectar la dependencia en el constructor.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">java.util.logging.Logger</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyClass</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">Logger</span> <span class="n">logger</span><span class="p">;</span>
  <span class="kd">public</span> <span class="nf">MyClass</span><span class="p">(</span><span class="n">Logger</span> <span class="n">logger</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="na">logger</span> <span class="o">=</span> <span class="n">logger</span><span class="p">;</span>
      <span class="c1">// write an info log message</span>
      <span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;This is a log message.&quot;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Un <em>contenedor</em> de dependencias en el framework debe responsabilizarse de crear las instancias de <code>Logger</code> e inyectarlas en su sitio (normalmente vía <em>reflexión</em> o <em>introspección</em>)</p>
<h3 id="implementacion-final-de-la-orquesta-v08">Implementación final de la Orquesta v0.8<a class="headerlink" href="#implementacion-final-de-la-orquesta-v08" title="Permanent link">&para;</a></h3>
<p>Los <code>new</code> de <code>PruebaOrquesta</code> de la versión v0.7 siguen introduciendo dependencias de <code>PruebaOrquesta</code> con respecto a los tipos concretos de <code>Instrumento</code>.</p>
<p>A través de un fichero de configuración <code>orquesta.xml</code> de Spring le indicamos los valores inyectables:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE beans PUBLIC &quot;-//SPRING//DTD BEAN//EN&quot;</span>
<span class="cp">  &quot;http://www.springframework.org/dtd/spring-beans.dtd&quot;&gt;</span>
<span class="nt">&lt;beans&gt;</span>
  <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;trompeta&quot;</span>
    <span class="na">class=</span><span class="s">&quot;Viento&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;violin&quot;</span>
    <span class="na">class=</span><span class="s">&quot;Cuerda&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;tambor&quot;</span>
    <span class="na">class=</span><span class="s">&quot;Percusion&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;viola&quot;</span>
    <span class="na">class=</span><span class="s">&quot;Cuerda&quot;</span><span class="nt">/&gt;</span>

  <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;cuarteto&quot;</span>
    <span class="na">class=</span><span class="s">&quot;Orquesta&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;instrumento1&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">&quot;trompeta&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;instrumento2&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">&quot;violin&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;instrumento3&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">&quot;viola&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;instrumento4&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">&quot;tambor&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/property&gt;</span>    
  <span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</code></pre></div>

<p>La inyección de la dependencia concreta la hace el contenedor (<em>Spring</em> en este ejemplo):</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">org.springframework.beans.factory.BeanFactory</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.xml.XmlBeanFactory</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PruebaOrquesta</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
    <span class="n">BeanFactory</span> <span class="n">factory</span> <span class="o">=</span>
      <span class="k">new</span> <span class="n">XmlBeanFactory</span><span class="p">(</span><span class="k">new</span> <span class="n">FileInputStream</span><span class="p">(</span><span class="s">&quot;orquesta.xml&quot;</span><span class="p">));</span>
    <span class="n">Orquesta</span> <span class="n">orquesta</span> <span class="o">=</span>
      <span class="p">(</span><span class="n">Orquesta</span><span class="p">)</span> <span class="n">factory</span><span class="p">.</span><span class="na">getBean</span><span class="p">(</span><span class="s">&quot;cuarteto&quot;</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">Instrumento</span> <span class="n">i</span><span class="p">:</span> <span class="n">orquesta</span><span class="p">)</span>
           <span class="n">orquesta</span><span class="p">.</span><span class="na">afinar</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="n">orquesta</span><span class="p">.</span><span class="na">tocar</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="dependencias-en-java">Dependencias en Java<a class="headerlink" href="#dependencias-en-java" title="Permanent link">&para;</a></h3>
<p>JSR 330 es un estándar de Java para describir las dependencias de una clase con <code>@Inject</code> y otras anotaciones. Hay diversas implementaciones de <a href="http://javax-inject.github.io/javax-inject/">JSR 330</a>.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyPart</span> <span class="p">{</span>
<span class="hll">  <span class="nd">@Inject</span> <span class="kd">private</span> <span class="n">Logger</span> <span class="n">logger</span><span class="p">;</span>
</span>  <span class="c1">// inject class for database access</span>
<span class="hll">  <span class="nd">@Inject</span> <span class="kd">private</span> <span class="n">DatabaseAccessClass</span> <span class="n">dao</span><span class="p">;</span>
</span><span class="hll">  <span class="nd">@Inject</span>
</span>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">createControls</span><span class="p">(</span><span class="n">Composite</span> <span class="n">parent</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;UI will start to build&quot;</span><span class="p">);</span>
    <span class="n">Label</span> <span class="n">label</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Label</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">SWT</span><span class="p">.</span><span class="na">NONE</span><span class="p">);</span>
    <span class="n">label</span><span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="s">&quot;Eclipse 4&quot;</span><span class="p">);</span>
    <span class="n">Text</span> <span class="n">text</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Text</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">SWT</span><span class="p">.</span><span class="na">NONE</span><span class="p">);</span>
    <span class="n">text</span><span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="n">dao</span><span class="p">.</span><span class="na">getNumber</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Esta clase sigue usando <code>new</code> para ciertos elementos de la interfaz. Esto significa que no pensamos reemplazarlos ni siquiera para hacer pruebas.</p>
<h3 id="ejercicio-identificador-de-bankaccount-con-inyeccion-de-dependencias">Ejercicio: Identificador de BankAccount con inyección de dependencias<a class="headerlink" href="#ejercicio-identificador-de-bankaccount-con-inyeccion-de-dependencias" title="Permanent link">&para;</a></h3>
<p>Supongamos que queremos obtener un listado ordenado por fecha de creación de todas las cuentas bancarias.</p>
<p><span style="color:red;">¿Cómo afecta este cambio a la versión de <code>BankAccount</code> ya implementada con JDK 1.5? <br> Resolver mediante inyección de dependencias</span></p>
<p><code>BankAcccount.java</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">java.util.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.time.*</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">BankAccount</span> <span class="kd">implements</span> <span class="n">Comparable</span><span class="o">&lt;</span><span class="n">BankAccount</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">id</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">LocalDate</span> <span class="n">creationDate</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">Comparator</span> <span class="n">comparator</span><span class="p">;</span>

  <span class="kd">public</span> <span class="nf">BankAccount</span><span class="p">(</span><span class="n">String</span> <span class="n">number</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">number</span><span class="p">;</span>
    <span class="n">comparator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BankAccountComparatorById</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="n">LocalDate</span> <span class="nf">getCreationDate</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">creationDate</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCreationDate</span><span class="p">(</span><span class="n">LocalDate</span> <span class="n">date</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">creationDate</span> <span class="o">=</span> <span class="n">date</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getId</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">id</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setComparator</span><span class="p">(</span><span class="n">Comparator</span> <span class="n">cmp</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">comparator</span> <span class="o">=</span> <span class="n">cmp</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="p">(</span><span class="n">BankAccount</span> <span class="n">other</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">other</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">assert</span> <span class="k">this</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="p">:</span> <span class="s">&quot;compareTo inconsistent with equals.&quot;</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">comparator</span><span class="p">.</span><span class="na">compare</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">other</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="p">(</span><span class="n">Object</span> <span class="n">other</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">other</span><span class="p">)</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">other</span> <span class="k">instanceof</span> <span class="n">BankAccount</span><span class="p">))</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="n">BankAccount</span> <span class="n">that</span> <span class="o">=</span> <span class="p">(</span><span class="n">BankAccount</span><span class="p">)</span> <span class="n">other</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">that</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
  <span class="p">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">id</span><span class="p">.</span><span class="na">toString</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><code>BankAcccountComparatorById.java</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">java.util.*</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">BankAccountComparatorById</span> <span class="kd">implements</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">BankAccount</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="p">(</span><span class="n">BankAccount</span> <span class="n">o1</span><span class="p">,</span> <span class="n">BankAccount</span> <span class="n">o2</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">o1</span><span class="p">.</span><span class="na">getId</span><span class="p">().</span><span class="na">compareTo</span><span class="p">(</span><span class="n">o2</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><code>BankAcccountComparatorByCreationDate.java</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">java.util.*</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">BankAccountComparatorByCreationDate</span> <span class="kd">implements</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">BankAccount</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="p">(</span><span class="n">BankAccount</span> <span class="n">o1</span><span class="p">,</span> <span class="n">BankAccount</span> <span class="n">o2</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">o1</span><span class="p">.</span><span class="na">getCreationDate</span><span class="p">().</span><span class="na">compareTo</span><span class="p">(</span><span class="n">o2</span><span class="p">.</span><span class="na">getCreationDate</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Ahora podría definirse una anotación del tipo <code>@comparator(BankAccountComparatorById.className)</code> o <code>@compareById</code> que inyecte a <code>BankAccount</code> una dependencia <code>BankAccountComparatorById</code> en <code>BankAccount.comparator</code>.</p>
<h3 id="decoradores-en-typescript">Decoradores en TypeScript<a class="headerlink" href="#decoradores-en-typescript" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Los decoradores de TypeScript son una forma de modificar programáticamente la definición de una clase.</p>
</li>
<li>
<p>La definición de una clase describe la <strong>forma</strong> de la clase, es decir, sus métodos y propiedades. Sólo cuando se instancie la clase, estas propiedades y métodos estarán disponibles.</p>
</li>
<li>
<p>Los decoradores permiten <strong>inyectar</strong> código en la definición real de una clase.</p>
</li>
</ul>
<p>Pueden emplearse sobre:</p>
<ul>
<li>definiciones de clase</li>
<li>definiciones de propiedades</li>
<li>definiciones de funciones</li>
<li>parámetros de métodos</li>
</ul>
<p>Los decoradores de TypeScript se llaman <strong>atributos</strong> en C# y <strong>anotaciones</strong> en Java</p>
<p>Los decoradores de TypeScript son una característica <strong>experimental</strong> del compilador y se han propuesto como parte del estándar <strong>ECMAScript 7</strong>. Deben activarse modificando el parámetro <code>experimentalDecorators</code> en <code>tsconfig.json</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
  <span class="nt">&quot;compilerOptions&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;module&quot;</span><span class="p">:</span> <span class="s2">&quot;commonjs&quot;</span><span class="p">,</span>
    <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;es3&quot;</span><span class="p">,</span>
    <span class="nt">&quot;sourceMap&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nt">&quot;experimentalDecorators&quot;</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">},</span>
  <span class="nt">&quot;exclude&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;node_modules&quot;</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="declaracion">Declaración<a class="headerlink" href="#declaracion" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kd">function</span> <span class="nx">simpleDecorator</span><span class="p">(</span><span class="kr">constructor</span><span class="o">:</span> <span class="nb">Function</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;simpleDecorator called.&#39;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="uso">Uso<a class="headerlink" href="#uso" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kd">@simpleDecorator</span>
<span class="kr">class</span> <span class="nx">ClassWithSimpleDecorator</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre></div>

<details class="question"><summary>¿Cuál es la salida del siguiente código TypeScript?</summary><div class="codehilite"><pre><span></span><code>simpleDecorator called.
instance_1 : [object Object]
instance_2 : [object Object]
</code></pre></div>

</details>
<div class="codehilite"><pre><span></span><code><span class="kd">let</span> <span class="nx">instance_1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ClassWithSimpleDecorator</span><span class="p">();</span>
<span class="kd">let</span> <span class="nx">instance_2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ClassWithSimpleDecorator</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`instance_1: </span><span class="si">${</span><span class="nx">instance_1</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`instance_2 : </span><span class="si">${</span><span class="nx">instance_2</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</code></pre></div>

<h4 id="decoradores-mutiples">Decoradores mútiples<a class="headerlink" href="#decoradores-mutiples" title="Permanent link">&para;</a></h4>
<details class="question"><summary>¿Cuál es la salida del siguiente código TypeScript?</summary><div class="codehilite"><pre><span></span><code>secondDecorator called.
simpleDecorator called.
instance_1 : [object Object]
</code></pre></div>

</details>
<div class="codehilite"><pre><span></span><code><span class="kd">function</span> <span class="nx">simpleDecorator</span><span class="p">(</span><span class="kr">constructor</span><span class="o">:</span> <span class="nb">Function</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;simpleDecorator called.&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">secondDecorator</span><span class="p">(</span><span class="kr">constructor</span><span class="o">:</span> <span class="nb">Function</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;secondDecorator called.&#39;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">@simpleDecorator</span>
<span class="kd">@secondDecorator</span>
<span class="kr">class</span> <span class="nx">ClassWithMultipleDecorators</span> <span class="p">{</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">instance_1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ClassWithMultipleDecorators</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`instance_1: </span><span class="si">${</span><span class="nx">instance_1</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</code></pre></div>

<h4 id="factorias-de-decoradores">Factorías de decoradores<a class="headerlink" href="#factorias-de-decoradores" title="Permanent link">&para;</a></h4>
<ul>
<li>Los decoradores pueden aceptar parámetros</li>
<li>Una factoría de decoradores es una función que devuelve el propio decorador.</li>
</ul>
<h5 id="ejemplo-de-factoria-de-decoradores">Ejemplo de factoría de decoradores<a class="headerlink" href="#ejemplo-de-factoria-de-decoradores" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="kd">function</span> <span class="nx">decoratorFactory</span><span class="p">(</span><span class="nx">name</span>: <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="kr">constructor</span><span class="o">:</span> <span class="nb">Function</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`decorator function called with: </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">@decoratorFactory</span><span class="p">(</span><span class="s1">&#39;testName&#39;</span><span class="p">)</span>
<span class="kr">class</span> <span class="nx">ClassWithDecoratorFactory</span> <span class="p">{</span>
<span class="p">}</span>
</code></pre></div>

<p>Salida:</p>
<div class="codehilite"><pre><span></span><code>decorator function called with: testName
</code></pre></div>

<h4 id="tipos-de-decoradores">Tipos de decoradores<a class="headerlink" href="#tipos-de-decoradores" title="Permanent link">&para;</a></h4>
<ul>
<li>Decoradores de clases</li>
<li>Decoradores de propiedades</li>
<li>Decoradores de propiedades estáticas</li>
<li>Decoradores de métodos</li>
<li>Decoradores de parámetros</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Lectura recomendada</p>
<p>Nathan Rozentals: <a href="https://www.packtpub.com/mapt/book/application_development/9781786468710">Mastering TypeScript</a>, Packt Publishing, 2<sup>nd</sup> edition, 2017</p>
</div>
<h1 id="caso-4-codigo-duplicado">Caso 4 - Código duplicado<a class="headerlink" href="#caso-4-codigo-duplicado" title="Permanent link">&para;</a></h1>
<h2 id="calculo-de-nominas">Cálculo de nóminas<a class="headerlink" href="#calculo-de-nominas" title="Permanent link">&para;</a></h2>
<p><a id="nominas"></a></p>
<h3 id="implementacion-de-nominas-v01">Implementación de nóminas v0.1<a class="headerlink" href="#implementacion-de-nominas-v01" title="Permanent link">&para;</a></h3>
<details class="question"><summary>En la siguiente implementación, ¿dónde hay código duplicado?</summary><ul>
<li>Código duplicado en los constructores de las clases y subclases</li>
<li>Refactorizar delegando hacia la superclase</li>
</ul>
</details>
<div class="codehilite"><pre><span></span><code>  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Empleado</span> <span class="p">{</span>
    <span class="n">Comparable</span> <span class="n">id</span><span class="p">;</span>
    <span class="n">String</span> <span class="n">name</span><span class="p">;</span>
    <span class="kd">public</span> <span class="nf">Empleado</span><span class="p">(</span><span class="n">String</span> <span class="n">id</span><span class="p">,</span> <span class="n">String</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">id</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">name</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Autonomo</span> <span class="kd">extends</span> <span class="n">Empleado</span> <span class="p">{</span>
    <span class="n">String</span> <span class="n">vatCode</span><span class="p">;</span>
    <span class="kd">public</span> <span class="nf">Autonomo</span><span class="p">(</span><span class="n">String</span> <span class="n">id</span><span class="p">,</span> <span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">String</span> <span class="n">vat</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">vatCode</span> <span class="o">=</span> <span class="n">vat</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">id</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">vatCode</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Prueba</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Empleado</span> <span class="n">e</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Empleado</span><span class="p">(</span><span class="s">&quot;0001&quot;</span><span class="p">,</span><span class="s">&quot;Enrique&quot;</span><span class="p">);</span>
      <span class="n">Empleado</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Autonomo</span><span class="p">(</span><span class="s">&quot;0002&quot;</span><span class="p">,</span><span class="s">&quot;Ana&quot;</span><span class="p">,</span><span class="s">&quot;12345-A&quot;</span><span class="p">);</span>
      <span class="n">e</span><span class="p">.</span><span class="na">print</span><span class="p">();</span>  
      <span class="n">a</span><span class="p">.</span><span class="na">print</span><span class="p">();</span>  
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>

<h3 id="nominas-v02">Nóminas v0.2<a class="headerlink" href="#nominas-v02" title="Permanent link">&para;</a></h3>
<ul>
<li>Requisito: los trabajadores autónomos cobran por horas (no tienen un salario fijo bruto)</li>
<li>Incluimos el método <code>computeMonthlySalary</code> para el cálculo de la nómina mensual</li>
</ul>
<details class="question"><summary>¿Están descohesionadas las clases?</summary><ul>
<li>¿Todos los empleados deben tener un salario anual <code>yearlyGrossSalary</code> bruto? Los autónomos no...</li>
<li>El método de cálculo del salario está descohesionado</li>
</ul>
</details>
<div class="codehilite"><pre><span></span><code>  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Empleado</span> <span class="p">{</span>
    <span class="n">Comparable</span> <span class="n">id</span><span class="p">;</span>
    <span class="n">String</span> <span class="n">name</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">yearlyGrossSalary</span><span class="p">;</span>
    <span class="kd">public</span> <span class="nf">Empleado</span><span class="p">(</span><span class="n">String</span> <span class="n">id</span><span class="p">,</span> <span class="n">String</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="nf">setSalary</span><span class="p">(</span> <span class="kt">float</span> <span class="n">s</span> <span class="p">)</span> <span class="p">{</span> <span class="n">yearlyGrossSalary</span><span class="o">=</span><span class="n">s</span><span class="p">;</span> <span class="p">}</span>   
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="n">id</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">name</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">float</span> <span class="nf">computeMonthlySalary</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">yearlyGrossSalary</span><span class="o">/</span><span class="mi">12</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Autonomo</span> <span class="kd">extends</span> <span class="n">Empleado</span> <span class="p">{</span>
    <span class="n">String</span> <span class="n">vatCode</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">workingHours</span><span class="p">;</span>
    <span class="kd">public</span> <span class="nf">Autonomo</span><span class="p">(</span><span class="n">String</span> <span class="n">id</span><span class="p">,</span> <span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">String</span> <span class="n">vat</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">super</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">name</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="na">vatCode</span> <span class="o">=</span> <span class="n">vat</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">workingHours</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">float</span> <span class="nf">computeMonthlySalary</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">workingHours</span><span class="o">*</span><span class="n">Company</span><span class="p">.</span><span class="na">getHourlyRate</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">Company</span><span class="p">.</span><span class="na">getVatRate</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">super</span><span class="p">.</span><span class="na">print</span><span class="p">();</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">vatCode</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Prueba</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Empleado</span> <span class="n">e</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Empleado</span><span class="p">(</span><span class="s">&quot;0001&quot;</span><span class="p">,</span> <span class="s">&quot;Enrique&quot;</span><span class="p">);</span>
      <span class="n">Empleado</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Autonomo</span><span class="p">(</span><span class="s">&quot;0001&quot;</span><span class="p">,</span> <span class="s">&quot;Ana&quot;</span><span class="p">,</span> <span class="s">&quot;12345-A&quot;</span><span class="p">);</span>
      <span class="n">e</span><span class="p">.</span><span class="na">print</span><span class="p">();</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
      <span class="n">a</span><span class="p">.</span><span class="na">print</span><span class="p">();</span>  <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>

<h3 id="nominas-v03">Nóminas v0.3<a class="headerlink" href="#nominas-v03" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>  <span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Empleado</span> <span class="p">{</span>
    <span class="cm">/* ... */</span>
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">float</span> <span class="nf">computeMonthlySalary</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Plantilla</span> <span class="kd">extends</span> <span class="n">Empleado</span> <span class="p">{</span>
    <span class="kt">float</span> <span class="n">yearlyGrossSalary</span><span class="p">;</span>
    <span class="cm">/* ... */</span>
    <span class="kt">float</span> <span class="nf">setSalary</span><span class="p">(</span> <span class="kt">float</span> <span class="n">s</span> <span class="p">)</span> <span class="p">{</span> <span class="n">yearlyGrossSalary</span><span class="o">=</span><span class="n">s</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">float</span> <span class="nf">computeMonthlySalary</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">yearlyGrossSalary</span><span class="o">/</span><span class="mi">12</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Autonomo</span> <span class="kd">extends</span> <span class="n">Empleado</span> <span class="p">{</span>
    <span class="n">String</span> <span class="n">vatCode</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">workingHours</span><span class="p">;</span>
    <span class="kd">public</span> <span class="nf">Autonomo</span><span class="p">(</span><span class="n">String</span> <span class="n">id</span><span class="p">,</span> <span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">String</span> <span class="n">vat</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">super</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">name</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="na">vatCode</span> <span class="o">=</span> <span class="n">vat</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">workingHours</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addWorkingHours</span><span class="p">(</span><span class="kt">float</span> <span class="n">workingHours</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="na">workingHours</span> <span class="o">+=</span> <span class="n">workingHours</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">float</span> <span class="nf">computeMonthlySalary</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">workingHours</span><span class="o">*</span><span class="n">Company</span><span class="p">.</span><span class="na">getHourlyRate</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">Company</span><span class="p">.</span><span class="na">getVatRate</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">super</span><span class="p">.</span><span class="na">print</span><span class="p">();</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">vatCode</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Prueba</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Empleado</span> <span class="n">e</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Plantilla</span><span class="p">(</span><span class="s">&quot;0001&quot;</span><span class="p">,</span> <span class="s">&quot;Pepe&quot;</span><span class="p">);</span>
      <span class="n">e</span><span class="p">.</span><span class="na">setSalary</span><span class="p">(</span><span class="mf">25000.0</span><span class="p">);</span>
      <span class="n">Empleado</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Autonomo</span><span class="p">(</span><span class="s">&quot;0001&quot;</span><span class="p">,</span> <span class="s">&quot;Ana&quot;</span><span class="p">,</span> <span class="s">&quot;12345-A&quot;</span><span class="p">);</span>
      <span class="n">a</span><span class="p">.</span><span class="na">addWorkingHours</span><span class="p">(</span><span class="mf">30.0</span><span class="p">);</span>
      <span class="n">e</span><span class="p">.</span><span class="na">print</span><span class="p">();</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot; Salario: &quot;</span><span class="o">+</span><span class="n">e</span><span class="p">.</span><span class="na">computeMonthlySalary</span><span class="p">()</span><span class="o">+</span><span class="s">&quot; EUR&quot;</span><span class="p">);</span>
      <span class="n">a</span><span class="p">.</span><span class="na">print</span><span class="p">();</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot; Salario: &quot;</span><span class="o">+</span><span class="n">a</span><span class="p">.</span><span class="na">computeMonthlySalary</span><span class="p">()</span><span class="o">+</span><span class="s">&quot; EUR&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>

<p><a id="refactoring"></a></p>
<h2 id="refactoring"><span style="color:blue;">Refactoring</span><a class="headerlink" href="#refactoring" title="Permanent link">&para;</a></h2>
<p>Hacer <em>refactoring</em> es hacer pequeñas transformaciones en el código que mantienen el sistema funcional, sin añadir nuevas funcionalidades.</p>
<blockquote>
<p>Refactoring is a disciplined technique for restructuring an existing body of code, altering its internal structure without changing its external behavior</p>
<p>— <cite><a href="http://www.refactoring.com/">M. Fowler</a>, <a href="http://www.refactoring.com">www.refactoring.com</a></cite></p>
<p>A change made to the internal structure of the software to make it easier to understand and cheaper to modify without changing its observable behavior</p>
<p>– <cite><a href="../bibliografia/#refactoring">M. Fowler (2008): Refactoring...</a></cite></p>
</blockquote>
<div class="admonition info">
<p class="admonition-title">Lectura recomendada</p>
<p>Hunt &amp; Thomas. <a href="../bibliografia/#pragmatic">The Pragmatic Programmer</a>, 1999.
Capítulo: <em>Refactoring</em></p>
</div>
<h3 id="motivos-para-refactoring">Motivos para refactoring<a class="headerlink" href="#motivos-para-refactoring" title="Permanent link">&para;</a></h3>
<ul>
<li>Código duplicado</li>
<li>Rutinas demasiado largas</li>
<li>Bucles demasiado largos o demasiado anidados</li>
<li>Clases poco cohesionadas</li>
<li>Interfaz de una clase con un nivel de abstracción poco consistente</li>
<li>Demasiados parámetros en una lista de parámetros</li>
<li>Muchos cambios en una clase tienden a estar compartimentalizados (afectan solo a una parte)</li>
<li>Muchos cambios requieren modificaciones en paralelo a varias clases</li>
<li>Hay que cambiar jerarquías de herencia en paralelo</li>
<li>Hay que cambiar muchas sentencias <em>case</em> en paralelo</li>
<li>Etc.</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Lectura recomendada</p>
<p>McConnell. <a href="../bibliografia/#codecomplete">Code Complete</a>, 2004.</p>
</div>
<details class="question"><summary>¿Cuál es la primera razón para hacer refactoring?</summary><ul>
<li><strong>Código duplicado</strong></li>
</ul>
</details>
<p><a id="duplcode"></a></p>
<h2 id="codigo-duplicado"><span style="color:blue;">Código duplicado</span><a class="headerlink" href="#codigo-duplicado" title="Permanent link">&para;</a></h2>
<div class="admonition info">
<p class="admonition-title">Lectura recomendada</p>
<p>Hunt &amp; Thomas. <a href="../bibliografia/#pragmatic">The Pragmatic Programmer</a>, 1999.
Capítulo <em>DRY—The Evils of Duplication</em></p>
</div>
<h3 id="por-que-no-duplicar">¿Por qué no duplicar?<a class="headerlink" href="#por-que-no-duplicar" title="Permanent link">&para;</a></h3>
<ul>
<li>Mantenimiento</li>
<li>Cambios (no sólo a nivel de código)</li>
<li>Trazabilidad</li>
</ul>
<h3 id="causas-de-la-duplicacion">Causas de la duplicación<a class="headerlink" href="#causas-de-la-duplicacion" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Impuesta</strong>: No hay elección</li>
<li><strong>Inadvertida</strong>: No me he dado cuenta</li>
<li><strong>Impaciencia</strong>: No puedo esperar</li>
<li><strong>Simultaneidad</strong>: Ha sido otro</li>
</ul>
<h3 id="principio-dry-dont-repeat-yourself"><span style="color:blue;">Principio DRY – <em>Don't Repeat Yourself!</em></span><a class="headerlink" href="#principio-dry-dont-repeat-yourself" title="Permanent link">&para;</a></h3>
<p>by <a href="../bibliografia/#pragmatic">Hunt &amp; Thomas (1999)</a></p>
<blockquote>
<p>Copy and paste is a design error</p>
<p>– <cite> McConnell (1998) </cite></p>
</blockquote>
<h3 id="duplicacion-impuesta">Duplicación impuesta<a class="headerlink" href="#duplicacion-impuesta" title="Permanent link">&para;</a></h3>
<p>La gestión del proyecto así nos lo exige. Algunos ejemplos:</p>
<ul>
<li>Representaciones múltiples de la información:<ul>
<li>varias implementaciones de un TAD que necesita guardar elementos de distintos tipos, cuando el lenguaje no permite genericidad</li>
<li>el esquema de una BD configurado en la BD y en el código fuente a través de un <a href="http://www.agiledata.org/essays/mappingObjects.html">ORM</a></li>
</ul>
</li>
<li>Documentación del código:<ul>
<li>código incrustado en javadocs</li>
</ul>
</li>
<li>Casos de prueba:<ul>
<li>pruebas unitarias con jUnit</li>
</ul>
</li>
<li>Características del lenguaje:<ul>
<li>C/C++ header files</li>
<li>IDL specs</li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Cómo evitaba Java la duplicación en sus <em>containers</em></p>
<p>Cuando el lenguaje no tenía capacidad de usar tipos genéricos (hasta el JDK 1.4), podría aparecer la necesidad de duplicar código a la hora de implementar un TAD contenedor, pues habría que repetir todo el código de manejo del TAD para cada tipo de elemento contenido. Para evitarlo, Java usó un <em>workaround</em>: todas las clases en Java heredan de <code>Object</code>. Así una clase que implementara un TAD contenedor de elementos de otra clase, tan solo tenía que declarar los elementos contenidos de tipo <code>Object</code>. Más tarde (a partir del JDK 1.5) introdujo los tipos genéricos y ya no era necesario usar dicho <em>workaround</em> basado en <code>Object</code> para evitar la duplicación</p>
</div>
<h4 id="tecnicas-de-solucion">Técnicas de solución<a class="headerlink" href="#tecnicas-de-solucion" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Generadores de código</strong>: para evitar duplicar representaciones múltiples de la información</li>
<li>Herramientas de <strong>ingeniería inversa</strong>: para generar código a partir de un esquema de BD – v.g. <a href="https://jeddict.github.io/">jeddict</a> para crear clases JPA, visualizar y modificar BDs y automatizar la generación de código Java EE.</li>
<li><strong>Plantillas</strong>: Tipos genéricos del lenguaje (Java, C++, TypeScript, etc.) o mediante un motor de plantillas – v.g. <a href="http://velocity.apache.org/">Apache Velocity</a> template language (<a href="http://velocity.apache.org/engine/2.0/user-guide.html#velocity-template-language-vtl-an-introduction">VTL</a>)</li>
<li><strong>Metadatos</strong>: Anotaciones @ en Java, decoradores en TypeScript, etc.</li>
<li>Herramientas de <strong>documentación</strong> (v.g. <a href="http://asciidoctor.org/">asciidoctor</a>: <a href="http://asciidoctor.org/docs/asciidoc-syntax-quick-reference/#include-files">inclusión de ficheros</a> y <a href="http://asciidoctor.org/docs/asciidoc-syntax-quick-reference/#source-code">formateo de código fuente</a>).</li>
<li>Herramientas de <strong><a href="http://www.literateprogramming.com/">programación literaria</a></strong></li>
<li>Ayuda del <strong>IDE</strong></li>
</ul>
<h3 id="duplicacion-inadvertida">Duplicación inadvertida<a class="headerlink" href="#duplicacion-inadvertida" title="Permanent link">&para;</a></h3>
<p>Normalmente tiene origen en un diseño inapropiado.</p>
<p>Fuente de numerosos problemas de integración.</p>
<h4 id="ejemplo-codigo-duplicado-version-1">Ejemplo: código duplicado – versión 1<a class="headerlink" href="#ejemplo-codigo-duplicado-version-1" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code>  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Line</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="n">Point</span> <span class="n">start</span><span class="p">;</span>
    <span class="kd">public</span> <span class="n">Point</span> <span class="n">end</span><span class="p">;</span>
    <span class="kd">public</span> <span class="kt">double</span> <span class="n">length</span><span class="p">;</span>
  <span class="p">}</span>
</code></pre></div>

<p><span style="color:red;">¿Dónde está la duplicación?</span></p>
<p>Realmente <code>length</code> ya está definido con <code>start</code>y <code>end</code>. <span style="color:red;">¿Mejor así...?</span></p>
<div class="codehilite"><pre><span></span><code>  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Line</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="n">Point</span> <span class="n">start</span><span class="p">;</span>
    <span class="kd">public</span> <span class="n">Point</span> <span class="n">end</span><span class="p">;</span>
    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">length</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">return</span> <span class="n">start</span><span class="p">.</span><span class="na">distanceTo</span><span class="p">(</span><span class="n">end</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>

<p><span style="color:red;">¿Es conveniente aplicar siempre DRY?</span></p>
<p>A veces se puede optar por violar DRY por razones de rendimiento.</p>
<h4 id="ejemplo-aplicando-memoization-version-2">Ejemplo: aplicando memoization – versión 2<a class="headerlink" href="#ejemplo-aplicando-memoization-version-2" title="Permanent link">&para;</a></h4>
<p><a href="https://en.wikipedia.org/wiki/Memoization"><em>Memoization</em></a>: cachear los resultados de cómputos costosos</p>
<div class="codehilite"><pre><span></span><code>  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Line</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">changed</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kt">double</span> <span class="n">length</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">Point</span> <span class="n">start</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">Point</span> <span class="n">end</span><span class="p">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setStart</span><span class="p">(</span><span class="n">Point</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span> <span class="n">start</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span> <span class="n">changed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEnd</span><span class="p">(</span><span class="n">Point</span> <span class="n">p</span><span class="p">)</span>   <span class="p">{</span> <span class="n">end</span>   <span class="o">=</span> <span class="n">p</span><span class="p">;</span> <span class="n">changed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">public</span> <span class="n">Point</span> <span class="nf">getStart</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">start</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">public</span> <span class="n">Point</span> <span class="nf">getEnd</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">end</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">getLength</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">if</span> <span class="p">(</span><span class="n">changed</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">length</span> <span class="o">=</span> <span class="n">start</span><span class="p">.</span><span class="na">distanceTo</span><span class="p">(</span><span class="n">end</span><span class="p">);</span>
          <span class="n">changed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
       <span class="p">}</span>
       <span class="k">return</span> <span class="n">length</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>

<p>La técnica de memoization es menos problemática si queda dentro de los límites de la clase/módulo.</p>
<p>Otras veces no merece la pena violar DRY por rendimiento: ¡las cachés y los optimizadores de código también hacen su labor!</p>
<h3 id="principio-de-acceso-uniforme"><span style="color:blue;">Principio de acceso uniforme</span><a class="headerlink" href="#principio-de-acceso-uniforme" title="Permanent link">&para;</a></h3>
<blockquote>
<p>All services offered by a module should be available through a uniform notation, which does not betray whether they are implemented through storage or through computation</p>
<p><cite><a href="../bibliografia/#meyer">B. Meyer</a></cite></p>
</blockquote>
<p>Conviene aplicar el principio de acceso uniforme para que sea más fácil añadir mejoras de rendimiento (v.g. caching)</p>
<h4 id="ejemplo-acceso-uniforme-en-c-version-3">Ejemplo: acceso uniforme en C# – versión 3<a class="headerlink" href="#ejemplo-acceso-uniforme-en-c-version-3" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Line</span> <span class="p">{</span>
  <span class="k">private</span> <span class="n">Point</span> <span class="n">Start</span><span class="p">;</span>
  <span class="k">private</span> <span class="n">Point</span> <span class="n">End</span><span class="p">;</span>
  <span class="k">private</span> <span class="kt">double</span> <span class="n">Length</span><span class="p">;</span>

  <span class="k">public</span> <span class="n">Point</span> <span class="n">Start</span> <span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Start</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">set</span> <span class="p">{</span> <span class="n">Start</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="n">Point</span> <span class="n">End</span> <span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">End</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">set</span> <span class="p">{</span> <span class="n">Start</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="kt">double</span> <span class="n">Length</span> <span class="p">{</span>
    <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Start</span><span class="p">.</span><span class="n">distanceTo</span><span class="p">(</span><span class="n">End</span><span class="p">);</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="duplicacion-por-impaciencia">Duplicación por impaciencia<a class="headerlink" href="#duplicacion-por-impaciencia" title="Permanent link">&para;</a></h3>
<ul>
<li>Los peligros del <em>copy&amp;paste</em></li>
<li>"Vísteme despacio que tengo prisa" (<em>shortcuts make for long delays</em>). Ejemplos:<ul>
<li>Meter el <code>main</code> de Java en cualquier clase</li>
<li>Fiasco del año 2000</li>
</ul>
</li>
</ul>
<h3 id="duplicacion-por-simultaneidad">Duplicación por simultaneidad<a class="headerlink" href="#duplicacion-por-simultaneidad" title="Permanent link">&para;</a></h3>
<ul>
<li>No resoluble a nivel de técnicas de construcción</li>
<li>Hace falta metodología, gestión de equipos + herramientas de comunicación</li>
</ul>
<p><a id="ortogonalidad"></a></p>
<h2 id="ortogonalidad"><span style="color:blue;">Ortogonalidad</span><a class="headerlink" href="#ortogonalidad" title="Permanent link">&para;</a></h2>
<p>Dos componentes A y B son ortogonales (<span><span class="MathJax_Preview">A \perp B</span><script type="math/tex">A \perp B</script></span>) si los cambios en uno no afectan al otro. Suponen más independencia y menos acoplamiento. Por ejemplo:</p>
<ul>
<li>La base de datos debe ser ortogonal a la interfaz de usuario</li>
<li>En un helicóptero, los mandos de control no suelen ser ortogonales</li>
</ul>
<h3 id="beneficios-de-la-ortogonalidad">Beneficios de la ortogonalidad<a class="headerlink" href="#beneficios-de-la-ortogonalidad" title="Permanent link">&para;</a></h3>
<h4 id="mayor-productividad">Mayor productividad<a class="headerlink" href="#mayor-productividad" title="Permanent link">&para;</a></h4>
<ul>
<li>Es más fácil escribir un componente pequeño y auto-contenido que un bloque muy grande de código. El tiempo de desarrollo y <strong>pruebas</strong> se reduce</li>
<li>Se pueden combinar unos componentes con otros más fácilmente. Mayor <strong>reutilización</strong>.</li>
<li>Si <span><span class="MathJax_Preview">A \perp B</span><script type="math/tex">A \perp B</script></span>, el componente A sirve para <span><span class="MathJax_Preview">m</span><script type="math/tex">m</script></span> propósitos y B sirve para <span><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span>, entonces <span><span class="MathJax_Preview">A \cup B</span><script type="math/tex">A \cup B</script></span> sirve para <span><span class="MathJax_Preview">m \times n</span><script type="math/tex">m \times n</script></span> propósitos.</li>
<li>La falta de cohesión perjudica la reutilización – v.g. ¿y si hay que hacer una nueva versión gráfica de una aplicación de línea de comandos? (los <code>System.out.println</code> pueden descohesionar)</li>
</ul>
<h4 id="menor-riesgo">Menor riesgo<a class="headerlink" href="#menor-riesgo" title="Permanent link">&para;</a></h4>
<ul>
<li>Defectos aislados, más fáciles de arreglar</li>
<li>Menor <strong>fragilidad</strong> del sistema global, los problemas provocados por cambios en un área se limitan a ese área</li>
<li>Más fácil de <strong>probar</strong>, pues será más fácil construir pruebas individuales de cada uno de sus componentes (e.g. <em>mocking</em> es más sencillo)</li>
</ul>
<h3 id="niveles-de-aplicacion-de-la-ortogonalizad">Niveles de aplicación de la ortogonalizad<a class="headerlink" href="#niveles-de-aplicacion-de-la-ortogonalizad" title="Permanent link">&para;</a></h3>
<p>La ortogonalidad es aplicable a:</p>
<ul>
<li>la gestión de proyectos</li>
<li>el diseño</li>
<li>la codificación</li>
<li>las pruebas</li>
<li>la documentación</li>
</ul>
<p>A nivel de <em>diseño</em>, los patrones de diseño y las arquitecturas como MVC facilitan la construcción de componentes ortogonales.</p>
<h3 id="tecnicas-de-codificacion">Técnicas de codificación<a class="headerlink" href="#tecnicas-de-codificacion" title="Permanent link">&para;</a></h3>
<p>Técnicas de codificación para fomentar la ortogonalidad:</p>
<ul>
<li>Hacer <strong>refactoring</strong></li>
<li>Codificar <strong>patrones</strong> de diseño: strategy, template method, etc.</li>
<li>Evitar datos globales y <strong>singletons</strong>: ¿qué pasaría si hubiera que hacer una versión <em>multithreaded</em> de una aplicación?</li>
<li><strong>Inyectar</strong>: pasar explícitamente el contexto (dependencia) como parámetro a los constructores</li>
<li>Usar <strong>anotaciones</strong> (Java), decoradores (JavaScript) o atributos (C#)</li>
<li><strong>Desacoplar</strong>: Ley de <span><em>Demeter</em></span>—No hables con extraños</li>
<li>Usar programación orientada a <strong>aspectos</strong></li>
</ul>
<h4 id="desacoplar-ley-de-demeter">Desacoplar - ley de Demeter<a class="headerlink" href="#desacoplar-ley-de-demeter" title="Permanent link">&para;</a></h4>
<p>Al pedir un servicio a un objeto, el servicio debe ser realizado de parte nuestra, no que nos devuelva un tercero con el que tratar para realizarlo</p>
<p><strong>Ejemplo</strong>:</p>
<div class="codehilite"><pre><span></span><code>  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">canWrite</span><span class="p">(</span><span class="n">User</span> <span class="n">user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">isAnonymous</span><span class="p">())</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">user</span><span class="p">.</span><span class="na">getGroup</span><span class="p">().</span><span class="na">hasPermission</span><span class="p">(</span><span class="n">Permission</span><span class="p">.</span><span class="na">WRITE</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div>

<p>Refactorización: definir un método <code>User.hasPermission()</code></p>
<h4 id="inyectar-el-contexto">Inyectar el contexto<a class="headerlink" href="#inyectar-el-contexto" title="Permanent link">&para;</a></h4>
<p>Pasar explícitamente el contexto (dependencia) como parámetro a los constructores de la clase</p>
<h5 id="ejemplo-patron-estrategia">Ejemplo: patrón estrategia<a class="headerlink" href="#ejemplo-patron-estrategia" title="Permanent link">&para;</a></h5>
<p>En el patrón de diseño <em>strategy</em>, pasar el contexto a la estrategia en su creación</p>
<h5 id="ejemplo-caballeros-de-la-mesa-redonda">Ejemplo: caballeros de la mesa redonda<a class="headerlink" href="#ejemplo-caballeros-de-la-mesa-redonda" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Knight</span> <span class="p">{</span>
  <span class="n">Object</span> <span class="nf">embarkOnQuest</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">QuestFailedException</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">KnightOfTheRoundTable</span> <span class="kd">implements</span> <span class="n">Knight</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">Quest</span> <span class="n">quest</span><span class="p">;</span>
  <span class="kd">public</span> <span class="nf">KnightOfTheRoundTable</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">Quest</span> <span class="n">quest</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">quest</span> <span class="o">=</span> <span class="n">quest</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">embarkOnQuest</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">QuestFailedException</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">quest</span><span class="p">.</span><span class="na">embark</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setQuest</span><span class="p">(</span><span class="n">Quest</span> <span class="n">quest</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">quest</span> <span class="o">=</span> <span class="n">quest</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Quest</span> <span class="p">{</span>
  <span class="kd">abstract</span> <span class="n">Object</span> <span class="nf">embark</span><span class="p">()</span>
    <span class="kd">throws</span> <span class="n">QuestFailedException</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="ley-de-demeter-para-funciones">Ley de Demeter para funciones<a class="headerlink" href="#ley-de-demeter-para-funciones" title="Permanent link">&para;</a></h4>
<p>Los métodos de un objeto solo deben hacer llamadas a métodos...</p>
<p>caso 1. <strong>propios</strong> 
caso 2. de objetos pasados como <strong>parámetros</strong>
caso 3. de objetos <strong>creados</strong> por ellos mismos
caso 4. de objetos <strong>declarados</strong> en el mismo método</p>
<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">Demeter</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="n">A</span> <span class="n">a</span><span class="p">;</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="nf">func</span><span class="p">();</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">example</span> <span class="p">(</span><span class="n">B</span> <span class="n">b</span><span class="p">);</span>

  <span class="kt">void</span> <span class="nf">example</span><span class="p">(</span><span class="n">B</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">C</span> <span class="n">c</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">f</span> <span class="o">=</span> <span class="n">func</span><span class="p">();</span>  <span class="c1">// (caso 1)</span>
    <span class="n">b</span><span class="p">.</span><span class="na">invert</span><span class="p">();</span>      <span class="c1">// (caso 2)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">A</span><span class="p">();</span>
    <span class="n">a</span><span class="p">.</span><span class="na">setActive</span><span class="p">();</span>   <span class="c1">// (caso 3)</span>
    <span class="n">c</span><span class="p">.</span><span class="na">print</span><span class="p">();</span>       <span class="c1">// (caso 4)</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="criticas-a-la-ley-de-demeter">Críticas a la ley de Demeter<a class="headerlink" href="#criticas-a-la-ley-de-demeter" title="Permanent link">&para;</a></h4>
<p>La ley de Demeter, ¿realmente ayuda a crear código más mantenible?</p>
<h5 id="ejemplo-pintar-graficos-de-grabadoras">Ejemplo: pintar gráficos de grabadoras<a class="headerlink" href="#ejemplo-pintar-graficos-de-grabadoras" title="Permanent link">&para;</a></h5>
<ul>
<li>Pintar un gráfico con los datos registrados por una serie de grabadoras (<code>Recorder</code>) dispersas por el mundo.</li>
<li>Cada grabadora está en una ubicación (<code>Location</code>), que tiene una zona horaria (<code>TimeZone</code>).</li>
<li>Los usuarios seleccionan (<code>Selection</code>) una grabadora y pintan sus datos etiquetados con la zona horaria correcta...</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">plotDate</span><span class="p">(</span><span class="n">Date</span> <span class="n">aDate</span><span class="p">,</span> <span class="n">Selection</span> <span class="n">aSelection</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">TimeZone</span> <span class="n">tz</span> <span class="o">=</span> <span class="n">aSelection</span><span class="p">.</span><span class="na">getRecorder</span><span class="p">().</span><span class="na">getLocation</span><span class="p">().</span><span class="na">getZone</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

<h5 id="criticas">Críticas<a class="headerlink" href="#criticas" title="Permanent link">&para;</a></h5>
<ul>
<li>Multiplicidad de dependencias: <code>plotDate</code> <span><span class="MathJax_Preview">\dashrightarrow</span><script type="math/tex">\dashrightarrow</script></span> <code>Selection</code>, <code>Recorder</code>, <code>Location</code>, <code>TimeZone</code>.</li>
<li>Si cambia la implementación de <code>Location</code> de forma que ya no incluye directamente una <code>TimeZone</code>, hay que cambiar <code>plotDate</code></li>
<li>Añadir un método <em>delegado</em> <code>getTimeZone</code> a <code>Selection</code>. Así <code>plotDate</code> no se entera de si la <code>TimeZone</code> le llega desde <code>Recorder</code> o desde un objeto contenido en <code>Recorder</code>.</li>
</ul>
<p><div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">plotDate</span><span class="p">(</span><span class="n">Date</span> <span class="n">aDate</span><span class="p">,</span> <span class="n">TimeZone</span> <span class="n">tz</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/* ... */</span>
<span class="p">}</span>
<span class="n">plotDate</span><span class="p">(</span><span class="n">someDate</span><span class="p">,</span> <span class="n">someSelection</span><span class="p">.</span><span class="na">getTimeZone</span><span class="p">());</span>
</code></pre></div>
  Ahora <code>plotDate</code> <span><span class="MathJax_Preview">\dashrightarrow</span><script type="math/tex">\dashrightarrow</script></span> <code>Selection</code>, <code>TimeZone</code>, pero se han eliminado las restantes dependencias.
- Costes de espacio y ejecución de métodos <em>wrapper</em> que reenvían la petición al objeto delegado: violar la ley de Demeter para mejorar el <strong>rendimiento</strong>
- Otros ejemplos de mejora del rendimiento: desnormalización de BBDD</p>
<h2 id="toolkits-y-bibliotecas">Toolkits y bibliotecas<a class="headerlink" href="#toolkits-y-bibliotecas" title="Permanent link">&para;</a></h2>
<ul>
<li>Usar metadatos (@tag) para propósitos específicos – v.g. persistencia de objetos, transacciones, etc.</li>
<li><a href="../iiss-aop/">Aspect-Oriented Programming (AOP)</a></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Ver ahora el capítulo <a href="../iiss-aop/">Aspectos</a></p>
</div>
<div class="admonition warning">
<p class="admonition-title">Ver luego el capítulo <a href="../iiss-dbc/">Contratos</a></p>
</div>
<h2 id="errores-y-excepciones"><span style="color:blue;">Errores y Excepciones</span><a class="headerlink" href="#errores-y-excepciones" title="Permanent link">&para;</a></h2>
<p><a id="errores"></a></p>
<h3 id="tratamiento-de-errores">Tratamiento de errores<a class="headerlink" href="#tratamiento-de-errores" title="Permanent link">&para;</a></h3>
<h4 id="codigos-de-error">Códigos de error<a class="headerlink" href="#codigos-de-error" title="Permanent link">&para;</a></h4>
<p>Un ejemplo habitual de tratamiento de errores con <strong>códigos de error</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">if</span> <span class="p">(</span><span class="n">deletePage</span><span class="p">(</span><span class="n">page</span><span class="p">)</span> <span class="o">==</span> <span class="n">E_OK</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">registry</span><span class="p">.</span><span class="na">deleteReference</span><span class="p">(</span><span class="n">page</span><span class="p">.</span><span class="na">name</span><span class="p">)</span> <span class="o">==</span> <span class="n">E_OK</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">configKeys</span><span class="p">.</span><span class="na">deleteKey</span><span class="p">(</span><span class="n">page</span><span class="p">.</span><span class="na">name</span><span class="p">.</span><span class="na">makeKey</span><span class="p">())</span> <span class="o">==</span> <span class="n">E_OK</span><span class="p">){</span>
      <span class="n">logger</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="s">&quot;page deleted&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">logger</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="s">&quot;configKey not deleted&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">logger</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="s">&quot;deleteReference from registry failed&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="n">logger</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="s">&quot;delete failed&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">E_ERROR</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>Con esta técnica creamos <em>imanes de dependencias</em>:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kd">enum</span> <span class="n">Error</span> <span class="p">{</span>
  <span class="n">OK</span><span class="p">,</span>
  <span class="n">INVALID</span><span class="p">,</span>
  <span class="n">NO_SUCH</span><span class="p">,</span>
  <span class="n">LOCKED</span><span class="p">,</span>
  <span class="n">OUT_OF_RESOURCES</span><span class="p">,</span>
  <span class="n">WAITING_FOR_EVENT</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>Los programadores intentan evitar añadir nuevos motivos de error, porque eso significa tener que volver a compilar y desplegar todo el código.</p>
<h4 id="excepciones">Excepciones<a class="headerlink" href="#excepciones" title="Permanent link">&para;</a></h4>
<p>Usar <strong>excepciones</strong> en lugar de códigos de error:</p>
<div class="codehilite"><pre><span></span><code><span class="k">try</span> <span class="p">{</span>
  <span class="n">deletePage</span><span class="p">(</span><span class="n">page</span><span class="p">);</span>
  <span class="n">registry</span><span class="p">.</span><span class="na">deleteReference</span><span class="p">(</span><span class="n">page</span><span class="p">.</span><span class="na">name</span><span class="p">);</span>
  <span class="n">configKeys</span><span class="p">.</span><span class="na">deleteKey</span><span class="p">(</span><span class="n">page</span><span class="p">.</span><span class="na">name</span><span class="p">.</span><span class="na">makeKey</span><span class="p">());</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">logger</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div>

<p>¿No queda más claro?</p>
<p>Ventaja: las nuevas excepciones son derivadas de una clase base <code>Exception</code>, lo que facilita la definición de nuevos motivos de error.</p>
<p><span style="color:red;">¿Dónde se produce el error?</span></p>
<h4 id="separar-la-funcion-y-el-tratamiento-de-errores">Separar la función y el tratamiento de errores<a class="headerlink" href="#separar-la-funcion-y-el-tratamiento-de-errores" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="p">(</span><span class="n">Page</span> <span class="n">page</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">deletePageAndAllReferences</span><span class="p">(</span><span class="n">page</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">logError</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">private</span> <span class="kt">void</span> <span class="nf">deletePageAndAllReferences</span><span class="p">(</span><span class="n">Page</span> <span class="n">page</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
  <span class="n">deletePage</span><span class="p">(</span><span class="n">page</span><span class="p">);</span>
  <span class="n">registry</span><span class="p">.</span><span class="na">deleteReference</span><span class="p">(</span><span class="n">page</span><span class="p">.</span><span class="na">name</span><span class="p">);</span>
  <span class="n">configKeys</span><span class="p">.</span><span class="na">deleteKey</span><span class="p">(</span><span class="n">page</span><span class="p">.</span><span class="na">name</span><span class="p">.</span><span class="na">makeKey</span><span class="p">());</span>
<span class="p">}</span>

<span class="kd">private</span> <span class="kt">void</span> <span class="nf">logError</span><span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">logger</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div>

<p>¿No queda más fácil de comprender, modificar y depurar?</p>
<h3 id="excepciones-en-java">Excepciones en Java<a class="headerlink" href="#excepciones-en-java" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>Checked</strong>: instancias de clases derivadas de <code>java.lang.Throwable</code> (menos <code>RuntimeException</code>). Deben declararse en el método mediante <code>throws</code> y obligan al llamador a tratar la excepción.</p>
</li>
<li>
<p><strong>Unchecked</strong>: instancias de clases derivadas de <code>java.lang.RuntimeException</code>. No se declaran en el método y no obligan al llamador a tratar la excepción.</p>
</li>
</ul>
<p>Elevar una excepción <code>e</code> implica:</p>
<ul>
<li>Deshacer (<em>roll back</em>) la llamada a un método</li>
<li>hasta que se encuentre un bloque catch para el tipo de <code>e</code></li>
<li>y, si no se encuentra, la excepción es capturada por la JVM, que detiene el programa</li>
</ul>
<h4 id="tratamiento-de-excepciones-en-java">Tratamiento de excepciones en Java<a class="headerlink" href="#tratamiento-de-excepciones-en-java" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code>  <span class="k">try</span> <span class="p">{</span>
      <span class="cm">/* guarded region that can send</span>
<span class="cm">        IOException or Exception */</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">IOException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="cm">/* decide what to do when an IOException</span>
<span class="cm">        or a sub-class of IOException occurs */</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Treats any other exceptions</span>
  <span class="p">}</span>
  <span class="k">finally</span> <span class="p">{</span>
      <span class="c1">// in all cases execute this</span>
  <span class="p">}</span>
</code></pre></div>

<h3 id="recomendaciones">Recomendaciones<a class="headerlink" href="#recomendaciones" title="Permanent link">&para;</a></h3>
<p>Incluir el <strong>contexto</strong> de la ejecución:</p>
<ul>
<li>Incluir información suficiente con cada excepción para determinar el motivo y la ubicación de un error</li>
<li>No basta con el <em>stack trace</em></li>
<li>Escribir mensajes informativos: operación fallida y tipo de fallo</li>
</ul>
<p>Usar solamente excepciones <strong>unchecked</strong></p>
<ul>
<li>C#, C++, Python o Ruby no ofrecen excepciones <em>checked</em>.</li>
<li>Los beneficios de las checked en Java son mínimos</li>
<li>Se paga el precio de violar el principio OCP (Open-Closed Principle): si lanzamos una excepción <em>checked</em> desde un método y el <code>catch</code> está tres niveles por encima, hay que declarar la excepción en la signatura de todos los métodos que van entre medias. Esto significa que un cambio en un nivel bajo del software puede forzar cambios en niveles altos</li>
</ul>
<h3 id="transformacion-de-excepciones">Transformación de excepciones<a class="headerlink" href="#transformacion-de-excepciones" title="Permanent link">&para;</a></h3>
<h4 id="checked-vs-unchecked">Checked vs unchecked<a class="headerlink" href="#checked-vs-unchecked" title="Permanent link">&para;</a></h4>
<p>Muchas APIs de Java lanzan excepciones checked cuando deberían ser unchecked</p>
<p><strong>Ejemplo</strong>: Al ejecutar una consulta mediante <code>executeQuery</code> en el API de JDBC se lanza una excepción <code>java.sql.SQLException</code> (de tipo checked) si la SQL es errónea.</p>
<h5 id="solucion">Solución<a class="headerlink" href="#solucion" title="Permanent link">&para;</a></h5>
<p>Transformar las excepciones checked en unchecked:</p>
<div class="codehilite"><pre><span></span><code>  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// Codigo que genera la excepcion checked</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="p">(</span><span class="s">&quot;Unchecked exception&quot;</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span>
  <span class="p">}</span>
</code></pre></div>

<h4 id="excepciones-encapsuladas">Excepciones encapsuladas<a class="headerlink" href="#excepciones-encapsuladas" title="Permanent link">&para;</a></h4>
<p>Criticar la siguiente implementación:</p>
<div class="codehilite"><pre><span></span><code>  <span class="n">ACMEPort</span> <span class="n">port</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ACMEPort</span><span class="p">(</span><span class="mi">12</span><span class="p">);</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">port</span><span class="p">.</span><span class="na">open</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">DeviceResponseException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">reportPortError</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
    <span class="n">logger</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="s">&quot;Device response exception&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">ATM1212UnlockedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">reportPortError</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
    <span class="n">logger</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="s">&quot;Unlock exception&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">GMXError</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">reportPortError</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
    <span class="n">logger</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="s">&quot;Device response exception&quot;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
    <span class="p">...</span>
  <span class="p">}</span>
</code></pre></div>

<p>Excesiva duplicación de código: llamada a <code>reportPortError()</code></p>
<p>Excepción encapsulada:</p>
<div class="codehilite"><pre><span></span><code>    <span class="n">LocalPort</span> <span class="n">port</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LocalPort</span><span class="p">(</span><span class="mi">12</span><span class="p">);</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="n">port</span><span class="p">.</span><span class="na">open</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">PortDeviceFailure</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">reportPortError</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
      <span class="n">logger</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">(),</span> <span class="n">e</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
      <span class="p">...</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">LocalPort</span> <span class="p">{</span>
      <span class="kd">private</span> <span class="n">ACMEPort</span> <span class="n">innerPort</span><span class="p">;</span>
      <span class="kd">public</span> <span class="nf">LocalPort</span><span class="p">(</span><span class="kt">int</span> <span class="n">portNumber</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">innerPort</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ACMEPort</span><span class="p">(</span><span class="n">portNumber</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">open</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">PortDeviceFailure</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
          <span class="n">innerPort</span><span class="p">.</span><span class="na">open</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">DeviceResponseException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="n">PortDeviceFailure</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">ATM1212UnlockedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="n">PortDeviceFailure</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">GMXError</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="n">PortDeviceFailure</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="p">...</span>
    <span class="p">}</span>
</code></pre></div>

<ul>
<li>La encapsulación de excepciones es recomendable cuando se usa un API de terceros, para minimizar las dependencias con respecto al API elegido. </li>
<li>También facilitan la implementación de <em>mocks</em> del componente que proporciona el API para construir pruebas.</li>
</ul>
<h3 id="las-excepciones-son-excepcionales">Las excepciones son excepcionales<a class="headerlink" href="#las-excepciones-son-excepcionales" title="Permanent link">&para;</a></h3>
<p><strong>Recomendación de uso</strong>: Usar excepciones para problemas excepcionales (eventos inesperados)</p>
<p><strong>Ejemplo</strong>: <span style="color:red;">¿Usar excepciones cuando se intenta abrir un fichero para leer y el fichero no existe?</span></p>
<p>Depende de si el fichero debe estar ahí</p>
<ul>
<li>Usando excepciones:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">open_passwd</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">FileNotFoundException</span> <span class="p">{</span>
  <span class="c1">// This may throw FileNotFoundException...</span>
  <span class="n">ipstream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="p">(</span><span class="s">&quot;/etc/passwd&quot;</span><span class="p">);</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li>Sin usar excepciones:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">open_user_file</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">)</span>
    <span class="kd">throws</span> <span class="n">FileNotFoundException</span> <span class="p">{</span>
  <span class="n">File</span> <span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">f</span><span class="p">.</span><span class="na">exists</span><span class="p">())</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="n">ipstream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p><a id="null"></a></p>
<h3 id="uso-de-null">Uso de null<a class="headerlink" href="#uso-de-null" title="Permanent link">&para;</a></h3>
<p>Obtener un <em>null</em> cuando no se espera puede ser un quebradero de cabeza para el tratamiento de errores</p>
<h4 id="principio-general-no-devolver-null">Principio general: no devolver null<a class="headerlink" href="#principio-general-no-devolver-null" title="Permanent link">&para;</a></h4>
<p>Este código puede parecer inofensivo, pero es maligno:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">registerItem</span><span class="p">(</span><span class="n">Item</span> <span class="n">item</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">item</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ItemRegistry</span> <span class="n">registry</span> <span class="o">=</span> <span class="n">peristentStore</span><span class="p">.</span><span class="na">getItemRegistry</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">registry</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Item</span> <span class="n">existing</span> <span class="o">=</span> <span class="n">registry</span><span class="p">.</span><span class="na">getItem</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="na">getID</span><span class="p">());</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">existing</span><span class="p">.</span><span class="na">getBillingPeriod</span><span class="p">().</span><span class="na">hasRetailOwner</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">existing</span><span class="p">.</span><span class="na">register</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>¿Qué pasa si <code>persistentStore</code> es null?</p>
<ul>
<li>Peligro de <code>NullPointerException</code></li>
<li>¿Se nos ha olvidado añadir un <code>if null</code>?</li>
<li>El problema no es que se haya olvidado uno, sino que hay demasiados</li>
<li>En su lugar, elevar una excepción o devolver un objeto <em>especial</em></li>
</ul>
<h4 id="no-devolver-null">No devolver null<a class="headerlink" href="#no-devolver-null" title="Permanent link">&para;</a></h4>
<p>Evitar:</p>
<div class="codehilite"><pre><span></span><code><span class="n">List</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="n">getEmployees</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="n">employees</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span><span class="p">(</span><span class="n">Employee</span> <span class="n">e</span> <span class="p">:</span> <span class="n">employees</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">totalPay</span> <span class="o">+=</span> <span class="n">e</span><span class="p">.</span><span class="na">getPay</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Mejor así:</p>
<div class="codehilite"><pre><span></span><code><span class="n">List</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="n">getEmployees</span><span class="p">();</span>
<span class="k">for</span><span class="p">(</span><span class="n">Employee</span> <span class="n">e</span> <span class="p">:</span> <span class="n">employees</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">totalPay</span> <span class="o">+=</span> <span class="n">e</span><span class="p">.</span><span class="na">getPay</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span> <span class="nf">getEmployees</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span> <span class="cm">/* there are no employees */</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">Collections</span><span class="p">.</span><span class="na">emptyList</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="no-pasar-valores-null">No pasar valores null<a class="headerlink" href="#no-pasar-valores-null" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MetricsCalculator</span>
<span class="p">{</span>
  <span class="kd">public</span> <span class="kt">double</span> <span class="nf">xProjection</span><span class="p">(</span><span class="n">Point</span> <span class="n">p1</span><span class="p">,</span> <span class="n">Point</span> <span class="n">p2</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">p2</span><span class="p">.</span><span class="na">x</span> <span class="o">-</span> <span class="n">p1</span><span class="p">.</span><span class="na">x</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p><span style="color:red;">¿Qué sucede si llamamos a <code>xProjection()</code> así...?</span></p>
<div class="codehilite"><pre><span></span><code>  <span class="n">calculator</span><span class="p">.</span><span class="na">xProjection</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="k">new</span> <span class="n">Point</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">))</span>
</code></pre></div>

<p>Devolver null es malo, pero ¡pasar un valor null es peor!</p>
<p><span style="color:red;">¿Es mejor así...?</span></p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MetricsCalculator</span>
<span class="p">{</span>
  <span class="kd">public</span> <span class="kt">double</span> <span class="nf">xProjection</span><span class="p">(</span><span class="n">Point</span> <span class="n">p1</span><span class="p">,</span> <span class="n">Point</span> <span class="n">p2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">p1</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">p2</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="n">InvalidArgumentException</span><span class="p">(</span>
               <span class="s">&quot;Invalid argument for MetricsCalculator.xProjection&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">p2</span><span class="p">.</span><span class="na">x</span> <span class="o">-</span> <span class="n">p1</span><span class="p">.</span><span class="na">x</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>¿Qué curso de acción tomar ante un <code>InvalidArgumentException</code>? ¿Hay alguno?</p>
<h5 id="alternativa-con-aserciones">Alternativa con aserciones<a class="headerlink" href="#alternativa-con-aserciones" title="Permanent link">&para;</a></h5>
<p>(<em>solo para JDK <span><span class="MathJax_Preview">\geq</span><script type="math/tex">\geq</script></span> 5.0</em>)</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MetricsCalculator</span>
<span class="p">{</span>
  <span class="kd">public</span> <span class="kt">double</span> <span class="nf">xProjection</span><span class="p">(</span><span class="n">Point</span> <span class="n">p1</span><span class="p">,</span> <span class="n">Point</span> <span class="n">p2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">assert</span> <span class="n">p1</span> <span class="o">!=</span> <span class="kc">null</span> <span class="p">:</span> <span class="s">&quot;p1 should not be null&quot;</span><span class="p">;</span>
    <span class="k">assert</span> <span class="n">p2</span> <span class="o">!=</span> <span class="kc">null</span> <span class="p">:</span> <span class="s">&quot;p2 should not be null&quot;</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">p2</span><span class="p">.</span><span class="na">x</span> <span class="o">-</span> <span class="n">p1</span><span class="p">.</span><span class="na">x</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Es una buena forma de documentar, pero no resuelve el problema</p>
<h3 id="optionals">Optionals<a class="headerlink" href="#optionals" title="Permanent link">&para;</a></h3>
<ul>
<li>En la mayoría de lenguajes no hay forma satisfactoria de tratar con <em>nulls</em> pasados como argumento accidentalmente.</li>
<li>Para eso están los <em>options</em> u <em>optionals</em>, disponibles actualmente en muchos languajes:<ul>
<li><a href="https://www.tutorialspoint.com/scala/scala_options.htm">Scala <code>Option</code></a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html">Java 8</a> <code>java.util.Optional</code></li>
<li>C++17 <code>std::optional</code></li>
</ul>
</li>
<li><a href="https://github.com/Microsoft/TypeScript/wiki/Coding-guidelines#null-and-undefined">TypeScript recomienda usar <code>undefined</code></a> (algo que no se ha inicializado) en lugar de <code>null</code> (algo que no está disponible)</li>
</ul>
<h4 id="scala-options"><a href="https://www.tutorialspoint.com/scala/scala_options.htm">Scala Options</a><a class="headerlink" href="#scala-options" title="Permanent link">&para;</a></h4>
<p>En Scala, <code>Option[T]</code> es un contenedor de un valor opcional de tipo T.</p>
<ul>
<li>Si el valor de tipo T está presente, <code>Option[T]</code> es una intancia de <code>Some[T]</code> que contiene el valor presente de tipo T.</li>
<li>Si el valor está ausente, <code>Option[T]</code> es el objeto <code>None</code>.</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="k">object</span> <span class="nc">Demo</span> <span class="o">{</span>
   <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="o">{</span>
      <span class="k">val</span> <span class="n">a</span><span class="k">:</span><span class="kt">Option</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Some</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
      <span class="k">val</span> <span class="n">b</span><span class="k">:</span><span class="kt">Option</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span>

      <span class="n">println</span><span class="o">(</span><span class="s">&quot;a.isEmpty: &quot;</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="n">isEmpty</span> <span class="o">)</span>  <span class="c1">//false</span>
      <span class="n">println</span><span class="o">(</span><span class="s">&quot;b.isEmpty: &quot;</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">isEmpty</span> <span class="o">)</span>  <span class="c1">//true</span>
   <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="k">object</span> <span class="nc">Demo</span> <span class="o">{</span>
   <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="o">{</span>
      <span class="k">val</span> <span class="n">capitals</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span><span class="s">&quot;France&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;Paris&quot;</span><span class="o">,</span> <span class="s">&quot;Japan&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;Tokyo&quot;</span><span class="o">)</span>

      <span class="n">println</span><span class="o">(</span><span class="s">&quot;show(capitals.get( \&quot;Japan\&quot;)) : &quot;</span> <span class="o">+</span> <span class="n">show</span><span class="o">(</span><span class="n">capitals</span><span class="o">.</span><span class="n">get</span><span class="o">(</span> <span class="s">&quot;Japan&quot;</span><span class="o">))</span> <span class="o">)</span>
      <span class="n">println</span><span class="o">(</span><span class="s">&quot;show(capitals.get( \&quot;India\&quot;)) : &quot;</span> <span class="o">+</span> <span class="n">show</span><span class="o">(</span><span class="n">capitals</span><span class="o">.</span><span class="n">get</span><span class="o">(</span> <span class="s">&quot;India&quot;</span><span class="o">))</span> <span class="o">)</span>
   <span class="o">}</span>

   <span class="k">def</span> <span class="n">show</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="k">=</span> <span class="n">x</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Some</span><span class="o">(</span><span class="n">s</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">s</span>
      <span class="k">case</span> <span class="nc">None</span> <span class="k">=&gt;</span> <span class="s">&quot;?&quot;</span>
   <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>

<h4 id="java-8-optionals">Java 8 Optionals<a class="headerlink" href="#java-8-optionals" title="Permanent link">&para;</a></h4>
<p>From <a href="https://www.mkyong.com/java8/java-8-optional-in-depth/">Java 8 Optional in Depth</a></p>
<h5 id="ejemplo-sin-optional">Ejemplo sin <code>Optional</code><a class="headerlink" href="#ejemplo-sin-optional" title="Permanent link">&para;</a></h5>
<p>Programa de prueba:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MobileTesterWithoutOptional</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ScreenResolution</span> <span class="n">resolution</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ScreenResolution</span><span class="p">(</span><span class="mi">750</span><span class="p">,</span><span class="mi">1334</span><span class="p">);</span>
    <span class="n">DisplayFeatures</span> <span class="n">dfeatures</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DisplayFeatures</span><span class="p">(</span><span class="s">&quot;4.7&quot;</span><span class="p">,</span> <span class="n">resolution</span><span class="p">);</span>
    <span class="n">Mobile</span> <span class="n">mobile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mobile</span><span class="p">(</span><span class="mi">2015001</span><span class="p">,</span> <span class="s">&quot;Apple&quot;</span><span class="p">,</span> <span class="s">&quot;iPhone 6s&quot;</span><span class="p">,</span> <span class="n">dfeatures</span><span class="p">);</span>

    <span class="n">MobileService</span> <span class="n">mService</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MobileService</span><span class="p">();</span>

    <span class="kt">int</span> <span class="n">mobileWidth</span> <span class="o">=</span> <span class="n">mService</span><span class="p">.</span><span class="na">getMobileScreenWidth</span><span class="p">(</span><span class="n">mobile</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Apple iPhone 6s Screen Width = &quot;</span> <span class="o">+</span> <span class="n">mobileWidth</span><span class="p">);</span>

    <span class="n">ScreenResolution</span> <span class="n">resolution2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ScreenResolution</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">DisplayFeatures</span> <span class="n">dfeatures2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DisplayFeatures</span><span class="p">(</span><span class="s">&quot;0&quot;</span><span class="p">,</span> <span class="n">resolution2</span><span class="p">);</span>
    <span class="n">Mobile</span> <span class="n">mobile2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mobile</span><span class="p">(</span><span class="mi">2015001</span><span class="p">,</span> <span class="s">&quot;Apple&quot;</span><span class="p">,</span> <span class="s">&quot;iPhone 6s&quot;</span><span class="p">,</span> <span class="n">dfeatures2</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">mobileWidth2</span> <span class="o">=</span> <span class="n">mService</span><span class="p">.</span><span class="na">getMobileScreenWidth</span><span class="p">(</span><span class="n">mobile2</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Apple iPhone 16s Screen Width = &quot;</span> <span class="o">+</span> <span class="n">mobileWidth2</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Dependencias: <code>MobileService</code> <span><span class="MathJax_Preview">\dashrightarrow</span><script type="math/tex">\dashrightarrow</script></span> <code>DisplayFeatures</code>, <code>ScreenResolution</code></p>
<p>Cantidad de código <em>boilerplate</em> para comprobar los nulos en la clase principal:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MobileService</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getMobileScreenWidth</span><span class="p">(</span><span class="n">Mobile</span> <span class="n">mobile</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">mobile</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">){</span>
      <span class="n">DisplayFeatures</span> <span class="n">dfeatures</span> <span class="o">=</span> <span class="n">mobile</span><span class="p">.</span><span class="na">getDisplayFeatures</span><span class="p">();</span>
      <span class="k">if</span><span class="p">(</span><span class="n">dfeatures</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">){</span>
        <span class="n">ScreenResolution</span> <span class="n">resolution</span> <span class="o">=</span> <span class="n">dfeatures</span><span class="p">.</span><span class="na">getResolution</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">resolution</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">){</span>
          <span class="k">return</span> <span class="n">resolution</span><span class="p">.</span><span class="na">getWidth</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Clases de utilidad:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ScreenResolution</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">width</span><span class="p">;</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">height</span><span class="p">;</span>

  <span class="kd">public</span> <span class="nf">ScreenResolution</span><span class="p">(</span><span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="na">width</span> <span class="o">=</span> <span class="n">width</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">height</span> <span class="o">=</span> <span class="n">height</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getWidth</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">width</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getHeight</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">height</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DisplayFeatures</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">size</span><span class="p">;</span> <span class="c1">// In inches</span>
  <span class="kd">private</span> <span class="n">ScreenResolution</span> <span class="n">resolution</span><span class="p">;</span>

  <span class="kd">public</span> <span class="nf">DisplayFeatures</span><span class="p">(</span><span class="n">String</span> <span class="n">size</span><span class="p">,</span> <span class="n">ScreenResolution</span> <span class="n">resolution</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="na">size</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">resolution</span> <span class="o">=</span> <span class="n">resolution</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getSize</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">size</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="n">ScreenResolution</span> <span class="nf">getResolution</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">resolution</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Mobile</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="kt">long</span> <span class="n">id</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">brand</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">DisplayFeatures</span> <span class="n">displayFeatures</span><span class="p">;</span>
  <span class="c1">// Likewise we can see Memory Features, Camera Features etc.</span>

  <span class="kd">public</span> <span class="nf">Mobile</span><span class="p">(</span><span class="kt">long</span> <span class="n">id</span><span class="p">,</span> <span class="n">String</span> <span class="n">brand</span><span class="p">,</span> <span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">DisplayFeatures</span> <span class="n">displayFeatures</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">brand</span> <span class="o">=</span> <span class="n">brand</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">displayFeatures</span> <span class="o">=</span> <span class="n">displayFeatures</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getId</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">id</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getBrand</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">brand</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">name</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="n">DisplayFeatures</span> <span class="nf">getDisplayFeatures</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">displayFeatures</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h5 id="ejemplo-con-optionals">Ejemplo con <code>Optionals</code><a class="headerlink" href="#ejemplo-con-optionals" title="Permanent link">&para;</a></h5>
<p>Uso de métodos de <code>Optional</code> en el programa de prueba:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MobileTesterWithOptional</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ScreenResolution</span> <span class="n">resolution</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ScreenResolution</span><span class="p">(</span><span class="mi">750</span><span class="p">,</span><span class="mi">1334</span><span class="p">);</span>
    <span class="n">DisplayFeatures</span> <span class="n">dfeatures</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DisplayFeatures</span><span class="p">(</span><span class="s">&quot;4.7&quot;</span><span class="p">,</span> <span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">resolution</span><span class="p">));</span>
    <span class="n">Mobile</span> <span class="n">mobile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mobile</span><span class="p">(</span><span class="mi">2015001</span><span class="p">,</span> <span class="s">&quot;Apple&quot;</span><span class="p">,</span> <span class="s">&quot;iPhone 6s&quot;</span><span class="p">,</span> <span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">dfeatures</span><span class="p">));</span>

    <span class="n">MobileService</span> <span class="n">mService</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MobileService</span><span class="p">();</span>

    <span class="kt">int</span> <span class="n">width</span> <span class="o">=</span> <span class="n">mService</span><span class="p">.</span><span class="na">getMobileScreenWidth</span><span class="p">(</span><span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">mobile</span><span class="p">));</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Apple iPhone 6s Screen Width = &quot;</span> <span class="o">+</span> <span class="n">width</span><span class="p">);</span>

    <span class="n">Mobile</span> <span class="n">mobile2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mobile</span><span class="p">(</span><span class="mi">2015001</span><span class="p">,</span> <span class="s">&quot;Apple&quot;</span><span class="p">,</span> <span class="s">&quot;iPhone 6s&quot;</span><span class="p">,</span> <span class="n">Optional</span><span class="p">.</span><span class="na">empty</span><span class="p">());</span>
    <span class="kt">int</span> <span class="n">width2</span> <span class="o">=</span> <span class="n">mService</span><span class="p">.</span><span class="na">getMobileScreenWidth</span><span class="p">(</span><span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">mobile2</span><span class="p">));</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Apple iPhone 16s Screen Width = &quot;</span> <span class="o">+</span> <span class="n">width2</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Menos código <em>boilerplate</em> en la clase principal:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MobileService</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getMobileScreenWidth</span><span class="p">(</span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">Mobile</span><span class="o">&gt;</span> <span class="n">mobile</span><span class="p">){</span>
    <span class="k">return</span> <span class="n">mobile</span><span class="p">.</span><span class="na">flatMap</span><span class="p">(</span><span class="n">Mobile</span><span class="p">::</span><span class="n">getDisplayFeatures</span><span class="p">)</span>
      <span class="p">.</span><span class="na">flatMap</span><span class="p">(</span><span class="n">DisplayFeatures</span><span class="p">::</span><span class="n">getResolution</span><span class="p">)</span>
      <span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">ScreenResolution</span><span class="p">::</span><span class="n">getWidth</span><span class="p">)</span>
      <span class="p">.</span><span class="na">orElse</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Clases de utilidad:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">java.util.Optional</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DisplayFeatures</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">size</span><span class="p">;</span> <span class="c1">// In inches</span>
  <span class="kd">private</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">ScreenResolution</span><span class="o">&gt;</span> <span class="n">resolution</span><span class="p">;</span>
  <span class="kd">public</span> <span class="nf">DisplayFeatures</span><span class="p">(</span><span class="n">String</span> <span class="n">size</span><span class="p">,</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">ScreenResolution</span><span class="o">&gt;</span> <span class="n">resolution</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="na">size</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">resolution</span> <span class="o">=</span> <span class="n">resolution</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getSize</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">size</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">ScreenResolution</span><span class="o">&gt;</span> <span class="nf">getResolution</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">resolution</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Mobile</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="kt">long</span> <span class="n">id</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">brand</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">DisplayFeatures</span><span class="o">&gt;</span> <span class="n">displayFeatures</span><span class="p">;</span>
  <span class="c1">// Like wise we can see MemoryFeatures, CameraFeatures etc.</span>
  <span class="c1">// For simplicity, using only one Features</span>
  <span class="kd">public</span> <span class="nf">Mobile</span><span class="p">(</span><span class="kt">long</span> <span class="n">id</span><span class="p">,</span> <span class="n">String</span> <span class="n">brand</span><span class="p">,</span> <span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">DisplayFeatures</span><span class="o">&gt;</span> <span class="n">displayFeatures</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">brand</span> <span class="o">=</span> <span class="n">brand</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">displayFeatures</span> <span class="o">=</span> <span class="n">displayFeatures</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getId</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">id</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getBrand</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">brand</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">name</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">DisplayFeatures</span><span class="o">&gt;</span> <span class="nf">getDisplayFeatures</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">displayFeatures</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="fronteras">Fronteras<a class="headerlink" href="#fronteras" title="Permanent link">&para;</a></h3>
<p>Tensión proveedor-cliente</p>
<ul>
<li>Los proveedores de packages y frameworks quieren amplia aplicabilidad</li>
<li>Los clientes quieren una interfaz centrada en sus necesidades particulares</li>
</ul>
<p><strong>Ejemplo</strong>: La interfaz <a href="http://docs.oracle.com/javase/6/docs/api/java/util/Map.html"><code>java.util.Map</code></a></p>
<div class="codehilite"><pre><span></span><code><span class="n">clear</span><span class="p">()</span> <span class="kt">void</span> <span class="err">–</span> <span class="n">Map</span>
<span class="nf">containsKey</span><span class="p">(</span><span class="n">Object</span> <span class="n">key</span><span class="p">)</span> <span class="kt">boolean</span> <span class="err">–</span> <span class="n">Map</span>
<span class="nf">containsValue</span><span class="p">(</span><span class="n">Object</span> <span class="n">value</span><span class="p">)</span> <span class="kt">boolean</span> <span class="err">–</span> <span class="n">Map</span>
<span class="nf">entrySet</span><span class="p">()</span> <span class="n">Set</span> <span class="err">–</span> <span class="n">Map</span>
<span class="nf">equals</span><span class="p">(</span><span class="n">Object</span> <span class="n">o</span><span class="p">)</span> <span class="kt">boolean</span> <span class="err">–</span> <span class="n">Map</span>
<span class="nf">get</span><span class="p">(</span><span class="n">Object</span> <span class="n">key</span><span class="p">)</span> <span class="n">Object</span> <span class="err">–</span> <span class="n">Map</span>
<span class="nf">getClass</span><span class="p">()</span> <span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="err">–</span> <span class="n">Object</span>
<span class="nf">hashCode</span><span class="p">()</span> <span class="kt">int</span> <span class="err">–</span> <span class="n">Map</span>
<span class="nf">isEmpty</span><span class="p">()</span> <span class="kt">boolean</span> <span class="err">–</span> <span class="n">Map</span>
<span class="nf">keySet</span><span class="p">()</span> <span class="n">Set</span> <span class="err">–</span> <span class="n">Map</span>
<span class="nf">notify</span><span class="p">()</span> <span class="kt">void</span> <span class="err">–</span> <span class="n">Object</span>
<span class="nf">notifyAll</span><span class="p">()</span> <span class="kt">void</span> <span class="err">–</span> <span class="n">Object</span>
<span class="nf">put</span><span class="p">(</span><span class="n">Object</span> <span class="n">key</span><span class="p">,</span> <span class="n">Object</span> <span class="n">value</span><span class="p">)</span> <span class="n">Object</span> <span class="err">–</span> <span class="n">Map</span>
<span class="nf">putAll</span><span class="p">(</span><span class="n">Map</span> <span class="n">t</span><span class="p">)</span> <span class="kt">void</span> <span class="err">–</span> <span class="n">Map</span>
<span class="nf">remove</span><span class="p">(</span><span class="n">Object</span> <span class="n">key</span><span class="p">)</span> <span class="n">Object</span> <span class="err">–</span> <span class="n">Map</span>
<span class="nf">size</span><span class="p">()</span> <span class="kt">int</span> <span class="err">–</span> <span class="n">Map</span>
<span class="nf">toString</span><span class="p">()</span> <span class="n">String</span> <span class="err">–</span> <span class="n">Object</span>
<span class="nf">values</span><span class="p">()</span> <span class="n">Collection</span> <span class="err">–</span> <span class="n">Map</span>
<span class="nf">wait</span><span class="p">()</span> <span class="kt">void</span> <span class="err">–</span> <span class="n">Object</span>
<span class="nf">wait</span><span class="p">(</span><span class="kt">long</span> <span class="n">timeout</span><span class="p">)</span> <span class="kt">void</span> <span class="err">–</span> <span class="n">Object</span>
<span class="nf">wait</span><span class="p">(</span><span class="kt">long</span> <span class="n">timeout</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nanos</span><span class="p">)</span> <span class="kt">void</span> <span class="err">–</span> <span class="n">Object</span>
</code></pre></div>

<p>Construimos un <code>Map</code> y lo pasamos.</p>
<ul>
<li>Diseño A: Ninguno de los receptores deberá poder borrar algo del map. ¡Pero hay un <code>clear()</code>!</li>
<li>Diseño B: solo algunos tipos de objetos deben poderse guardar. ¡Los tipos no están restringidos!</li>
</ul>
<p>¿La interfaz <code>Map</code> es siempre satisfactoria? ¿seguro que no va a cambiar?</p>
<ul>
<li>JDK &lt; 5.0:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="n">Map</span> <span class="n">sensors</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="p">();</span>
<span class="p">...</span>
<span class="n">Sensor</span> <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">Sensor</span><span class="p">)</span><span class="n">sensors</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">sensorId</span><span class="p">);</span>
</code></pre></div>

<ul>
<li>JDK <span><span class="MathJax_Preview">\geq</span><script type="math/tex">\geq</script></span> 5.0:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="n">Map</span><span class="o">&lt;</span><span class="n">Sensor</span><span class="o">&gt;</span> <span class="n">sensors</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">Sensor</span><span class="o">&gt;</span><span class="p">();</span>
<span class="p">...</span>
<span class="n">Sensor</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sensors</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">sensorId</span><span class="p">);</span>
</code></pre></div>

<p><strong>Conclusión</strong>: Map<Sensor> ofrece más de lo que necesitamos</p>
<div class="codehilite"><pre><span></span><code>  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Sensors</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="n">Map</span> <span class="n">sensors</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="p">();</span>
    <span class="kd">public</span> <span class="n">Sensor</span> <span class="nf">getById</span><span class="p">(</span><span class="n">String</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="n">Sensor</span><span class="p">)</span> <span class="n">sensors</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">//...</span>
  <span class="p">}</span>
</code></pre></div>

<ul>
<li>La interfaz <code>Map</code> queda oculta</li>
<li>Filtramos los métodos que no nos sirven</li>
<li>Más fácil de hacer evolucionar sin impacto en el resto de la aplicación</li>
<li>El casting queda confinado en la clase Sensors, que es más seguro</li>
</ul>
<p><strong>Interfaces de frontera</strong>: No todo uso de <code>Map</code> o interfaz de
frontera debe quedar encapsulado. Sólo es un consejo para no ’pasarla’
con métodos que no vamos a necesitar.</p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/dodero" target="_blank" rel="noopener" title="github" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/jmdodero" target="_blank" rel="noopener" title="twitter" class="md-footer-social__link fa fa-twitter"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.1",url:{base:".."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>