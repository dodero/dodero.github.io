<!DOCTYPE html><html><head>
      <title>disenyo-all</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:////Users/dodero/.vscode/extensions/shd101wyy.markdown-preview-enhanced-0.3.8/node_modules/@shd101wyy/mume/dependencies/katex/katex.min.css">
      
      
      
      
      
      
      
      
      

      <style> 
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
 
      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview   ">
      <h1 class="mume-header" id="dise%C3%B1o-de-sistemas-software">DISE&#xD1;O DE SISTEMAS SOFTWARE</h1>

<h2 class="mume-header" id="bloques">Bloques</h2>

<ol>
<li>Principios de dise&#xF1;o OO</li>
<li>Patrones de dise&#xF1;o</li>
<li>Arquitectura de software</li>
</ol>
<p><a id="clase01" href=""></a></p>
<h2 class="mume-header" id="introducci%C3%B3n">Introducci&#xF3;n</h2>

<h3 class="mume-header" id="problem%C3%A1ticas">Problem&#xE1;ticas</h3>

<ul>
<li>Variabilidad</li>
<li>Acoplamiento</li>
<li>Complejidad</li>
<li>Robustez</li>
<li>Reutilizaci&#xF3;n</li>
<li>Flexibilidad</li>
</ul>
<h3 class="mume-header" id="principios">Principios</h3>

<ul>
<li>Ocultaci&#xF3;n: OCP, ISP, LSP</li>
<li>Cohesi&#xF3;n: SRP</li>
<li>Ortogonalidad: ISP</li>
<li>Delegaci&#xF3;n</li>
</ul>
<h3 class="mume-header" id="t%C3%A9cnicas">T&#xE9;cnicas</h3>

<ul>
<li>Refactoring</li>
<li>Bibliotecas y frameworks</li>
<li>Contratos</li>
<li>Inyecci&#xF3;n de dependencias</li>
<li>Patrones</li>
</ul>
<h3 class="mume-header" id="paradigmas">Paradigmas</h3>

<ul>
<li>Estructurado (E. W. Dijsktra)</li>
<li>Objetos (O. J. Dahl &amp; K. Nygaard)</li>
<li>Funcional (J. McCarthy)</li>
<li>Aspectos (G. Kiczales)</li>
<li>Eventos</li>
</ul>
<h4 class="mume-header" id="pregunta">Pregunta</h4>

<p><em>&#xBF;De qu&#xE9; fecha data cada paradigma?</em><br>
<em>&#xBF;Cu&#xE1;l dir&#xED;ais que es el m&#xE1;s antiguo?</em></p>
<h4 class="mume-header" id="respuesta">Respuesta</h4>

<p><em>&#xBF;De qu&#xE9; fecha data cada paradigma?</em></p>
<ul>
<li>Estructurado (E. W. Dijsktra, 1968)</li>
<li>Objetos (O. J. Dahl &amp; K. Nygaard, 1966)</li>
<li>Funcional (J. McCarthy, 1958)</li>
<li>Aspectos (G. Kiczales, 1997)</li>
<li>Eventos</li>
</ul>
<h2 class="mume-header" id="casos-pr%C3%A1cticos">Casos pr&#xE1;cticos</h2>

<ol>
<li><a href="#handler">Identificadores</a></li>
<li><a href="#junit">Framework de pruebas unitarias</a></li>
<li><a href="#knights">Caballeros de la mesa redonda</a></li>
<li><a href="#guitarras">Guitarras Paco</a></li>
<li><a href="#figuras">Figuras geom&#xE9;tricas</a></li>
</ol>
<h1 class="mume-header" id="caso-pr%C3%A1ctico-1">CASO PR&#xC1;CTICO 1</h1>

<p><a id="handler" href=""></a></p>
<h2 class="mume-header" id="identificadores">Identificadores</h2>

<h3 class="mume-header" id="versi%C3%B3n-inicial-identificadores-v01">Versi&#xF3;n inicial: Identificadores v0.1</h3>

<pre data-role="codeBlock" data-info="java" class="language-java">  <span class="token keyword">class</span> <span class="token class-name">Empleado</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> dni<span class="token punctuation">;</span>
    <span class="token function">Empleado</span> <span class="token punctuation">(</span>String dni<span class="token punctuation">)</span> <span class="token keyword">throws</span> NumberFormatException <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>dni <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>dni<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">int</span> <span class="token function">getDni</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> dni<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>dni<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span>Empleado otro<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dni <span class="token operator">-</span> otro<span class="token punctuation">.</span><span class="token function">getDni</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span>Empleado otro<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> dni<span class="token operator">==</span>otro<span class="token punctuation">.</span><span class="token function">getDni</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</pre><h4 class="mume-header" id="cr%C3%ADticas">Cr&#xED;ticas:</h4>

<ul>
<li><strong>Flexibilidad</strong>: El Real Decreto 338/1990 regula el uso de NIFs en lugar de DNIs. &#xA1;Hay que cambiar toda la implementaci&#xF3;n!</li>
</ul>
<h3 class="mume-header" id="implementaci%C3%B3n-alternativa-identificadores-v02">Implementaci&#xF3;n alternativa: Identificadores v0.2</h3>

<pre data-role="codeBlock" data-info="java" class="language-java">  <span class="token keyword">class</span> <span class="token class-name">Empleado</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> String nif<span class="token punctuation">;</span>
    <span class="token function">Empleado</span> <span class="token punctuation">(</span>String nif<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>nif <span class="token operator">=</span> nif
    <span class="token punctuation">}</span>
    String <span class="token function">getNif</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> id<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> nif<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span>Empleado otro<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> nif<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>otro<span class="token punctuation">.</span><span class="token function">getNif</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span>Empleado otro<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> nif<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>otro<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</pre><h4 class="mume-header" id="cr%C3%ADticas-1">Cr&#xED;ticas:</h4>

<ul>
<li><strong>Reutilizaci&#xF3;n</strong>: Posiblemente haya m&#xE1;s situaciones (algunas futuras) donde hagan falta <em>identificadores</em> que incluso pueden cambiar. Por ejemplo: n&#xFA;meros de la seguridad social, tarjetas de identidad, n&#xFA;meros de cuenta corriente, IBAN, etc.</li>
</ul>
<h3 class="mume-header" id="hacemos-refactoring-patr%C3%B3n-handler">Hacemos refactoring: patr&#xF3;n <em>handler</em></h3>

<ul>
<li>
<p>Manejo de <em>identificadores</em> de forma independiente de la<br>
implementaci&#xF3;n del objeto identificado.</p>
</li>
<li>
<p>Cambio f&#xE1;cil de implementaci&#xF3;n de los identificadores (<code>int</code>,<br>
<code>String</code>, etc.) hacia cualquier tipo b&#xE1;sico o clase primitiva,<br>
sencilla o compuesta.</p>
</li>
</ul>
<h2 class="mume-header" id="patr%C3%B3n-handler">Patr&#xF3;n Handler</h2>

<p><img src="./figuras/handler.png" alt="Dise&#xF1;o de un handler"></p>
<ul>
<li>
<p><strong>Identifiable</strong>: Clase cliente que necesita identificar a sus objetos a trav&#xE9;s de alg&#xFA;n atributo identificador</p>
</li>
<li>
<p><strong>Handler</strong>: Interfaz para declarar los identificadores de los objetos de la clase <code>Identifiable</code></p>
</li>
<li>
<p><strong>ConcreteHandler</strong>: Implementaci&#xF3;n concreta de la interfaz <code>Handler</code></p>
</li>
</ul>
<h3 class="mume-header" id="implementaci%C3%B3n-del-patr%C3%B3n">Implementaci&#xF3;n del patr&#xF3;n</h3>

<pre data-role="codeBlock" data-info="java" class="language-java">  <span class="token keyword">interface</span> <span class="token class-name">Handler</span><span class="token punctuation">{</span>
      String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span>Handler otro<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">IdentificadorNumerico</span> <span class="token keyword">implements</span> <span class="token class-name">Handler</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token function">IdentificadorNumerico</span> <span class="token punctuation">(</span>String id<span class="token punctuation">)</span> <span class="token keyword">throws</span> NumberFormatException <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span>Handler otro<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>otro<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</pre><h2 class="mume-header" id="ejercicio-javalangcomparable">Ejercicio: <code>java.lang.Comparable</code></h2>

<p>Implementar un identificador utilizando <code>java.lang.Comparable</code> del JDK.</p>
<p><code>Comparable</code> es una interfaz implementada por <code>String</code>, <code>File</code>, <code>Date</code>, etc. y todas las llamadas <em>clases de envoltura</em> del JDK (i.e. <code>Integer</code>, <code>Long</code>, etc.)</p>
<p><strong>M&#xE9;todos de la interfaz</strong>:</p>
<pre data-role="codeBlock" data-info="java" class="language-java">  <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span>Object o<span class="token punctuation">)</span> <span class="token keyword">throws</span> ClassCastException
</pre><p><strong>Invariantes:</strong></p>
<p><code>sgn(x.compareTo(y)) = -sgn(y.compareTo(x))</code></p>
<p><code>(x.compareTo(y)&gt;0 and y.compareTo(z)&gt;0)</code> <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>&#x21D2;</mo></mrow><annotation encoding="application/x-tex">\Rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">&#x21D2;</span></span></span></span> <code>x.compareTo(z)&gt;0</code></p>
<p><code>x.compareTo(y)=0</code> <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>&#x21D2;</mo></mrow><annotation encoding="application/x-tex">\Rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">&#x21D2;</span></span></span></span> <code>sgn(x.compareTo(z))=sgn(y.compareTo(z))</code> <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">&#x2200;</mi></mrow><annotation encoding="application/x-tex">\forall</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord">&#x2200;</span></span></span></span> <code>z</code></p>
<p><strong>Consistencia con <code>equals</code></strong>:</p>
<p><code>(x.compareTo(y)=0)</code> <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>&#x21D4;</mo></mrow><annotation encoding="application/x-tex">\Leftrightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">&#x21D4;</span></span></span></span> <code>(x.equals(y))</code></p>
<h2 class="mume-header" id="reutilizaci%C3%B3n-y-flexibilidad">Reutilizaci&#xF3;n y flexibilidad</h2>

<ul>
<li><strong>Flexibilidad</strong>: Adaptarse a cambios de requisitos y construir software f&#xE1;cil de cambiar</li>
<li><strong>Reutilizaci&#xF3;n</strong>: Construir software f&#xE1;cil de reutilizar sin tener que cambiar los m&#xF3;dulos ya escritos</li>
</ul>
<h1 class="mume-header" id="caso-pr%C3%A1ctico-2">CASO PR&#xC1;CTICO 2</h1>

<p><a id="junit" href=""></a></p>
<h2 class="mume-header" id="framework-de-pruebas-unitarias">Framework de pruebas unitarias</h2>

<ul>
<li>JUnit es un framework en Java que sirve para dise&#xF1;ar, construir y ejecutar <strong>pruebas unitarias</strong></li>
<li>Una prueba unitaria comprueba la correcci&#xF3;n de un <em>m&#xF3;dulo</em> de software en cuanto a funcionalidades que ofrece.</li>
<li>En el caso de Java, las pruebas unitarias comprueban la correcci&#xF3;n de cada uno de los m&#xE9;todos de <em>cada clase</em>.</li>
<li>&#xBF;C&#xF3;mo funciona?</li>
</ul>
<h3 class="mume-header" id="c%C3%B3mo-probar-saludojava">&#xBF;C&#xF3;mo probar <code>Saludo.java</code>?</h3>

<p>Incluir un m&#xE9;todo <code>main</code> que pruebe la funcionalidad de la clase:</p>
<pre data-role="codeBlock" data-info="java" class="language-java"><span class="token keyword">class</span> <span class="token class-name">Saludo</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
  * Imprime &quot;Hola Mundo!&quot;
  */</span>
  <span class="token keyword">void</span> <span class="token function">saludar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hola Mundo!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/**
  * Imprime un mensaje
  */</span>
  <span class="token keyword">void</span> <span class="token function">saludar</span><span class="token punctuation">(</span>String mensaje<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>mensaje<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
  * Tests
  */</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span> String<span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Saludo saludo1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Saludo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    saludo1<span class="token punctuation">.</span><span class="token function">saludar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Saludo saludo2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Saludo</span><span class="token punctuation">(</span><span class="token string">&quot;Hola caracola!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    saludo2<span class="token punctuation">.</span><span class="token function">saludar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><h3 class="mume-header" id="pegas">Pegas</h3>

<ul>
<li>
<p>Cuanto m&#xE1;s grande sea la interfaz de la clase, mayor ser&#xE1; el main</p>
</li>
<li>
<p>El tama&#xF1;o del c&#xF3;digo de la clase crece por las pruebas</p>
</li>
<li>
<p>Poco fiable, porque main forma parte de la misma clase y tiene acceso a los elementos privados</p>
</li>
<li>
<p>Dif&#xED;cil de automatizar las pruebas, incluso pasando argumentos a <code>main</code></p>
</li>
</ul>
<h3 class="mume-header" id="ejemplo-software-_cliente_-del-framework">Ejemplo: software <em>cliente</em> del framework</h3>

<h4 class="mume-header" id="caso-de-prueba-con-junit-4">Caso de prueba con jUnit 4</h4>

<pre data-role="codeBlock" data-info="java" class="language-java">  <span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token keyword">static</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Assert<span class="token punctuation">.</span>*<span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SaludoTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      junit<span class="token punctuation">.</span>textui<span class="token punctuation">.</span>TestRunner<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>SaludoTest<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saludar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Saludo hola <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Saludo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">assert</span><span class="token punctuation">(</span> hola<span class="token operator">!=</span>null <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;Hola Mundo!&quot;</span><span class="token punctuation">,</span> hola<span class="token punctuation">.</span><span class="token function">saludar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</pre><p>Ejecuci&#xF3;n de los tests:</p>
<pre data-role="codeBlock" data-info="java" class="language-java"><span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span>JUnitCore<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span>Result<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>Failure<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyTestRunner</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Result result <span class="token operator">=</span> JUnitCore<span class="token punctuation">.</span><span class="token function">runClasses</span><span class="token punctuation">(</span>SaludoTest<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>Failure failure <span class="token operator">:</span> result<span class="token punctuation">.</span><span class="token function">getFailures</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>failure<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>&#xBF;De qu&#xE9; est&#xE1;n hechas las anotaciones como <code>@Test</code>?<br>
Veamos una versi&#xF3;n anterior de jUnit, que expone m&#xE1;s claramente las <em>tripas</em> del framework</p>
<h4 class="mume-header" id="caso-de-prueba-con-junit-3">Caso de prueba con jUnit 3</h4>

<pre data-role="codeBlock" data-info="java" class="language-java"><span class="token keyword">import</span> junit<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>TestCase<span class="token punctuation">;</span>
<span class="token keyword">import</span> junit<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>Assert<span class="token punctuation">;</span>
  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SaludoTest</span> <span class="token keyword">extends</span> <span class="token class-name">TestCase</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">SaludoTest</span><span class="token punctuation">(</span>String nombre<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">(</span>nombre<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSaludar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Saludo hola <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Saludo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">assert</span><span class="token punctuation">(</span> hola<span class="token operator">!=</span>null <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;Hola Mundo!&quot;</span><span class="token punctuation">,</span> hola<span class="token punctuation">.</span><span class="token function">saludar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p><a id="clase02" href=""></a></p>
<h3 class="mume-header" id="dise%C3%B1o-del-framework-junit">Dise&#xF1;o del framework jUnit</h3>

<h4 class="mume-header" id="estructura-de-clases">Estructura de clases:</h4>

<p><img src="./figuras/junit-design-1.png" alt="Clases del framework jUnit"></p>
<h4 class="mume-header" id="ejecuci%C3%B3n-de-casos-de-prueba">Ejecuci&#xF3;n de casos de prueba:</h4>

<p><img src="./figuras/junit-design-2.png" alt="Clases del framework jUnit"></p>
<h3 class="mume-header" id="ejemplo-aplicaci%C3%B3n-de-comercio-electr%C3%B3nico">Ejemplo: aplicaci&#xF3;n de comercio electr&#xF3;nico</h3>

<p>Dise&#xF1;o de una aplicaci&#xF3;n de comercio electr&#xF3;nico:</p>
<ul>
<li><code>ShoppingCart</code> - carrito de la compra</li>
<li><code>CreditCard</code> - tarjeta de cr&#xE9;dito</li>
<li><code>Product</code>- art&#xED;culos</li>
<li>Etc.</li>
</ul>
<p>Dise&#xF1;o de pruebas unitarias de <code>ShoppingCart</code> para:</p>
<ul>
<li>Probar carrito de la compra (a&#xF1;adir/eliminar art&#xED;culos)</li>
<li>Probar validaci&#xF3;n de tarjetas de cr&#xE9;dito</li>
<li>Probar manejo de varias monedas</li>
<li>Etc.</li>
</ul>
<h4 class="mume-header" id="shoppingcart">ShoppingCart</h4>

<pre data-role="codeBlock" data-info="java" class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShoppingCart</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> ArrayList items<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token function">ShoppingCart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addItem</span><span class="token punctuation">(</span>Product p<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeItem</span><span class="token punctuation">(</span>Product p<span class="token punctuation">)</span>
      <span class="token keyword">throws</span> ProductNotFoundException <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getItemCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><h4 class="mume-header" id="shoppingcarttestcase-con-junit-3">ShoppingCartTestCase con jUnit 3</h4>

<pre data-role="codeBlock" data-info="java" class="language-java"><span class="token keyword">import</span> junit<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>TestCase<span class="token punctuation">;</span>
<span class="token keyword">import</span> junit<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>TestSuite<span class="token punctuation">;</span>
<span class="token keyword">import</span> junit<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>Assert<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShoppingCartTest</span> <span class="token keyword">extends</span> <span class="token class-name">TestCase</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> ShoppingCart bookCart<span class="token punctuation">;</span>
  <span class="token keyword">private</span> Product defaultBook<span class="token punctuation">;</span>
  <span class="token comment">//...</span>
  <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      bookCart <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShoppingCart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      defaultBook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token string">&quot;Extreme Programming&quot;</span><span class="token punctuation">,</span> <span class="token number">23.95</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      bookCart<span class="token punctuation">.</span><span class="token function">addItem</span><span class="token punctuation">(</span>defaultBook<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      bookCart <span class="token operator">=</span> null<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>  
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      bookCart<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">assertTrue</span><span class="token punctuation">(</span>bookCart<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testProductAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Product book <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token string">&quot;Refactoring&quot;</span><span class="token punctuation">,</span> <span class="token number">53.95</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      bookCart<span class="token punctuation">.</span><span class="token function">addItem</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">double</span> expectedBalance <span class="token operator">=</span> defaultBook<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> book<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">assertEquals</span><span class="token punctuation">(</span>expectedBalance<span class="token punctuation">,</span> bookCart<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> bookCart<span class="token punctuation">.</span><span class="token function">getItemCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testProductRemove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> ProductNotFoundException <span class="token punctuation">{</span>
      bookCart<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span>defaultBook<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> bookCart<span class="token punctuation">.</span><span class="token function">getItemCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> bookCart<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testProductNotFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
          Product book <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token string">&quot;Ender&apos;s Game&quot;</span><span class="token punctuation">,</span> <span class="token number">4.95</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          bookCart<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Should raise a ProductNotFoundException&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>ProductNotFoundException success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> Test <span class="token function">suite</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Use reflection to add all testXXX() methods</span>
         TestSuite suite <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TestSuite</span><span class="token punctuation">(</span>ShoppingCartTest<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// Alternatively, but prone to error when adding more</span>
      <span class="token comment">// test case methods...</span>
      <span class="token comment">// TestSuite suite = new TestSuite();</span>
      <span class="token comment">// suite.addTest(new ShoppingCartTest(&quot;testProductAdd&quot;));</span>
      <span class="token comment">// suite.addTest(new ShoppingCartTest(&quot;testEmpty&quot;));</span>
      <span class="token comment">// suite.addTest(new ShoppingCartTest(&quot;testProductRemove&quot;));</span>
      <span class="token comment">// suite.addTest(new ShoppingCartTestCase(&quot;testProductNotFound&quot;));</span>
         <span class="token keyword">return</span> suite<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>Ahora agrupamos varios casos de prueba en una misma <em>suite</em>:</p>
<pre data-role="codeBlock" data-info="java" class="language-java"><span class="token keyword">import</span> junit<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>Test<span class="token punctuation">;</span>
<span class="token keyword">import</span> junit<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>TestSuite<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span>JUnitCore<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span>Result<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>Failure<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EcommerceTestSuite</span> <span class="token keyword">extends</span> <span class="token class-name">TestSuite</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> Test <span class="token function">suite</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        TestSuite suite <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TestSuite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        suite<span class="token punctuation">.</span><span class="token function">addTest</span><span class="token punctuation">(</span>ShoppingCartTest<span class="token punctuation">.</span><span class="token function">suite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> suite<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyTestRunner</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Result result <span class="token operator">=</span> JUnitCore<span class="token punctuation">.</span><span class="token function">runClasses</span><span class="token punctuation">(</span>EcommerceTestSuite<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>Failure failure <span class="token operator">:</span> result<span class="token punctuation">.</span><span class="token function">getFailures</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>failure<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><h4 class="mume-header" id="shoppingcarttestcase-con-junit-4">ShoppingCartTestCase con jUnit 4</h4>

<pre data-role="codeBlock" data-info="java" class="language-java"><span class="token keyword">import</span> <span class="token keyword">static</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Assert<span class="token punctuation">.</span>assertEquals<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Assert<span class="token punctuation">.</span>fail<span class="token punctuation">;</span>

<span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>After<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Before<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Test<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShoppingCartTest</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> ShoppingCart bookCart<span class="token punctuation">;</span>
  <span class="token keyword">private</span> Product defaultBook<span class="token punctuation">;</span>
  <span class="token comment">//...</span>
  <span class="token annotation punctuation">@Before</span>
  <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      bookCart <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShoppingCart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      defaultBook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token string">&quot;Extreme Programming&quot;</span><span class="token punctuation">,</span> <span class="token number">23.95</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      bookCart<span class="token punctuation">.</span><span class="token function">addItem</span><span class="token punctuation">(</span>defaultBook<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token annotation punctuation">@After</span>
  <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      bookCart <span class="token operator">=</span> null<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      bookCart<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">assertTrue</span><span class="token punctuation">(</span>bookCart<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testProductAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Product book <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token string">&quot;Refactoring&quot;</span><span class="token punctuation">,</span> <span class="token number">53.95</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      bookCart<span class="token punctuation">.</span><span class="token function">addItem</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">double</span> expectedBalance <span class="token operator">=</span> defaultBook<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> book<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">assertEquals</span><span class="token punctuation">(</span>expectedBalance<span class="token punctuation">,</span> bookCart<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> bookCart<span class="token punctuation">.</span><span class="token function">getItemCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testProductRemove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      bookCart<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span>defaultBook<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> bookCart<span class="token punctuation">.</span><span class="token function">getItemCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> bookCart<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token annotation punctuation">@Test</span><span class="token punctuation">(</span>expected <span class="token operator">=</span> ProductNotFoundException<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testProductNotFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Product book <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token string">&quot;Ender&apos;s Game&quot;</span><span class="token punctuation">,</span> <span class="token number">4.95</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      bookCart<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Should raise a ProductNotFoundException&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><h4 class="mume-header" id="ecommercetestsuite-con-junit-3">EcommerceTestSuite con jUnit 3</h4>

<pre data-role="codeBlock" data-info="java" class="language-java">  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EcommerceTestSuite</span> <span class="token keyword">extends</span> <span class="token class-name">TestSuite</span> <span class="token punctuation">{</span>
      <span class="token comment">//...</span>
      <span class="token keyword">public</span> <span class="token keyword">static</span> Test <span class="token function">suite</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          TestSuite suite <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TestSuite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          suite<span class="token punctuation">.</span><span class="token function">addTest</span><span class="token punctuation">(</span>ShoppingCartTest<span class="token punctuation">.</span><span class="token function">suite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          suite<span class="token punctuation">.</span><span class="token function">addTest</span><span class="token punctuation">(</span>CreditCardTest<span class="token punctuation">.</span><span class="token function">suite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// etc.</span>
          <span class="token keyword">return</span> suite<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</pre><h4 class="mume-header" id="ecommercetestsuite-con-junit-4">EcommerceTestSuite con jUnit 4</h4>

<pre data-role="codeBlock" data-info="java" class="language-java">  <span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span>Suite<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
  <span class="token annotation punctuation">@SuiteClasses</span><span class="token punctuation">(</span><span class="token punctuation">{</span> ShoppingCartTest<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
                  CreditCardTest<span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EcommerceTestSuite</span> <span class="token punctuation">{</span>
      <span class="token comment">//...</span>
  <span class="token punctuation">}</span>
</pre><h3 class="mume-header" id="ejercicio-creditcardtest">Ejercicio: CreditCardTest</h3>

<p>Dise&#xF1;ar y codificar una suite de casos de prueba unitaria para <code>CreditCard</code> usando jUnit 4.</p>
<h3 class="mume-header" id="arquitectura-del-framework">Arquitectura del framework</h3>

<p><img src="./figuras/junit-patterns.png" alt="Clases del framework jUnit"></p>
<p>En la arquitectura del framework se observan diversos patrones: Composite, Command, Adapter, Factory, Decorator, etc.</p>
<h2 class="mume-header" id="span-stylecolorbluebibliotecas-y-frameworksspan"><span style="color:blue;">Bibliotecas y frameworks</span></h2>

<h3 class="mume-header" id="biblioteca">Biblioteca</h3>

<p><img src="./figuras/biblioteca.png" alt="Flujo de control en una biblioteca"></p>
<h4 class="mume-header" id="flujo-de-control-en-un-framework">Flujo de control en un framework</h4>

<p><img src="./figuras/framework.png" alt="Flujo de control en una framework"></p>
<h3 class="mume-header" id="span-stylecolorblueframeworksspan"><span style="color:blue;">Frameworks</span></h3>

<h4 class="mume-header" id="definici%C3%B3n-de-framework">Definici&#xF3;n de <em>framework</em></h4>

<blockquote>
<p>Colecci&#xF3;n de clases e interfaces que cooperan para formar un dise&#xF1;o reutilizable de un tipo espec&#xED;fico de software</p>
<p>-- <cite><a href="#gamma">E. Gamma et al.</a></cite></p>
</blockquote>
<ul>
<li>El framework proporciona unas gu&#xED;as arquitect&#xF3;nicas (dise&#xF1;o empaquetado) para dividir el dise&#xF1;o en clases abstractas y definir sus <em>responsabilidades</em> y <em>colaboraciones</em>.</li>
<li>El framework se debe personalizar definiendo subclases y combinando instancias, o bien configurando valores que definen el comportamiento por defecto</li>
</ul>
<h4 class="mume-header" id="principios-de-dise%C3%B1o">Principios de dise&#xF1;o</h4>

<ul>
<li>Datos encapsulados</li>
<li>Interfaces y clases abstractas</li>
<li>M&#xE9;todos polim&#xF3;rficos</li>
<li>Delegaci&#xF3;n</li>
</ul>
<h4 class="mume-header" id="herramientas-de-dise%C3%B1o">Herramientas de dise&#xF1;o</h4>

<ul>
<li><strong>Patrones</strong>: elementos reutilizables de dise&#xF1;o</li>
<li><strong>Frameworks</strong>: colecciones de patrones abstractos a aplicar</li>
</ul>
<h4 class="mume-header" id="framework-vs-biblioteca">Framework vs. biblioteca</h4>

<ul>
<li>API orientado a objetos</li>
<li>Flujo de control invertido</li>
<li>Programador cliente (c&#xF3;digo espec&#xED;fico) vs. programador de bibliotecas (c&#xF3;digo reutilizable)</li>
</ul>
<h3 class="mume-header" id="principios-y-t%C3%A9cnicas-de-un-framework">Principios y t&#xE9;cnicas de un framework</h3>

<ul>
<li>
<p><strong>Abstracci&#xF3;n</strong></p>
<ul>
<li>Clases y componentes abstractos</li>
<li>Interfaces abiertas</li>
<li>Uso de patrones de dise&#xF1;o</li>
<li>Componentes de un dominio espec&#xED;fico</li>
</ul>
</li>
<li>
<p>M&#xE1;xima <strong>cohesi&#xF3;n</strong>, m&#xED;nimo <strong>acoplamiento</strong></p>
<ul>
<li>Minimizar dependencias: Una clase presenta una dependencia con otra clase si la primera usa una instancia de la segunda.</li>
<li>Cuando no se pueden eliminar las dependencias, mantener las abstractas e <em>inyectar</em> las concretas.</li>
</ul>
</li>
<li>
<p><strong>Inyecci&#xF3;n de dependencias</strong>: una clase o m&#xF3;dulo no deber&#xED;a configurar sus dependencias est&#xE1;ticamente, sino ser configurada desde fuera</p>
</li>
</ul>
<h1 class="mume-header" id="caso-pr%C3%A1ctico-3">CASO PR&#xC1;CTICO 3</h1>

<p><a id="knights" href=""></a></p>
<h2 class="mume-header" id="ejemplo-caballeros-de-la-mesa-redonda">Ejemplo: Caballeros de la mesa redonda</h2>

<p><strong>Tomado de <a id="bibliografia.html#spring" href="">Spring in Action</a></strong></p>
<p>A&#xF1;adir pruebas unitarias a la soluci&#xF3;n siguiente:</p>
<pre data-role="codeBlock" data-info="java" class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KnightOfTheRoundTable</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> String name<span class="token punctuation">;</span>
  <span class="token keyword">private</span> HolyGrailQuest quest<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token function">KnightOfTheRoundTable</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    quest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HolyGrailQuest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> HolyGrail <span class="token function">embarkOnQuest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">throws</span> GrailNotFoundException <span class="token punctuation">{</span>
    <span class="token keyword">return</span> quest<span class="token punctuation">.</span><span class="token function">embark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HolyGrailQuest</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token function">HolyGrailQuest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">public</span> HolyGrail <span class="token function">embark</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token keyword">throws</span> GrailNotFoundException <span class="token punctuation">{</span>
  HolyGrail grail <span class="token operator">=</span> null<span class="token punctuation">;</span>
    <span class="token comment">// Look for grail</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">return</span> grail<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><h3 class="mume-header" id="dise%C3%B1o-de-pruebas-con-junit-3">Dise&#xF1;o de pruebas con jUnit 3</h3>

<p>&#xBF;D&#xF3;nde est&#xE1; el acoplamiento?</p>
<pre data-role="codeBlock" data-info="java" class="language-java"><span class="token keyword">import</span> junit<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>TestCase<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KnightOfTheRoundTableTest</span> <span class="token keyword">extends</span> <span class="token class-name">TestCase</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testEmbarkOnQuest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> GrailNotFoundException <span class="token punctuation">{</span>
    KnightOfTheRoundTable knight <span class="token operator">=</span>
        <span class="token keyword">new</span> <span class="token class-name">KnightOfTheRoundTable</span><span class="token punctuation">(</span><span class="token string">&quot;CruzadoMagico&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    HolyGrail grail <span class="token operator">=</span> knight<span class="token punctuation">.</span><span class="token function">embarkOnQuest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertNotNull</span><span class="token punctuation">(</span>grail<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertTrue</span><span class="token punctuation">(</span>grail<span class="token punctuation">.</span><span class="token function">isHoly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><ul>
<li>
<p>Instanciaci&#xF3;n de <code>HolyGrail</code></p>
</li>
<li>
<p>Cada vez que se prueba <code>KnightOfTheRoundTable</code>, tambi&#xE9;n se prueba <code>HolyGrailQuest</code>.</p>
</li>
<li>
<p>No se puede pedir a <code>HolyGrailQuest</code> que se comporte de otra forma (v.g. devolver null o elevar una excepci&#xF3;n)</p>
</li>
</ul>
<p>Ocultar la implementaci&#xF3;n detr&#xE1;s de una interfaz:</p>
<pre data-role="codeBlock" data-info="java" class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Knight</span> <span class="token punctuation">{</span>
  Object <span class="token function">embarkOnQuest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> QuestFailedException<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KnightOfTheRoundTable</span> <span class="token keyword">implements</span> <span class="token class-name">Knight</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> String name<span class="token punctuation">;</span>
  <span class="token keyword">private</span> Quest quest<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token function">KnightOfTheRoundTable</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    quest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HolyGrailQuest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> Object <span class="token function">embarkOnQuest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> QuestFailedException <span class="token punctuation">{</span>
    <span class="token keyword">return</span> quest<span class="token punctuation">.</span><span class="token function">embark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Quest</span> <span class="token punctuation">{</span>
  <span class="token keyword">abstract</span> Object <span class="token function">embark</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">throws</span> QuestFailedException<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HolyGrailQuest</span> <span class="token keyword">implements</span> <span class="token class-name">Quest</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token function">HolyGrailQuest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">public</span> Object <span class="token function">embark</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> QuestFailedException <span class="token punctuation">{</span>
    <span class="token comment">// Do whatever it means to embark on a quest</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HolyGrail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><ul>
<li>El <code>Knight</code> a&#xFA;n recibe un tipo espec&#xED;fico de <code>Quest</code></li>
<li>&#xBF;Debe ser el caballero responsable de obtener un desaf&#xED;o?</li>
</ul>
<pre data-role="codeBlock" data-info="java" class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KnightOfTheRoundTable</span> <span class="token keyword">implements</span> <span class="token class-name">Knight</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> String name<span class="token punctuation">;</span>
  <span class="token keyword">private</span> Quest quest<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token function">KnightOfTheRoundTable</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> Object <span class="token function">embarkOnQuest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> QuestFailedException <span class="token punctuation">{</span>
    <span class="token keyword">return</span> quest<span class="token punctuation">.</span><span class="token function">embark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setQuest</span><span class="token punctuation">(</span>Quest quest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>quest <span class="token operator">=</span> quest<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><ul>
<li>
<p>El caballero s&#xF3;lo sabe del desaf&#xED;o a trav&#xE9;s de su interfaz <code>Quest</code>.</p>
</li>
<li>
<p>Puede asign&#xE1;rsele cualquier implementaci&#xF3;n de <code>Quest</code><br>
(<code>HolyGrailQuest</code>, <code>RescueDamselQuest</code>, etc.)</p>
</li>
</ul>
<p><img src="./figuras/di-knight.png" alt=""></p>
<h2 class="mume-header" id="span-stylecolorblueinyecci%C3%B3n-de-dependenciasspan"><span style="color:blue;">Inyecci&#xF3;n de dependencias</span></h2>

<p><img src="./figuras/dep-injection.png" alt=""></p>
<h3 class="mume-header" id="inversi%C3%B3n-de-control">Inversi&#xF3;n de control</h3>

<ul>
<li>Es la base de la inyecci&#xF3;n de dependencias</li>
</ul>
<blockquote>
<p>The question is: &quot;what aspect of control are they inverting?&quot; [...] Early user interfaces were controlled by the application program. You would have a sequence of commands like &quot;Enter name&quot;, &quot;enter address&quot;; your program would drive the prompts and pick up a response to each one. With graphical (or even screen based) UIs the UI framework would contain this main loop and your program instead provided event handlers for the various fields on the screen. The main control of the program was inverted, moved away from you to the framework</p>
<p><cite> Martin Fowler</cite>, <a href="http://martinfowler.com/articles/injection.html">http://martinfowler.com/articles/injection.html</a></p>
</blockquote>
<ul>
<li>Una aplicaci&#xF3;n son dos o m&#xE1;s clases que colaboran.</li>
<li>Los objetos deben recibir las dependencias en su creaci&#xF3;n, por parte de una entidad externa que coordina los objetos.</li>
<li>Inversi&#xF3;n de la responsabilidad de c&#xF3;mo un objeto obtiene referencias a los objetos con los que colabora</li>
<li>Ventaja = <strong>bajo acoplamiento</strong>: un objeto s&#xF3;lo sabe de sus dependencias por su interfaz, no por su implementaci&#xF3;n, ni por c&#xF3;mo fueron instanciados. Entonces la dependencia puede cambiarse por una implementaci&#xF3;n distinta (incluso en tiempo de ejecuci&#xF3;n)</li>
<li><em>Hollywood Principle: Don&apos;t call us, we&apos;ll call you&quot;.</em></li>
</ul>
<h3 class="mume-header" id="factor%C3%ADas">Factor&#xED;as</h3>

<p>Una factor&#xED;a proporciona un mecanismo de inyecci&#xF3;n de dependencias, visto desde el lado opuesto (los clientes adquieren las dependencias, no se les inyecta)</p>
<p>Ejemplo: <a href="http://www.baeldung.com/spring-factorybean">Spring FactoryBean</a></p>
<h2 class="mume-header" id="span-stylecolorbluediscusi%C3%B3n-sobre-la-reutilizaci%C3%B3nspan"><span style="color:blue;">Discusi&#xF3;n sobre la reutilizaci&#xF3;n</span></h2>

<blockquote>
<p>We most likely would have been better off not attempting to create a reusable function in the first place</p>
<p>-- <cite>Roger Sessions, The Misuse of Reuse [1]</cite></p>
</blockquote>
<p>[1] <a href="http://simplearchitectures.blogspot.com.es/2012/07/misuse-of-reuse.html">http://simplearchitectures.blogspot.com.es/2012/07/misuse-of-reuse.html</a></p>
<h3 class="mume-header" id="factorizar-una-funci%C3%B3n">Factorizar una funci&#xF3;n</h3>

<p><img src="./figuras/misuse-reuse-1.png" alt="Reutilizaci&#xF3;n de una funci&#xF3;n"></p>
<p><img src="./figuras/misuse-reuse-2.png" alt="Reutilizaci&#xF3;n de una funci&#xF3;n"></p>
<h3 class="mume-header" id="ventajas-supuestas-de-reutilizar">Ventajas (supuestas) de reutilizar:</h3>

<p><strong>Ahorro</strong>:</p>
<p>Si <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">&#x2203;</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">\exists s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord">&#x2203;</span><span class="mord mathit">s</span></span></span></span> sistemas <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>&#x2227;</mo><mtext>&#xA0;</mtext><mi>c</mi><mi>o</mi><mi>s</mi><mi>t</mi><mi>e</mi><mo>(</mo><mi>F</mi><mi>u</mi><mi>n</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mtext>&#xA0;</mtext><mn>1</mn><mo>)</mo><mo>=</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">\wedge ~ coste(Function~1) = c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">&#x2227;</span><span class="mspace nobreak">&#xA0;</span><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="mord mathit">u</span><span class="mord mathit">n</span><span class="mord mathit">c</span><span class="mord mathit">t</span><span class="mord mathit">i</span><span class="mord mathit">o</span><span class="mord mathit">n</span><span class="mspace nobreak">&#xA0;</span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">c</span></span></span></span>&#xA0;&#x20AC; <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>&#x21D2;</mo></mrow><annotation encoding="application/x-tex">\Rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">&#x21D2;</span></span></span></span> ahorro = <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi><mo>&#xD7;</mo><mo>(</mo><mi>s</mi><mo>&#x2212;</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">c \times (s-1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathit">c</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#xD7;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathit">s</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>&#xA0;&#x20AC;</p>
<h3 class="mume-header" id="amenazas-reales">Amenazas (reales):</h3>

<p><img src="./figuras/misuse-reuse-3.png" alt="Reutilizaci&#xF3;n de una funci&#xF3;n"></p>
<ul>
<li>Realmente el ahorro depende de la <strong>complejidad</strong>. Y muchas veces, la complejidad de la funci&#xF3;n est&#xE1; exponencialmente relacionada con el n&#xFA;mero de sistemas.</li>
<li>Con un &#xFA;nico punto de fallo, Si la funci&#xF3;n 1 falla, todos los sistemas pueden fallar a la vez.</li>
<li>La seguridad es inversamente proporcional a la complejidad del sistema.</li>
<li>Se incrementan los costes de llevar los sistemas a la nube.</li>
</ul>
<h3 class="mume-header" id="conclusi%C3%B3n">Conclusi&#xF3;n</h3>

<p>No crear funciones reutilizables en primer lugar</p>
<p>Aplicar el principio <strong>YAGNI</strong>: <strong>You Ain&apos;t Gonna Need It</strong></p>
<h1 class="mume-header" id="caso-pr%C3%A1ctico-4">CASO PR&#xC1;CTICO 4</h1>

<p><a id="guitarras" href=""></a></p>
<h2 class="mume-header" id="guitarras-paco">Guitarras Paco</h2>

<p>El cliente (Paco) quiere:</p>
<ul>
<li>
<p>Mantener un inventario de guitarras</p>
</li>
<li>
<p>Encontrar guitarras para sus clientes</p>
</li>
</ul>
<p>Problemas de la aplicaci&#xF3;n heredada:</p>
<ul>
<li>
<p>Caso de uso: un cliente busca una guitarra flamenca &#x2018;Valeriano Bernal&#x2019;, pero no encuentra ninguna</p>
</li>
<li>
<p>&#xBF;Problemas?</p>
</li>
</ul>
<h3 class="mume-header" id="una-aplicaci%C3%B3n-heredada">Una aplicaci&#xF3;n heredada</h3>

<p><img src="./figuras/guitar_m1b.png" alt="Guitar e Inventory"></p>
<p><img src="./figuras/uml_guitar_m1.png" alt="Guitar"></p>
<p><img src="./figuras/uml_inventory_m1.png" alt="Inventory"></p>
<h3 class="mume-header" id="implementaci%C3%B3n-guitarra">Implementaci&#xF3;n: Guitarra</h3>

<pre data-role="codeBlock" data-info="java" class="language-java">  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Guitar</span> <span class="token punctuation">{</span>
     <span class="token keyword">private</span> String serialNumber<span class="token punctuation">,</span> builder<span class="token punctuation">,</span> model<span class="token punctuation">,</span> type<span class="token punctuation">,</span> backWood<span class="token punctuation">,</span> topWood<span class="token punctuation">;</span>
     <span class="token keyword">private</span> <span class="token keyword">double</span> price<span class="token punctuation">;</span>

     <span class="token keyword">public</span> <span class="token function">Guitar</span><span class="token punctuation">(</span>String serialNumber<span class="token punctuation">,</span> <span class="token keyword">double</span> price<span class="token punctuation">,</span>
                        String builder<span class="token punctuation">,</span> String model<span class="token punctuation">,</span> String type<span class="token punctuation">,</span>
                        String backWood<span class="token punctuation">,</span> String topWood<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>serialNumber <span class="token operator">=</span> serialNumber<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> price<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>builder <span class="token operator">=</span> builder<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>model <span class="token operator">=</span> model<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> type<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>backWood <span class="token operator">=</span> backWood<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>topWood <span class="token operator">=</span> topWood<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>

     <span class="token keyword">public</span> String <span class="token function">getSerialNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> serialNumber<span class="token punctuation">;</span><span class="token punctuation">}</span>
     <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> price<span class="token punctuation">;</span><span class="token punctuation">}</span>
     <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token keyword">float</span> newPrice<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> newPrice<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">public</span> String <span class="token function">getBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> builder<span class="token punctuation">;</span><span class="token punctuation">}</span>
     <span class="token keyword">public</span> String <span class="token function">getModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> model<span class="token punctuation">;</span><span class="token punctuation">}</span>
     <span class="token keyword">public</span> String <span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> type<span class="token punctuation">;</span><span class="token punctuation">}</span>
     <span class="token keyword">public</span> String <span class="token function">getBackWood</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> backWood<span class="token punctuation">;</span><span class="token punctuation">}</span>
     <span class="token keyword">public</span> String <span class="token function">getTopWood</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> topWood<span class="token punctuation">;</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</pre><h3 class="mume-header" id="implementaci%C3%B3n-inventario">Implementaci&#xF3;n: Inventario</h3>

<pre data-role="codeBlock" data-info="java" class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Inventory</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> List guitars<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token function">Inventory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> guitars <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addGuitar</span><span class="token punctuation">(</span>String serialNumber<span class="token punctuation">,</span> <span class="token keyword">double</span> price<span class="token punctuation">,</span>
                        String builder<span class="token punctuation">,</span> String model<span class="token punctuation">,</span>
                        String type<span class="token punctuation">,</span> String backWood<span class="token punctuation">,</span> String topWood<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Guitar guitar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Guitar</span><span class="token punctuation">(</span>serialNumber<span class="token punctuation">,</span> price<span class="token punctuation">,</span> builder<span class="token punctuation">,</span>
                               model<span class="token punctuation">,</span> type<span class="token punctuation">,</span> backWood<span class="token punctuation">,</span> topWood<span class="token punctuation">)</span><span class="token punctuation">;</span>
    guitars<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>guitar<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> Guitar <span class="token function">getGuitar</span><span class="token punctuation">(</span>String serialNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>Iterator i <span class="token operator">=</span> guitars<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Guitar guitar <span class="token operator">=</span> <span class="token punctuation">(</span>Guitar<span class="token punctuation">)</span>i<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>guitar<span class="token punctuation">.</span><span class="token function">getSerialNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>serialNumber<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> guitar<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> null<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> Guitar <span class="token function">search</span><span class="token punctuation">(</span>Guitar searchGuitar<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>Iterator i <span class="token operator">=</span> guitars<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Guitar guitar <span class="token operator">=</span> <span class="token punctuation">(</span>Guitar<span class="token punctuation">)</span>i<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      String builder <span class="token operator">=</span> searchGuitar<span class="token punctuation">.</span><span class="token function">getBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>builder <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>builder<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
          <span class="token punctuation">(</span><span class="token operator">!</span>builder<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>guitar<span class="token punctuation">.</span><span class="token function">getBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">continue</span><span class="token punctuation">;</span>
      String model <span class="token operator">=</span> searchGuitar<span class="token punctuation">.</span><span class="token function">getModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>model <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>model<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
          <span class="token punctuation">(</span><span class="token operator">!</span>model<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>guitar<span class="token punctuation">.</span><span class="token function">getModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">continue</span><span class="token punctuation">;</span>
      String type <span class="token operator">=</span> searchGuitar<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>type <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>searchGuitar<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
          <span class="token punctuation">(</span><span class="token operator">!</span>type<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>guitar<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">continue</span><span class="token punctuation">;</span>
      String backWood <span class="token operator">=</span> searchGuitar<span class="token punctuation">.</span><span class="token function">getBackWood</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>backWood <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>backWood<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
          <span class="token punctuation">(</span><span class="token operator">!</span>backWood<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>guitar<span class="token punctuation">.</span><span class="token function">getBackWood</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">continue</span><span class="token punctuation">;</span>
      String topWood <span class="token operator">=</span> searchGuitar<span class="token punctuation">.</span><span class="token function">getTopWood</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>topWood <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>topWood<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
          <span class="token punctuation">(</span><span class="token operator">!</span>topWood<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>guitar<span class="token punctuation">.</span><span class="token function">getTopWood</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">continue</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> guitar<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> null<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><h2 class="mume-header" id="algunos-problemas">Algunos problemas</h2>

<ul>
<li>
<p>Se compara el fabricante sin tener en cuenta may&#xFA;sculas/min&#xFA;sculas</p>
</li>
<li>
<p>Se comparan todos los campos sin tener en cuenta<br>
may&#xFA;sculas/min&#xFA;sculas</p>
</li>
<li>
<p>No hay definidas constantes para cada fabricante</p>
</li>
</ul>
<p>&#xBF;Estas soluciones abordan el verdadero problema?</p>
<p>Preguntar a Paco...</p>
<h3 class="mume-header" id="preguntar-al-cliente">Preguntar al cliente</h3>

<p>Preguntemos a Paco, que no tiene por qu&#xE9; saber nada de objetos ni bases<br>
de datos:</p>
<ul>
<li>
<p>&#xBF;S&#xF3;lo vendes guitarras?</p>
</li>
<li>
<p>&#xBF;C&#xF3;mo actualizas el inventario?</p>
</li>
<li>
<p>&#xBF;C&#xF3;mo funciona la b&#xFA;squeda de guitarras?</p>
</li>
<li>
<p>&#xBF;Necesitar&#xE1;s informes de inventario y de ventas?</p>
</li>
</ul>
<h3 class="mume-header" id="respuestas-del-cliente">Respuestas del cliente</h3>

<p>Paco dice que:</p>
<ul>
<li>
<p>Los clientes no siempre conocen las caracter&#xED;sticas exactas de la guitarra que quieren</p>
</li>
<li>
<p>Los clientes suelen buscar guitarras dentro de un rango de precios</p>
</li>
<li>
<p>Suele haber m&#xE1;s de una guitarra que casa con las necesidades del cliente</p>
</li>
<li>
<p>S&#xED;, necesito informes y dem&#xE1;s, pero &#xA1;la prioridad n&#xBA; 1 es encontrar las guitarras!</p>
</li>
</ul>
<h2 class="mume-header" id="ejercicio">Ejercicio</h2>

<p>Hacer refactoring de la aplicaci&#xF3;n heredada de Guitarras Paco</p>
<h1 class="mume-header" id="caso-pr%C3%A1ctico-5">CASO PR&#xC1;CTICO 5</h1>

<p><a id="figuras" href=""></a></p>
<h2 class="mume-header" id="figuras-geom%C3%A9tricas">Figuras geom&#xE9;tricas</h2>

<p><a href="https://en.wikipedia.org/wiki/SOLID_(object-oriented_design)">Uncle Bob Martin principles</a></p>
<h2 class="mume-header" id="span-stylecolorblueprincipio-de-responsabilidad-%C3%BAnica-span"><span style="color:blue;">Principio de responsabilidad &#xFA;nica </span></h2>

<p><strong>SRP: <em>Single responsibility Principle</em></strong></p>
<blockquote>
<p>A class should have onlye one reason to change<br>
<cite>-- Uncle Bob Martin</cite></p>
</blockquote>
<ul>
<li>Una clase que modela m&#xFA;ltiples aspectos genera acoplamiento entre los distintos aspectos</li>
<li>Un cambio en alg&#xFA;n aspecto obligar&#xE1; a cambios accidentales en los clientes que no dependen de dicho aspecto</li>
</ul>
<p>SRP es lo mismo que el principio de <strong>cohesi&#xF3;n</strong> de <a href="bibliografia.html#demarco">DeMarco</a></p>
<h3 class="mume-header" id="ejemplo-shapes-v1-en-java">Ejemplo: Shapes v1 en Java</h3>

<p><a id="shapesV1" href=""></a></p>
<ul>
<li>&#xBF;Cu&#xE1;ntas responsabilidades tienen las clases que implementan la interfaz <code>Shape</code>?</li>
<li>&#xBF;Cu&#xE1;les son estas responsabilidades?</li>
<li>&#xBF;Qu&#xE9; parte no cumple SRP en el ejemplo?</li>
</ul>
<pre data-role="codeBlock" data-info="java" class="language-java"><span class="token keyword">package</span> shapes<span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>
  <span class="token keyword">double</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span>
  <span class="token keyword">double</span> <span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  <span class="token keyword">double</span> <span class="token function">getY</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Polygon</span> <span class="token keyword">implements</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>
  Point <span class="token function">getVertex</span><span class="token punctuation">(</span>index i<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Triangle</span> <span class="token keyword">extends</span> <span class="token class-name">Polygon</span> <span class="token punctuation">{</span>
  <span class="token keyword">double</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">RectParallelogram</span> <span class="token keyword">extends</span> <span class="token class-name">Polygon</span> <span class="token punctuation">{</span>
  <span class="token keyword">double</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Square</span> <span class="token keyword">extends</span> <span class="token class-name">RectParallelogram</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Rectangle</span> <span class="token keyword">extends</span> <span class="token class-name">RectParallelogram</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">ClosedCurve</span> <span class="token keyword">implements</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Circle</span> <span class="token keyword">extends</span> <span class="token class-name">ClosedCurve</span> <span class="token punctuation">{</span>
  <span class="token keyword">double</span> <span class="token function">getRadius</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  Point <span class="token function">getCenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  <span class="token keyword">double</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Ellipse</span> <span class="token keyword">extends</span> <span class="token class-name">ClosedCurve</span> <span class="token punctuation">{</span>
  <span class="token keyword">double</span> <span class="token function">getApogeeRadius</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  <span class="token keyword">double</span> <span class="token function">getPerigeeRadius</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  Point <span class="token function">getFocus1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  Point <span class="token function">getFocus2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  Point <span class="token function">getCenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  <span class="token keyword">double</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><ul>
<li>Dos responsabilidades: geometr&#xED;a computacional + dibujo en pantalla</li>
<li>Todas las figuras tienen m&#xE9;todos <code>draw</code> y <code>toString</code> (dibujar en pantalla) adem&#xE1;s del m&#xE9;todo <code>area</code> que calcula el &#xE1;rea (geometr&#xED;a computacional) <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>&#x2192;</mo></mrow><annotation encoding="application/x-tex">\rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">&#x2192;</span></span></span></span> Violaci&#xF3;n del SRP</li>
</ul>
<h4 class="mume-header" id="soluci%C3%B3n">Soluci&#xF3;n</h4>

<p>Patrones de dise&#xF1;o: <em>visitor</em></p>
<h4 class="mume-header" id="otros-ejemplos">Otros ejemplos</h4>

<ul>
<li>ActiveRecord viola SRP. Sustituir por DAO</li>
</ul>
<h2 class="mume-header" id="span-stylecolorblueprincipio-de-abierto-cerradospan"><span style="color:blue;">Principio de Abierto-Cerrado</span></h2>

<p><strong>OCP: <em>Open-Closed Principle</em></strong></p>
<blockquote>
<p>Toda clase, m&#xF3;dulo, aspecto o funci&#xF3;n debe quedar abierto para extensiones pero cerrado para modificaciones</p>
<p><cite>B. Meyer, <a href="#meyer">Object Oriented Software Construction</a></cite></p>
</blockquote>
<ul>
<li>Si un cambio en un sitio origina una cascada de cambios en otros puntos del sistema, el resultado es un sistema fr&#xE1;gil y r&#xED;gido</li>
<li>Es dif&#xED;cil averiguar todos los puntos que requieren cambios</li>
<li>C&#xF3;digo cerrado para modificaciones, pero abierto para extensi&#xF3;n mediante delegaci&#xF3;n en vertical (subclases) u horizontal (composici&#xF3;n)</li>
</ul>
<h3 class="mume-header" id="ejemplo-shapes-versi%C3%B3n-2-en-c">Ejemplo: Shapes versi&#xF3;n 2 en C++</h3>

<p>&#xBF;Qu&#xE9; parte no cumple OCP en el ejemplo?</p>
<h4 class="mume-header" id="versi%C3%B3n-imperativa-sin-objetos">Versi&#xF3;n imperativa (sin objetos):</h4>

<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword">enum</span> ShapeType <span class="token punctuation">{</span>circle<span class="token punctuation">,</span> square<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> Shape
<span class="token punctuation">{</span>
  <span class="token class-name">ShapeType</span> itsType<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> Circle
<span class="token punctuation">{</span>
  <span class="token class-name">ShapeType</span> itsType<span class="token punctuation">;</span>
  <span class="token keyword">double</span> itsRadius<span class="token punctuation">;</span>
  <span class="token class-name">Point</span> itsCenter<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">DrawCircle</span><span class="token punctuation">(</span><span class="token keyword">struct</span> Circle<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> Square
<span class="token punctuation">{</span>
  <span class="token class-name">ShapeType</span> itsType<span class="token punctuation">;</span>
  <span class="token keyword">double</span> itsSide<span class="token punctuation">;</span>
  <span class="token class-name">Point</span> itsTopLeft<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">DrawSquare</span><span class="token punctuation">(</span><span class="token keyword">struct</span> Square<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

typedef <span class="token keyword">struct</span> Shape <span class="token operator">*</span>ShapePointer<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">DrawAllShapes</span><span class="token punctuation">(</span><span class="token class-name">ShapePointer</span> list<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">int</span> i<span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">struct</span> Shape<span class="token operator">*</span> s <span class="token operator">=</span> list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>s<span class="token operator">-</span><span class="token operator">&gt;</span>itsType<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">case</span> square<span class="token punctuation">:</span>
        <span class="token function">DrawSquare</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">struct</span> Square<span class="token operator">*</span><span class="token punctuation">)</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> circle<span class="token punctuation">:</span>
        <span class="token function">DrawCircle</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">struct</span> Circle<span class="token operator">*</span><span class="token punctuation">)</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><ul>
<li><code>DrawAllShapes</code> no est&#xE1; cerrado para modificaciones cuando aparecen nuevos tipos de <code>Shape</code></li>
</ul>
<h4 class="mume-header" id="soluci%C3%B3n-1">Soluci&#xF3;n</h4>

<ul>
<li><strong>Abstracci&#xF3;n</strong> (ocultaci&#xF3;n de la implementaci&#xF3;n): clase abstracta y m&#xE9;todos polim&#xF3;rficos.</li>
<li><strong>Patrones de dise&#xF1;o</strong>: <em>template method</em> y/o <em>strategy</em></li>
</ul>
<p>Aplicando el OCP...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Shape</span>
<span class="token punctuation">{</span>
  <span class="token keyword">void</span> <span class="token function">Draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Square</span><span class="token punctuation">:</span> <span class="token class-name">Shape</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token comment">//draw a square</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Circle</span><span class="token punctuation">:</span> <span class="token class-name">Shape</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token comment">//draw a circle</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">DrawAllShapes</span><span class="token punctuation">(</span><span class="token class-name">IList</span> shapes<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token class-name">Shape</span> shape <span class="token keyword">in</span> shapes<span class="token punctuation">)</span>
    shape<span class="token punctuation">.</span><span class="token function">Draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><ul>
<li>Si queremos ampliar el comportamiento de <code>DrawAllShapes</code>, solo tenemos que a&#xF1;adir una nueva clase derivada de <code>Shape</code></li>
<li>Si se aplica bien OCP, los cambios de un cierto tipo obligan a a&#xF1;adir nuevo c&#xF3;digo, no a modificar el existente</li>
</ul>
<blockquote>
<p>In general, no matter how <em>closed</em> a module is, there will always be some kind of change against which it is not closed. There is no model that is natural to all contexts!</p>
<p>Since closure cannot be complete, it must be strategic. That is, the designer must choose the kinds of changes against which to close the design, must guess at the kinds of changes that are most likely, and then construct abstractions to protect against those changes.</p>
<p><cite>-- Bob C. Martin</cite></p>
</blockquote>
<h2 class="mume-header" id="span-stylecolorblueprincipo-de-segregaci%C3%B3n-de-interfacesspan"><span style="color:blue;">Principo de segregaci&#xF3;n de interfaces</span></h2>

<p><strong>ISP: <em>Interface Segregation Principle</em></strong></p>
<blockquote>
<p>Los clientes no deben depender de m&#xE9;todos que no usan.</p>
<p><cite>Bob C. Martin</cite></p>
</blockquote>
<ul>
<li>Las interfaces son para los <strong>clientes</strong>, no para hacer jerarqu&#xED;as</li>
<li>Evitar interfaces <strong>gruesas</strong> con muchos m&#xE9;todos (descohesionadas)</li>
<li>Los cambios en los m&#xE9;todos ignorados pueden provocar cambios en un cliente que no los usa</li>
<li>La interfaz de una clase puede dividirse en <strong>bloques</strong> de m&#xE9;todos relacionados. Unos clientes usan un bloque y otros clientes usan otro bloque. Si un cliente necesita conocer una interfaz no cohesionada, debe hacerlo combinando una o m&#xE1;s clases (sus interfaces)</li>
<li>ISP es a las interfaces lo que SRP es a clases y m&#xE9;todos</li>
<li>Violar el ISP es muy com&#xFA;n en lenguajes de tipos est&#xE1;ticos (C++, Java, C#). Los lenguajes din&#xE1;micos (Ruby, Scala) ayudan algo m&#xE1;s a no violar el ISP (v.g. con los <em>mixins</em>)</li>
</ul>
<h3 class="mume-header" id="ejemplo-acoplamiento-contexto-strategy">Ejemplo: acoplamiento contexto-strategy</h3>

<ul>
<li>&#xBF;C&#xF3;mo se comunican <em>Strategy</em> y <em>Context</em> (acoplado/desacoplado)?</li>
<li><em>Context</em> Puede definir una interfaz que le permita a <em>Strategy</em> acceder a sus datos</li>
</ul>
<h3 class="mume-header" id="ejemplo-puertas-de-seguridad">Ejemplo: puertas de seguridad</h3>

<p>Una implementaci&#xF3;n de puertas de seguridad con temporizador (<code>TimedDoor</code>) que hace sonar una alarma cuando la puerta est&#xE1; abierta durante un cierto tiempo.</p>
<h4 class="mume-header" id="dise%C3%B1o">Dise&#xF1;o</h4>

<ul>
<li>
<p><code>TimedDoor</code> se comunica con <code>Timer</code> para registrar un temporizador</p>
</li>
<li>
<p>Cuando salta el temporizador, avisa a un <code>TimerClient</code></p>
</li>
<li>
<p>Con la siguiente soluci&#xF3;n, un <code>TimerClient</code> puede registrarse a s&#xED; mismo en un <code>Timer</code> y recibir un mensaje <code>Timeout()</code>.</p>
<p><img src="./figuras/isp-timer-door.png" alt="Puertas de seguridad"></p>
</li>
</ul>
<h4 class="mume-header" id="implementaci%C3%B3n-inicial">Implementaci&#xF3;n inicial</h4>

<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Timer</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Register</span><span class="token punctuation">(</span><span class="token keyword">int</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimerClient</span> client<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/*code*/</span> 
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TimerClient</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">TimeOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><ul>
<li>Si se cierra la puerta antes de que venza el timeout <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">t_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> y se vuelve a abrir, se registra uno nuevo <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">t_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> antes de que el antiguo haya expirado.</li>
<li>Cuando el primer temporizador <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">t_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> expira, se produce la llamada a <code>Timeout()</code> de <code>TimedDoor</code> y no deber&#xED;a.</li>
<li>As&#xED; que cambiamos la implementaci&#xF3;n:</li>
</ul>
<h4 class="mume-header" id="implementaci%C3%B3n-mejorada">Implementaci&#xF3;n mejorada</h4>

<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Timer</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Register</span><span class="token punctuation">(</span><span class="token keyword">int</span> timeout<span class="token punctuation">,</span> <span class="token keyword">int</span> timeOutId<span class="token punctuation">,</span> <span class="token class-name">TimerClient</span> client<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/*code*/</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TimerClient</span> <span class="token punctuation">{</span>
  <span class="token keyword">void</span> <span class="token function">TimeOut</span><span class="token punctuation">(</span><span class="token keyword">int</span> timeOutID<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><p>&#xBF;En qu&#xE9; ha afectado el <strong>cambio en la implementaci&#xF3;n</strong> de <code>TimerClient</code>?</p>
<ul>
<li>El cambio afecta a los usuarios de <code>TimerClient</code>, pero tambi&#xE9;n a <code>Door</code> y a los clientes de <code>Door</code> (y no deber&#xED;a)</li>
<li>El problema es que <code>Door</code> depende de <code>TimerClient</code> y no todas las variedades de puerta son de seguridad (con temporizador)</li>
<li>Si hacen falta m&#xE1;s variedades de puerta, todas ellas deber&#xE1;n implementar implementaciones degeneradas de <code>Timeout</code></li>
<li>Las interfaces empiezan a engrosarse. Esto puede acabar violando tambi&#xE9;n el LSP</li>
</ul>
<h4 class="mume-header" id="redise%C3%B1o-puertas-de-seguridad">Redise&#xF1;o: puertas de seguridad</h4>

<p><strong>Delegaci&#xF3;n</strong> a trav&#xE9;s del patr&#xF3;n adapter (de objetos o de clases)</p>
<ul>
<li>
<p>Versi&#xF3;n adaptador de clases (por herencia):</p>
<p><img src="./figuras/isp-timer-door-class-adapter.png" alt="Puertas de seguridad - adaptador de clases"></p>
</li>
<li>
<p>Versi&#xF3;n adaptador de objetos (por composici&#xF3;n):</p>
<p><img src="./figuras/isp-timer-door-object-adapter.png" alt="Puertas de seguridad - adaptador de objetos"></p>
</li>
</ul>
<h2 class="mume-header" id="aplicaci%C3%B3n-de-ocp-y-srp">Aplicaci&#xF3;n de OCP y SRP</h2>

<h3 class="mume-header" id="ejemplo-shapes-versi%C3%B3n-1shapesv1">Ejemplo: <a href="#shapesV1">Shapes versi&#xF3;n 1</a></h3>

<pre data-role="codeBlock" data-info="java" class="language-java"><span class="token keyword">package</span> shapes<span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>
  <span class="token keyword">double</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span>
  <span class="token keyword">double</span> <span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  <span class="token keyword">double</span> <span class="token function">getY</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Polygon</span> <span class="token keyword">implements</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>
  Point <span class="token function">getVertex</span><span class="token punctuation">(</span>index i<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Triangle</span> <span class="token keyword">extends</span> <span class="token class-name">Polygon</span> <span class="token punctuation">{</span>
  <span class="token keyword">double</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">RectParallelogram</span> <span class="token keyword">extends</span> <span class="token class-name">Polygon</span> <span class="token punctuation">{</span>
  <span class="token keyword">double</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Square</span> <span class="token keyword">extends</span> <span class="token class-name">RectParallelogram</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Rectangle</span> <span class="token keyword">extends</span> <span class="token class-name">RectParallelogram</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">ClosedCurve</span> <span class="token keyword">implements</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Circle</span>
    <span class="token keyword">extends</span> <span class="token class-name">ClosedCurve</span> <span class="token punctuation">{</span>
  <span class="token keyword">double</span> <span class="token function">getRadius</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  Point <span class="token function">getCenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  <span class="token keyword">double</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Ellipse</span> <span class="token keyword">extends</span> <span class="token class-name">ClosedCurve</span> <span class="token punctuation">{</span>
  <span class="token keyword">double</span> <span class="token function">getApogeeRadius</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  <span class="token keyword">double</span> <span class="token function">getPerigeeRadius</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  Point <span class="token function">getFocus1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  Point <span class="token function">getFocus2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  Point <span class="token function">getCenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  <span class="token keyword">double</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><ul>
<li>Las funcionalidades para pintar (<code>draw</code>) y para imprimir (<code>toString</code>) pueden descohesionar las clases y atentar contra OCP y SRP.</li>
<li>Saqu&#xE9;moslas fuera utilizando <strong>aspectos</strong>:</li>
</ul>
<pre data-role="codeBlock" data-info="java" class="language-java"><span class="token comment">// Ficheros &lt;X&gt;ToString.aj (uno por aspecto)</span>
<span class="token keyword">package</span> shapes<span class="token punctuation">.</span>tostring<span class="token punctuation">;</span> <span class="token comment">// para todos los toString()</span>
aspect PolygonToString <span class="token punctuation">{</span>
  String Polygon<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    StringBuffer buff <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    buff<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">//... a&#xF1;adir nombre y &#xE1;rea...</span>
     <span class="token comment">//... a&#xF1;adir cada l&#xED;nea desde un v&#xE9;rtice al siguiente</span>
    <span class="token keyword">return</span> buff<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
aspect CircleToString <span class="token punctuation">{</span>
  String Circle<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
aspect EllipseToString <span class="token punctuation">{</span>
  String Ellipse<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Drawable.java</span>
<span class="token keyword">package</span> drawing<span class="token punctuation">;</span>
<span class="token keyword">interface</span> <span class="token class-name">Drawable</span> <span class="token punctuation">{</span>
  <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Ficheros Drawable&lt;X&gt;.aj</span>
<span class="token keyword">package</span> shapes<span class="token punctuation">.</span>drawing<span class="token punctuation">;</span> <span class="token comment">// para todos los draw()...</span>
<span class="token keyword">import</span> drawing<span class="token punctuation">.</span>Drawable<span class="token punctuation">;</span>
<span class="token keyword">abstract</span> aspect DrawableShape <span class="token punctuation">{</span>
  declare parents<span class="token operator">:</span> Shape <span class="token keyword">implements</span> <span class="token class-name">Drawable</span><span class="token punctuation">;</span>
  <span class="token keyword">void</span> Shape<span class="token punctuation">.</span><span class="token function">draw</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//template method</span>
  <span class="token punctuation">{</span>
    String drawCommand <span class="token operator">=</span> <span class="token function">makeDrawCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// enviar orden al motor gr&#xE1;fico...</span>
  <span class="token punctuation">}</span>
  String Shape<span class="token punctuation">.</span><span class="token function">makeDrawCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span> <span class="token operator">+</span> <span class="token function">makeDetails</span><span class="token punctuation">(</span><span class="token string">&quot;\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">abstract</span> String Shape<span class="token punctuation">.</span><span class="token function">makeDetails</span> <span class="token punctuation">(</span>String indent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
aspect DrawablePolygon <span class="token keyword">extends</span> <span class="token class-name">DrawableShape</span> <span class="token punctuation">{</span>
  String Polygon<span class="token punctuation">.</span><span class="token function">makeDetails</span> <span class="token punctuation">(</span>String indent<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
aspect DrawableCircle <span class="token keyword">extends</span> <span class="token class-name">DrawableShape</span> <span class="token punctuation">{</span>
  String Circle<span class="token punctuation">.</span><span class="token function">makeDetails</span> <span class="token punctuation">(</span>String indent<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
aspect DrawableEllipse <span class="token keyword">extends</span> <span class="token class-name">DrawableShape</span> <span class="token punctuation">{</span>
  String Ellipse<span class="token punctuation">.</span> <span class="token function">makeDetails</span> <span class="token punctuation">(</span>String indent<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
</pre><h2 class="mume-header" id="span-stylecolorblueprincipio-de-sustituci%C3%B3n-de-liskovspan"><span style="color:blue;">Principio de sustituci&#xF3;n de Liskov</span></h2>

<p><strong>LSP: <em>Liskov Substitution Principle</em></strong></p>
<blockquote>
<p>Un subtipo debe poder ser sustituible por sus tipos base</p>
<p><cite>Barbara Liskov, </cite></p>
</blockquote>
<p>Si una funci&#xF3;n <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathit" style="margin-right:0.10764em;">f</span></span></span></span> depende de una clase base <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.05017em;">B</span></span></span></span> y hay una <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.02778em;">D</span></span></span></span> derivada de <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.05017em;">B</span></span></span></span>, las instancias de <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.02778em;">D</span></span></span></span> no deben alterar el comportamiento definido por <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.05017em;">B</span></span></span></span> de modo que <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathit" style="margin-right:0.10764em;">f</span></span></span></span> deje de funcionar</p>
<h3 class="mume-header" id="ejemplo-shapes-versi%C3%B3n-3">Ejemplo: Shapes versi&#xF3;n 3</h3>

<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword">struct</span> Point <span class="token punctuation">{</span><span class="token keyword">double</span> x<span class="token punctuation">,</span> y<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">enum</span> ShapeType <span class="token punctuation">{</span>square<span class="token punctuation">,</span> circle<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">ShapeType</span> type<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token function">Shape</span><span class="token punctuation">(</span><span class="token class-name">ShapeType</span> t<span class="token punctuation">)</span><span class="token punctuation">{</span>type <span class="token operator">=</span> t<span class="token punctuation">;</span><span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">DrawShape</span><span class="token punctuation">(</span><span class="token class-name">Shape</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>type <span class="token operator">==</span> ShapeType<span class="token punctuation">.</span>square<span class="token punctuation">)</span>
      <span class="token punctuation">(</span>s <span class="token keyword">as</span> Square<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>type <span class="token operator">==</span> ShapeType<span class="token punctuation">.</span>circle<span class="token punctuation">)</span>
      <span class="token punctuation">(</span>s <span class="token keyword">as</span> Circle<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Circle</span><span class="token punctuation">:</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">Point</span> center<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">double</span> radius<span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token function">Circle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>ShapeType<span class="token punctuation">.</span>circle<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">/* draws the circle */</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Square</span><span class="token punctuation">:</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">Point</span> topLeft<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">double</span> side<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token function">Square</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>ShapeType<span class="token punctuation">.</span>square<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">/* draws the square */</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><ul>
<li>
<p><code>DrawShape</code> viola claramente el OCP</p>
</li>
<li>
<p>Adem&#xE1;s <code>Square</code> y <code>Circle</code> no son sustuibles por <code>Shape</code>: no redefinen ninguna funci&#xF3;n de <code>Shape</code>, sino que a&#xF1;aden <code>Draw()</code> (violaci&#xF3;n del LSP)</p>
</li>
<li>
<p>Esta violaci&#xF3;n de LSP es la que provoca la violaci&#xF3;n de OCP en <code>DrawShape</code></p>
</li>
<li>
<p>Violaci&#xF3;n m&#xE1;s sutil de LSP...</p>
</li>
</ul>
<h3 class="mume-header" id="ejemplo-rect%C3%A1ngulos-versi%C3%B3n-1">Ejemplo: rect&#xE1;ngulos versi&#xF3;n 1</h3>

<p>De momento solo necesitamos rect&#xE1;ngulos y escribimos esta versi&#xF3;n:</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">Point</span> topLeft<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">double</span> width<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">double</span> height<span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">double</span> Width <span class="token punctuation">{</span>
    <span class="token keyword">get</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> width<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">set</span> <span class="token punctuation">{</span> width <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">double</span> Height <span class="token punctuation">{</span>
    <span class="token keyword">get</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> height<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">set</span> <span class="token punctuation">{</span> height <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>Un d&#xED;a hace falta manejar cuadrados adem&#xE1;s de rect&#xE1;ngulos.</p>
<p>Geom&#xE9;tricamente, un cuadrado es un rect&#xE1;ngulo, as&#xED; que hacemos uso de la herencia (relaci&#xF3;n <strong>es-un</strong>):</p>
<pre data-role="codeBlock" data-info="java" class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Square</span><span class="token operator">:</span> Rectangle <span class="token punctuation">{</span>
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</pre><h4 class="mume-header" id="problema-cuadrados-como-rect%C3%A1ngulos">Problema: cuadrados como rect&#xE1;ngulos</h4>

<ul>
<li>
<p>Un cuadrado podr&#xED;a ser un rect&#xE1;ngulo, pero definitivamente un objeto <code>Square</code> <strong>no es un</strong> objeto <code>Rectangle</code></p>
</li>
<li>
<p>Un <code>Square</code> no tiene propiedades <code>height</code>y <code>width</code>. Pero supongamos que no nos importa el desperdicio de memoria.</p>
</li>
<li>
<p><code>Square</code> heredar&#xE1; los m&#xE9;todos accesores de <code>Rectangle</code>.</p>
</li>
<li>
<p>As&#xED; que hacemos lo siguiente...</p>
</li>
</ul>
<h3 class="mume-header" id="ejemplo-rect%C3%A1ngulos-versi%C3%B3n-2">Ejemplo: rect&#xE1;ngulos versi&#xF3;n 2</h3>

<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Square</span><span class="token punctuation">:</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">new</span> <span class="token keyword">double</span> Width
  <span class="token punctuation">{</span>
    <span class="token keyword">set</span> <span class="token punctuation">{</span>
      <span class="token keyword">base</span><span class="token punctuation">.</span>Width <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
      <span class="token keyword">base</span><span class="token punctuation">.</span>Height <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">new</span> <span class="token keyword">double</span> Height
  <span class="token punctuation">{</span>
    <span class="token keyword">set</span> <span class="token punctuation">{</span>
      <span class="token keyword">base</span><span class="token punctuation">.</span>Height <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
      <span class="token keyword">base</span><span class="token punctuation">.</span>Width <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><ul>
<li>
<p>El comportamiento de un objeto <code>Square</code> no es consistente con el de un objeto <code>Rectangle</code>:</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token class-name">Square</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Square</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
s<span class="token punctuation">.</span><span class="token function">SetWidth</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// fija ambos</span>
s<span class="token punctuation">.</span><span class="token function">SetHeight</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// fija ambos</span>

<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token class-name">Rectangle</span> r<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  r<span class="token punctuation">.</span><span class="token function">SetWidth</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// calls Rectangle.SetWidth</span>
<span class="token punctuation">}</span>
</pre></li>
<li>
<p>&#xBF;Qu&#xE9; sucede si pasamos un <code>Square</code> a la funci&#xF3;n <code>f</code>?</p>
<p>&#xA1;No cambia <code>Height</code>!</p>
</li>
<li>
<p>Podr&#xED;a argumentarse que el error era que los m&#xE9;todos <code>Width</code>y <code>Height</code> no se declararon <code>virtual</code> en <code>Rectangle</code>.</p>
</li>
</ul>
<h4 class="mume-header" id="extensi%C3%B3n-y-ocultaci%C3%B3n-de-m%C3%A9todos">Extensi&#xF3;n y ocultaci&#xF3;n de m&#xE9;todos</h4>

<ul>
<li>La <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/knowing-when-to-use-override-and-new-keywords">diferencia entre <code>new</code> y <code>override</code> en un m&#xE9;todo en C#</a> es que <code>new</code> oculta la implementaci&#xF3;n de la clase base y <code>override</code> la extiende.</li>
</ul>
<p>Sin embargo, cuando la creaci&#xF3;n de una clase derivada provoca cambios en la clase base, es s&#xED;ntoma de un <strong>mal dise&#xF1;o</strong>.</p>
<p>El LSP pone en evidencia que la relaci&#xF3;n <strong>es-un</strong> tiene que ver con el comportamiento p&#xFA;blico extr&#xED;nseco, del que los clientes dependen.</p>
<h3 class="mume-header" id="ejemplo-rect%C3%A1ngulos-versi%C3%B3n-3">Ejemplo: rect&#xE1;ngulos versi&#xF3;n 3</h3>

<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Rectangle</span>
<span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">Point</span> topLeft<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">double</span> width<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">double</span> height<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token keyword">double</span> Width
  <span class="token punctuation">{</span>
    <span class="token keyword">get</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> width<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">set</span> <span class="token punctuation">{</span> width <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token keyword">double</span> Height
  <span class="token punctuation">{</span>
    <span class="token keyword">get</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> height<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">set</span> <span class="token punctuation">{</span> height <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Square</span><span class="token punctuation">:</span> <span class="token class-name">Rectangle</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token keyword">double</span> Width
  <span class="token punctuation">{</span>
    <span class="token keyword">set</span> <span class="token punctuation">{</span>
      <span class="token keyword">base</span><span class="token punctuation">.</span>Width <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
      <span class="token keyword">base</span><span class="token punctuation">.</span>Height <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token keyword">double</span> Height
  <span class="token punctuation">{</span>
    <span class="token keyword">set</span> <span class="token punctuation">{</span>
      <span class="token keyword">base</span><span class="token punctuation">.</span>Height <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
      <span class="token keyword">base</span><span class="token punctuation">.</span>Width <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>Ahora parece que funcionan <code>Square</code> y <code>Rectangle</code>, que matem&#xE1;ticamente quedan bien definidos.</p>
<p>Pero consideremos esto:</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword">void</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token class-name">Rectangle</span> r<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  r<span class="token punctuation">.</span>Width <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>    <span class="token comment">// cree que es un Rectangle</span>
  r<span class="token punctuation">.</span>Height <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>   <span class="token comment">// cree que es un Rectangle</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">Area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">20</span><span class="token punctuation">)</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string">&quot;Bad area!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><p>&#xBF;Qu&#xE9; pasa si llamamos a <code>g(new Square(3))</code>?</p>
<p>El autor de <code>g</code> asumi&#xF3; que cambiar el ancho de un rect&#xE1;ngulo deja intacto el alto. Si pasamos un cuadrado esto no es as&#xED;</p>
<p><strong>Violaci&#xF3;n de LSP</strong>: Si pasamos una instancia de una clase derivada (<code>Square</code>), se altera el comportamiento definido por la clase base (<code>Rectangle</code>) de forma que <code>g</code> deja de funcionar.</p>
<p>&#xBF;Qui&#xE9;n tiene la culpa?</p>
<ul>
<li>&#xBF;El autor de <code>g</code> por asumir que &quot;en un rect&#xE1;ngulo su ancho y alto son independientes&quot; (<em>invariante</em>)?</li>
<li>&#xBF;El autor de <code>Square</code> por violar el invariante?</li>
<li>&#xBF;De qu&#xE9; clase se ha violado el invariante? &#xA1;De <code>Rectangle</code> y no de <code>Square</code>!</li>
</ul>
<p>Para evaluar si un dise&#xF1;o es apropiado, no se debe tener en cuenta la soluci&#xF3;n por s&#xED; sola, sino en t&#xE9;rminos de los <em>supuestos razonables</em> que hagan los usuarios del dise&#xF1;o.</p>
<h3 class="mume-header" id="ejercicios-de-lsp">Ejercicios de LSP</h3>

<ul>
<li>Robert C. Martin &amp; Micah Martin: <a href="#unclebob">Agile Principles, Patterns and Practices in C#</a>, Prentice Hall, 2006</li>
</ul>
<h3 class="mume-header" id="span-stylecolorbluedise%C3%B1o-por-contratospan"><span style="color:blue;">Dise&#xF1;o por Contrato</span></h3>

<p>Relaci&#xF3;n entre LSP y el <strong><em>Design-By-Contract</em></strong> (DBC) de <em>Bertrand<br>
Meyer</em>:</p>
<blockquote>
<p>A routine redeclaration [in a derivative] may only replace the original precondition by one equal or weaker, and the original post-condition by one equal or stronger</p>
<p>&#x2013;&#x2013; <cite>B. Meyer</cite></p>
</blockquote>
<ul>
<li>M&#xE9;todos de clase declaran <em>precondiciones</em> y <em>postcondiciones</em> al redefinir una operaci&#xF3;n en una subclase derivada
<ul>
<li>las <strong>precondiciones</strong> s&#xF3;lo pueden sustituirse por otras m&#xE1;s d&#xE9;biles/laxas</li>
<li>las <strong>postcondiciones</strong> s&#xF3;lo pueden sustituirse por otras m&#xE1;s fuertes/estrictas</li>
</ul>
</li>
</ul>
<h4 class="mume-header" id="ejemplo-rect%C3%A1ngulos">Ejemplo: rect&#xE1;ngulos</h4>

<ul>
<li>
<p>Postcondici&#xF3;n del <em>setter</em> de <code>Rectangle.Width</code><br>
(En C++ ser&#xED;a <code>Rectangle::SetWidth(double w)</code>):<br>
<code>assert((Width == w) &amp;&amp; (Height == old.Height));</code></p>
</li>
<li>
<p>Postcondici&#xF3;n del setter de <code>Square.Witdh</code><br>
En C++ ser&#xED;a <code>Square::SetWidth(double w)</code>):<br>
<code>assert(Width==w);</code></p>
</li>
<li>
<p>La postcondici&#xF3;n de <code>Square::SetWidth(double w)</code> viola el  contrato de la clase base porque es m&#xE1;s d&#xE9;bil que la de <code>Rectangle</code></p>
</li>
</ul>
<h2 class="mume-header" id="span-stylecolorblueprincipio-de-inversi%C3%B3n-de-dependenciasspan"><span style="color:blue;">Principio de Inversi&#xF3;n de Dependencias</span></h2>

<p><strong>DIP: <em>Dependency Inversion Principle</em></strong></p>
<ul>
<li>
<p>Los m&#xF3;dulos de alto nivel no deben depender de m&#xF3;dulos de bajo nivel.<br>
Ambos deben depender de abstracciones.</p>
</li>
<li>
<p>Las abstracciones no deben depender de los detalles, sino los detalles de las abstracciones</p>
</li>
</ul>
<blockquote>
<p>Depend on abstractions</p>
<p><cite>Robert C. Martin</cite></p>
</blockquote>
<h3 class="mume-header" id="ejemplo-estructura-en-capas">Ejemplo: estructura en capas</h3>

<p><strong>Dise&#xF1;o inicial</strong>:</p>
<p><img src="./figuras/dip-1.png" alt="estructura en capas"></p>
<ul>
<li>Las dependencias son transitivas</li>
<li><em>Policy</em> depende de todo lo que depende <em>Mechanism</em>.</li>
</ul>
<p><strong>Dise&#xF1;o invertido</strong>:</p>
<p><img src="./figuras/dip-2.png" alt="capas invertidas"></p>
<ul>
<li>Cada nivel declara una interfaz para lo que necesita de otros niveles inferiores</li>
<li>Los niveles inferiores dependen de interfaces definidas en los superiores</li>
<li>El cliente puede definir la abstracci&#xF3;n que necesita (ISP)</li>
<li>Cada nivel es intercambiable por un sustituto</li>
</ul>
<h3 class="mume-header" id="span-stylecolorblueheur%C3%ADstica-_ingenua_span"><span style="color:blue;">Heur&#xED;stica <em>ingenua</em></span>:</h3>

<ul>
<li>Ninguna variable deber&#xED;a guardar una referencia a una clase concreta</li>
<li>Ninguna clase deber&#xED;a ser derivada de una clase concreta</li>
<li>Ning&#xFA;n m&#xE9;todo deber&#xED;a redefinir un m&#xE9;todo ya implementado de ninguna de sus clases base</li>
</ul>
<p>Hay que violar alguna vez estas heur&#xED;sticas, pues alguien tiene que crear las instancias de las clases concretas. El m&#xF3;dulo que lo haga presentar&#xE1; una dependencia de dichas clases concretas.</p>
<p>Gracias a la introspecci&#xF3;n o la carga din&#xE1;mica de clases, los lenguajes de programaci&#xF3;n pueden indicar el nombre de la clase a instanciar (por ejemplo, en un fichero de configuraci&#xF3;n).</p>
<p>Hay clases concretas que no cambian, como <code>string</code>, as&#xED; que no hace ning&#xFA;n da&#xF1;o depender de ellas.</p>

      </div>
      
      
    
    
    
    
    
    
    
    
  
    </body></html>